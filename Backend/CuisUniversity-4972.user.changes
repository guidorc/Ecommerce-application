

----QUIT----(13 November 2021 20:18:32) CuisUniversity-4972.image priorSource: 14896235!

----STARTUP---- (13 November 2021 20:18:33) as /Users/hernan/Documents/Cuis/5.0-64Bits/Cuis-University-Installer/CuisUniversity-4972.image!


----QUIT----(13 November 2021 20:18:33) CuisUniversity-4972.image priorSource: 18974023!

----STARTUP---- (14 November 2021 14:17:02) as C:\Users\migue\Desktop\cuis\windows64\CuisUniversity-4972.image!


----End fileIn of \Users\migue\Desktop\cuis\windows64\StringsServicesServer.st----!

----End fileIn of C:\Users\migue\Desktop\cuis\windows64\Packages\System\Collections-CompactArrays.pck.st----!

----End fileIn of C:\Users\migue\Desktop\cuis\windows64\Packages\Features\Compression.pck.st----!

----End fileIn of C:\Users\migue\Desktop\cuis\windows64\Packages\Features\Sound.pck.st----!

----End fileIn of C:\Users\migue\Desktop\cuis\windows64\Packages\Features\Cryptography-DigitalSignatures.pck.st----!

----End fileIn of C:\Users\migue\Desktop\cuis\windows64\Packages\Features\Identities-UUID.pck.st----!

----End fileIn of C:\Users\migue\Desktop\cuis\windows64\Packages\System\Network-Kernel.pck.st----!

----End fileIn of \Users\migue\Desktop\cuis\windows64\WebClient.pck.st----!

----End fileIn of \Users\migue\Desktop\cuis\windows64\TusLibros-Model.st----!

----End fileIn of \Users\migue\Desktop\cuis\windows64\TusLibros-80.st----!

server := TusLibrosRestInterface listeningOn: 8080!

!classDefinition: #TusLibrosRestInterface category: 'TusLibros-Model' stamp: 'MR 11/14/2021 14:27:39'!
Object subclass: #TusLibrosRestInterface
	instanceVariableNames: 'webServer port tusLibros today'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosRestInterface methodsFor: 'nil' stamp: 'MR 11/14/2021 14:27:34'!
notExpiredMonthOfYear

	^ Month month: today monthIndex year: today yearNumber + 1! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'MR 11/14/2021 14:27:45'!
notExpiredCreditCardOwner

	^'Juan Perez'! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'MR 11/14/2021 14:27:49'!
notExpiredCreditCardNumber

	^ '1111222233334444' 
! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'MR 11/14/2021 14:27:52'!
notExpiredCreditCard

	^CreditCard expiringOn: self notExpiredMonthOfYear! !

Object subclass: #TusLibrosRestInterface
	instanceVariableNames: 'webServer port tusLibros'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosRestInterface category: 'TusLibros-Model' stamp: 'MR 11/14/2021 14:28:43'!
Object subclass: #TusLibrosRestInterface
	instanceVariableNames: 'webServer port tusLibros'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosRestInterface methodsFor: 'nil' stamp: 'MR 11/14/2021 14:28:46' prior: 50964299!
notExpiredMonthOfYear
	
	|today| 
	today := DateAndTime now.
	^ Month month: today monthIndex year: today yearNumber + 1! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'MR 11/14/2021 14:28:48' prior: 50964335!
notExpiredMonthOfYear
	
	|today| 
	today := DateAndTime now.
	^ Month month: today monthIndex year: today yearNumber + 1.! !

server destroy.!

server := TusLibrosRestInterface listeningOn: 8080!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'MR 11/14/2021 14:31:52' prior: 50962266!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionId |
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		transactionId := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: cced.
		
		aRequest send200Response: transactionId.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

server destroy.!

server := TusLibrosRestInterface listeningOn: 8080!

server destroy.!

----SNAPSHOT----(14 November 2021 14:34:41) CuisUniversity-4972.image priorSource: 18974255!

----STARTUP---- (14 November 2021 15:38:22) as C:\Users\Guido\Desktop\windows64\CuisUniversity-4972.image!


----End fileIn of \Users\Guido\Desktop\windows64\TusLibros-Model.st----!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\System\Collections-CompactArrays.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\Features\Compression.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\Features\Sound.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\Features\Cryptography-DigitalSignatures.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\Features\Identities-UUID.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\System\Network-Kernel.pck.st----!

----End fileIn of \Users\Guido\Desktop\windows64\WebClient.pck.st----!

----End fileIn of \Users\Guido\Desktop\windows64\TusLibros-80.st----!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/14/2021 15:41:32' prior: 50963213!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ | sales |
		sales := self salesDoneBy: aUser.
		sales
			inject: Dictionary new
			into: [ :salesOrderedByBook :aSale |
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook ] ]! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/14/2021 15:42:58' prior: 50963656!
test14ListPurchasesIncludesBoughtItems

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: (testObjectsFactory itemSellByTheStorePrice * 2).
	self assert: (purchases at: self anotherValidBook) equals: testObjectsFactory anotherItemSellByTheStorePrice.! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/14/2021 15:44:03' prior: 50964177!
listPurchasesOf: aUser authenticatingWith: aPassword

	| total |

	^self if: aUser authenticatesWith: aPassword do: [ | sales |
		sales := self salesDoneBy: aUser.
		sales
			inject: Dictionary new
			into: [ :salesOrderedByBook :aSale |
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook ] ]! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/14/2021 15:46:43' prior: 50964219!
listPurchasesOf: aUser authenticatingWith: aPassword

	| total |

	^self if: aUser authenticatesWith: aPassword do: [ | sales |
		sales := self salesDoneBy: aUser.
		sales
			inject: Dictionary new
			into: [ :salesOrderedByBook :aSale |
				total _ total + aSale total.
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook ] ]! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/14/2021 15:49:43' prior: 50964232!
listPurchasesOf: aUser authenticatingWith: aPassword

	| total purchases |

	total _ 0.
	purchases _ Dictionary new.

	self if: aUser authenticatesWith: aPassword do: [ | sales |
		sales := self salesDoneBy: aUser.
		sales
			inject: purchases
			into: [ :salesOrderedByBook :aSale |
				total _ total + aSale total.
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook ]].
		
	purchases at: 'total amount' put: total.
	^purchases.! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/14/2021 15:49:59' prior: 50964190!
test14ListPurchasesIncludesBoughtItems

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: (testObjectsFactory itemSellByTheStorePrice * 2).
	self assert: (purchases at: self anotherValidBook) equals: testObjectsFactory anotherItemSellByTheStorePrice.! !

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/14/2021 15:50:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/14/2021 15:50:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/14/2021 15:50:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/14/2021 15:50:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/14/2021 15:50:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/14/2021 15:50:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/14/2021 15:50:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/14/2021 15:50:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/14/2021 15:50:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/14/2021 15:50:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/14/2021 15:50:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/14/2021 15:50:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/14/2021 15:50:00'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/14/2021 15:50:00'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/14/2021 15:50:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/14/2021 15:50:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/14/2021 15:50:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 15:50:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 15:50:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 15:50:01'!
FAILURE!
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/14/2021 15:51:00' prior: 50964265!
test14ListPurchasesIncludesBoughtItems

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: (testObjectsFactory itemSellByTheStorePrice * 2).
	self assert: (purchases at: self anotherValidBook) equals: testObjectsFactory anotherItemSellByTheStorePrice.
	self assert: (purchases at: 'total amount') equals: 10.! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/14/2021 15:52:13' prior: 50964370!
test14ListPurchasesIncludesBoughtItems

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: (testObjectsFactory itemSellByTheStorePrice * 2).
	self assert: (purchases at: self anotherValidBook) equals: testObjectsFactory anotherItemSellByTheStorePrice.
	self assert: (purchases at: 'total amount') equals: 35.! !

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/14/2021 15:52:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/14/2021 15:52:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/14/2021 15:52:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/14/2021 15:52:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/14/2021 15:52:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/14/2021 15:52:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/14/2021 15:52:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/14/2021 15:52:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/14/2021 15:52:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/14/2021 15:52:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/14/2021 15:52:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/14/2021 15:52:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/14/2021 15:52:14'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/14/2021 15:52:14'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/14/2021 15:52:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/14/2021 15:52:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/14/2021 15:52:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 15:52:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 15:52:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 15:52:14'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/14/2021 15:52:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/14/2021 15:56:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/14/2021 15:56:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/14/2021 15:56:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/14/2021 15:56:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/14/2021 15:56:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/14/2021 15:56:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/14/2021 15:56:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/14/2021 15:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/14/2021 15:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/14/2021 15:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/14/2021 15:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/14/2021 15:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/14/2021 15:56:39'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/14/2021 15:56:39'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/14/2021 15:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/14/2021 15:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/14/2021 15:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 15:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 15:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 15:56:39'!
FAILURE!
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'GRC 11/14/2021 15:56:53' prior: 50963872!
test12CanNotCheckoutAnEmptyCart

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self
		should: [systemFacade
			checkOutCartIdentifiedAs: cartId
			withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
			ownedBy: testObjectsFactory notExpiredCreditCardOwner
			expiringOn: testObjectsFactory notExpiredMonthOfYear ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade cartCanNotBeEmptyErrorMessage.
			self assert: (systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword) isEmpty ]

		! !

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/14/2021 15:56:56'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/14/2021 15:56:56'!
FAILURE!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/14/2021 15:59:11' prior: 50964247!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ | sales purchases total |
		purchases _ Dictionary new.
		total _ 0.
		sales := self salesDoneBy: aUser.
		sales
			inject: purchases
			into: [ :salesOrderedByBook :aSale |
				total _ total + aSale total.
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook ].
		purchases at: 'total amount' put: total.
		].! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/14/2021 15:59:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/14/2021 15:59:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/14/2021 15:59:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/14/2021 15:59:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/14/2021 15:59:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/14/2021 15:59:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/14/2021 15:59:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/14/2021 15:59:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/14/2021 15:59:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/14/2021 15:59:12'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/14/2021 15:59:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/14/2021 15:59:12'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/14/2021 15:59:12'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/14/2021 15:59:12'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/14/2021 15:59:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/14/2021 15:59:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 15:59:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 15:59:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 15:59:12'!
ERROR!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/14/2021 15:59:40' prior: 50964619!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ | sales purchases total |
		purchases _ Dictionary new.
		total _ 0.
		sales := self salesDoneBy: aUser.
		sales
			inject: purchases
			into: [ :salesOrderedByBook :aSale |
				total _ total + aSale total.
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook ].
		purchases at: 'total amount' put: total.
	].! !

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/14/2021 15:59:50'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/14/2021 15:59:50'!
ERROR!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/14/2021 16:03:45' prior: 50964708!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ | sales purchases total |
		purchases _ Dictionary new.
		total _ 0.
		sales := self salesDoneBy: aUser.
		sales do: [ :salesOrderedByBook :aSale |
				total _ total + aSale total.
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook ].
		purchases at: 'total amount' put: total.
	].! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/14/2021 15:49:43' prior: 50964733!
listPurchasesOf: aUser authenticatingWith: aPassword

	| total purchases |

	total _ 0.
	purchases _ Dictionary new.

	self if: aUser authenticatesWith: aPassword do: [ | sales |
		sales := self salesDoneBy: aUser.
		sales
			inject: purchases
			into: [ :salesOrderedByBook :aSale |
				total _ total + aSale total.
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook ]].
		
	purchases at: 'total amount' put: total.
	^purchases.! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/14/2021 16:03:45' prior: 50964749!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ | sales purchases total |
		purchases _ Dictionary new.
		total _ 0.
		sales := self salesDoneBy: aUser.
		sales do: [ :salesOrderedByBook :aSale |
				total _ total + aSale total.
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook ].
		purchases at: 'total amount' put: total.
	].! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/14/2021 15:59:40' prior: 50964767!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ | sales purchases total |
		purchases _ Dictionary new.
		total _ 0.
		sales := self salesDoneBy: aUser.
		sales
			inject: purchases
			into: [ :salesOrderedByBook :aSale |
				total _ total + aSale total.
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook ].
		purchases at: 'total amount' put: total.
	].! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/14/2021 16:17:51' prior: 50964783!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ | sales purchases total |
		purchases _ Dictionary new.
		total _ 0.
		sales := self salesDoneBy: aUser.
		sales
			inject: purchases
			into: [ :salesOrderedByBook :aSale |
				total _ total + aSale total.
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook at: 'total amount' put: total.
				salesOrderedByBook].
	].! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/14/2021 16:17:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/14/2021 16:17:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/14/2021 16:17:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/14/2021 16:17:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/14/2021 16:17:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/14/2021 16:17:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/14/2021 16:17:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/14/2021 16:17:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/14/2021 16:17:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/14/2021 16:17:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/14/2021 16:17:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/14/2021 16:17:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/14/2021 16:17:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/14/2021 16:17:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/14/2021 16:17:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/14/2021 16:17:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 16:17:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 16:17:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 16:17:54'!
PASSED!

----SNAPSHOT----(14 November 2021 16:19:41) CuisUniversity-4972.image priorSource: 18974255!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/14/2021 16:27:33' prior: 50964800!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ | sales total |
		total _ 0.
		sales := self salesDoneBy: aUser.
		sales
			inject: Dictionary new
			into: [ :salesOrderedByBook :aSale |
				total _ total + aSale total.
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook at: 'total amount' put: total.
				salesOrderedByBook].
	].! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/14/2021 16:27:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/14/2021 16:27:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/14/2021 16:27:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/14/2021 16:27:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/14/2021 16:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/14/2021 16:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/14/2021 16:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/14/2021 16:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/14/2021 16:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/14/2021 16:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/14/2021 16:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/14/2021 16:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/14/2021 16:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/14/2021 16:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/14/2021 16:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/14/2021 16:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 16:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 16:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 16:27:35'!
PASSED!
!TusLibrosSystemFacade methodsFor: 'private' stamp: 'GRC 11/14/2021 16:27:48' prior: 50963237!
list: aSale on: salesOrderedByBook

	"Esto es un indicio de que por ahi conviene empezar a pensar en modelar un SaleBook - Hernan"
	aSale lineItemsDo: [ :aLineItem | | oldTotal newTotal |
		oldTotal := salesOrderedByBook at: aLineItem item ifAbsentPut: [ 0 ].
		newTotal := oldTotal + aLineItem total.
		salesOrderedByBook at: aLineItem item put: newTotal ]! !

Object subclass: #SalesBook
	instanceVariableNames: 'sales'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #SalesBook category: #'TusLibros-Model' stamp: 'GRC 11/14/2021 16:32:10'!
Object subclass: #SalesBook
	instanceVariableNames: 'sales'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!SalesBook methodsFor: 'no messages' stamp: 'GRC 11/14/2021 16:32:38' overrides: 16896425!
initialize

	sales _ OrderedCollection new.! !
!TusLibrosSystemFacade methodsFor: 'initialization' stamp: 'GRC 11/14/2021 16:33:39' prior: 50963261!
initializeAuthenticatingWith: aValidUsersAndPasswords
	acceptingItemsOf: aCatalog
	registeringOn: aSalesBook
	debitingThrought: aMerchantProcessor
	measuringTimeWith: aClock

	validUsersAndPasswords := aValidUsersAndPasswords.
	catalog := aCatalog.
	salesBook := SalesBook new.
	merchantProcessor := aMerchantProcessor.
	clock := aClock.

	cartSessions := Dictionary new.
	lastId := 0.! !
!SalesBook methodsFor: 'as yet unclassified' stamp: 'GRC 11/14/2021 16:37:01'!
add: aSale

	sales add: aSale.! !
!TusLibrosSystemFacade methodsFor: 'private' stamp: 'GRC 11/14/2021 16:41:31' prior: 50964980!
list: aSale on: salesOrderedByBook

	"Esto es un indicio de que por ahi conviene empezar a pensar en modelar un SaleBook - Hernan"
	aSale lineItemsDo: [ :aLineItem | | oldTotal newTotal |
		oldTotal := salesOrderedByBook at: aLineItem item ifAbsentPut: [ 0 ].
		newTotal := oldTotal + aLineItem total.
		salesOrderedByBook at: aLineItem item put: newTotal ]! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/14/2021 16:41:45' prior: 50964892!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ | sales total |
		total _ 0.
		sales := self salesDoneBy: aUser.
		sales
			inject: Dictionary new
			into: [ :salesOrderedByBook :aSale |
				total _ total + aSale total.
				salesBook listOn: salesOrderedByBook.
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook at: 'total amount' put: total.
				salesOrderedByBook].
	].! !
!SalesBook methodsFor: 'as yet unclassified' stamp: 'GRC 11/14/2021 16:44:07'!
listOn: salesOrderedByBook

	sales inject: salesOrderedByBook
		into: [ :aSale :purchases |
			aSale lineItemsDo: [ :aLineItem | | oldTotal newTotal |
				oldTotal := salesOrderedByBook at: aLineItem item ifAbsentPut: [ 0 ].
				newTotal := oldTotal + aLineItem total.
				salesOrderedByBook at: aLineItem item put: newTotal ]
		].! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/14/2021 16:44:45' prior: 50965047!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ | sales total |
		total _ 0.
		sales := self salesDoneBy: aUser.
		sales
			inject: Dictionary new
			into: [ :salesOrderedByBook :aSale |
				total _ total + aSale total.
				salesBook listOn: salesOrderedByBook.
				"self list: aSale on: salesOrderedByBook."
				salesOrderedByBook at: 'total amount' put: total.
				salesOrderedByBook].
	].! !
!SalesBook methodsFor: 'as yet unclassified' stamp: 'GRC 11/14/2021 16:45:49' prior: 50965064!
listOn: salesOrderedByBook

	sales inject: salesOrderedByBook
		into: [ :aSale :purchases | | total |
			aSale lineItemsDo: [ :aLineItem | | oldTotal newTotal |
				oldTotal := salesOrderedByBook at: aLineItem item ifAbsentPut: [ 0 ].
				newTotal := oldTotal + aLineItem total.
				salesOrderedByBook at: aLineItem item put: newTotal ].
			purchases at: 'total amount' put: total.
			purchases.
		].! !
!SalesBook methodsFor: 'as yet unclassified' stamp: 'GRC 11/14/2021 16:47:32' prior: 50965096!
listOn: salesOrderedByBook

	sales inject: salesOrderedByBook
		into: [ :aSale :purchases | | total |
			total _ 0.
			aSale lineItemsDo: [ :aLineItem | | oldTotal newTotal |
				oldTotal := salesOrderedByBook at: aLineItem item ifAbsentPut: [ 0 ].
				newTotal := oldTotal + aLineItem total.
				total _ total + newTotal.
				salesOrderedByBook at: aLineItem item put: newTotal ].
			purchases at: 'total amount' put: total.
			purchases.
		].! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/14/2021 16:47:45' prior: 50965078!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ | sales total |
		total _ 0.
		sales := self salesDoneBy: aUser.
		sales
			inject: Dictionary new
			into: [ :salesOrderedByBook :aSale |
				total _ total + aSale total.
				salesBook listOn: salesOrderedByBook.
				"self list: aSale on: salesOrderedByBook.
				salesOrderedByBook at: 'total amount' put: total.
				salesOrderedByBook"].
	].! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/14/2021 16:47:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/14/2021 16:47:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/14/2021 16:47:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/14/2021 16:47:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/14/2021 16:47:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/14/2021 16:47:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/14/2021 16:47:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/14/2021 16:47:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/14/2021 16:47:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/14/2021 16:47:46'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/14/2021 16:47:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/14/2021 16:47:46'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/14/2021 16:47:46'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/14/2021 16:47:46'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/14/2021 16:47:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/14/2021 16:47:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 16:47:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 16:47:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 16:47:46'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/14/2021 16:47:51'!
ERROR!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/14/2021 16:49:15' prior: 50965130!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [
		salesBook listOn: Dictionary new.
		"sales := self salesDoneBy: aUser.
		total _ 0.
		sales
			inject: Dictionary new
			into: [ :salesOrderedByBook :aSale |
				total _ total + aSale total.
				salesBook listOn: salesOrderedByBook.
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook at: 'total amount' put: total.
				salesOrderedByBook]."
	].! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/14/2021 16:49:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/14/2021 16:49:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/14/2021 16:49:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/14/2021 16:49:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/14/2021 16:49:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/14/2021 16:49:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/14/2021 16:49:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/14/2021 16:49:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/14/2021 16:49:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/14/2021 16:49:17'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/14/2021 16:49:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/14/2021 16:49:18'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/14/2021 16:49:18'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/14/2021 16:49:18'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/14/2021 16:49:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/14/2021 16:49:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 16:49:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 16:49:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 16:49:18'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/14/2021 16:49:21'!
ERROR!
!SalesBook methodsFor: 'as yet unclassified' stamp: 'GRC 11/14/2021 16:49:58' prior: 50965112!
listOn: salesOrderedByBook

	sales inject: salesOrderedByBook
		into: [ :purchases :aSale | | total |
			total _ 0.
			aSale lineItemsDo: [ :aLineItem | | oldTotal newTotal |
				oldTotal := salesOrderedByBook at: aLineItem item ifAbsentPut: [ 0 ].
				newTotal := oldTotal + aLineItem total.
				total _ total + newTotal.
				salesOrderedByBook at: aLineItem item put: newTotal ].
			purchases at: 'total amount' put: total.
			purchases.
		].! !

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/14/2021 16:49:59'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/14/2021 16:50:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/14/2021 16:50:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/14/2021 16:50:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/14/2021 16:50:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/14/2021 16:50:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/14/2021 16:50:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/14/2021 16:50:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/14/2021 16:50:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/14/2021 16:50:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/14/2021 16:50:07'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/14/2021 16:50:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/14/2021 16:50:07'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/14/2021 16:50:07'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/14/2021 16:50:07'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/14/2021 16:50:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/14/2021 16:50:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 16:50:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 16:50:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 16:50:07'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/14/2021 16:50:11'!
ERROR!
!SalesBook methodsFor: 'as yet unclassified' stamp: 'GRC 11/14/2021 16:50:32' prior: 50965317!
listOn: salesOrderedByBook

	^sales inject: salesOrderedByBook
		into: [ :purchases :aSale | | total |
			total _ 0.
			aSale lineItemsDo: [ :aLineItem | | oldTotal newTotal |
				oldTotal := salesOrderedByBook at: aLineItem item ifAbsentPut: [ 0 ].
				newTotal := oldTotal + aLineItem total.
				total _ total + newTotal.
				salesOrderedByBook at: aLineItem item put: newTotal ].
			purchases at: 'total amount' put: total.
			purchases.
		].! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/14/2021 16:50:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/14/2021 16:50:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/14/2021 16:50:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/14/2021 16:50:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/14/2021 16:50:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/14/2021 16:50:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/14/2021 16:50:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/14/2021 16:50:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/14/2021 16:50:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/14/2021 16:50:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/14/2021 16:50:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/14/2021 16:50:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/14/2021 16:50:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/14/2021 16:50:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/14/2021 16:50:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/14/2021 16:50:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 16:50:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 16:50:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/14/2021 16:50:39'!
PASSED!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/14/2021 16:50:45' prior: 50965223!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [
		salesBook listOn: Dictionary new.
	].! !

----SNAPSHOT----(14 November 2021 16:52:04) CuisUniversity-4972.image priorSource: 20263604!

----QUIT----(14 November 2021 16:52:07) CuisUniversity-4972.image priorSource: 20283540!

----STARTUP---- (15 November 2021 10:00:53) as C:\Users\Guido\Desktop\windows64\CuisUniversity-4972.image!

!Sale methodsFor: 'line items' stamp: 'GRC 11/15/2021 10:00:58' prior: 50962968!
lineItemsDo: aBlock

	^ticket lineItemsDo: aBlock ! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/15/2021 10:01:16' prior: 50963205!
listCartIdentifiedAs: aCartId

	^ self withCartSessionIdentifiedAs: aCartId do: [ :cartSession | cartSession cartContent ]! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/15/2021 10:01:37' prior: 50963176!
checkOutCartIdentifiedAs: aCartId withCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	self
		withCartSessionIdentifiedAs: aCartId
		do: [ :cartSession | cartSession
			checkOutCartWithCreditCardNumbered: aCreditCartNumber
			ownedBy: anOwner
			expiringOn: anExpirationMonthOfYear ]
! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/15/2021 10:01:40' prior: 50963191!
createCartFor: aUser authenticatedWith: aPassword

	^ self if: aUser authenticatesWith: aPassword do: [ | cartId cartSession |

		cartId := self generateCartId.
		cartSession := CartSession ownedBy: aUser with: (Cart acceptingItemsOf: catalog) on: self..
		cartSessions at: cartId put: cartSession.

		cartId  ]! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/15/2021 10:01:43' prior: 50963167!
add: anAmount of: aBook toCartIdentifiedAs: aCartId

	self withCartSessionIdentifiedAs: aCartId do: [ :cartSession | cartSession addToCart: anAmount of: aBook ]! !

!methodRemoval: TusLibrosSystemFacade #list:on: stamp: 'GRC 11/15/2021 10:02:11'!
list: aSale on: salesOrderedByBook

	"Esto es un indicio de que por ahi conviene empezar a pensar en modelar un SaleBook - Hernan"
	aSale lineItemsDo: [ :aLineItem | | oldTotal newTotal |
		oldTotal := salesOrderedByBook at: aLineItem item ifAbsentPut: [ 0 ].
		newTotal := oldTotal + aLineItem total.
		salesOrderedByBook at: aLineItem item put: newTotal ]!

!methodRemoval: TusLibrosSystemFacade #salesDoneBy: stamp: 'GRC 11/15/2021 10:03:00'!
salesDoneBy: aUser

	"Esto es un indicio de que por ahi conviene empezar a pensar en modelar un SaleBook - Hernan"
	^ salesBook select: [ :aSale | aSale wasDoneBy: aUser ]!
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/15/2021 10:05:40'!
test17ListPurchasesOnlyIncludesUserPurchases

	| cartId cartid2 purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	cartId _ systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword. 
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: (testObjectsFactory itemSellByTheStorePrice * 2).
	self assert: (purchases at: self anotherValidBook) equals: testObjectsFactory anotherItemSellByTheStorePrice.
	self assert: (purchases at: 'total amount') equals: 35.! !
!TusLibrosSystemFacadeTest methodsFor: 'test objects' stamp: 'GRC 11/15/2021 10:06:00'!
anotherValidUser

	^'validUser2'! !
!TusLibrosSystemFacadeTest methodsFor: 'test objects' stamp: 'GRC 11/15/2021 10:06:47' prior: 50963823!
validUsersAndPasswords

	^Dictionary new
		at: self validUser put: self validUserPassword;
		at: self anotherValidUser put: self validUserPassword;
		yourself! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/15/2021 10:06:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/15/2021 10:06:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/15/2021 10:06:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/15/2021 10:06:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/15/2021 10:06:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/15/2021 10:06:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/15/2021 10:06:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/15/2021 10:06:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/15/2021 10:06:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/15/2021 10:06:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/15/2021 10:06:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/15/2021 10:06:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/15/2021 10:06:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/15/2021 10:06:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/15/2021 10:06:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/15/2021 10:06:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 10:06:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/15/2021 10:06:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 10:06:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 10:06:51'!
PASSED!
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/15/2021 10:08:15' prior: 50965593!
test17ListPurchasesOnlyIncludesUserPurchases

	| cartId cartId2 purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	cartId2 _ systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword. 
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId2.
	
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: (testObjectsFactory itemSellByTheStorePrice * 2).
	self assert: (purchases at: self anotherValidBook) equals: testObjectsFactory anotherItemSellByTheStorePrice.
	self assert: (purchases at: 'total amount') equals: 35.! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/15/2021 10:08:29' prior: 50965716!
test17ListPurchasesOnlyIncludesUserPurchases

	| cartId cartId2 purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	cartId2 _ systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword. 
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId2.
	
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.
		
	systemFacade
		checkOutCartIdentifiedAs: cartId2
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: (testObjectsFactory itemSellByTheStorePrice * 2).
	self assert: (purchases at: self anotherValidBook) equals: testObjectsFactory anotherItemSellByTheStorePrice.
	self assert: (purchases at: 'total amount') equals: 35.! !

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/15/2021 10:08:30'!
FAILURE!
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/15/2021 10:08:55' prior: 50965753!
test17ListPurchasesOnlyIncludesUserPurchases

	| cartId cartId2 purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	cartId2 _ systemFacade createCartFor: self anotherValidUser authenticatedWith: self validUserPassword. 
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId2.
	
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.
		
	systemFacade
		checkOutCartIdentifiedAs: cartId2
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: (testObjectsFactory itemSellByTheStorePrice * 2).
	self assert: (purchases at: self anotherValidBook) equals: testObjectsFactory anotherItemSellByTheStorePrice.
	self assert: (purchases at: 'total amount') equals: 35.! !

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/15/2021 10:08:56'!
FAILURE!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/15/2021 10:11:37' prior: 50965504!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [
		salesBook listPurchasesOf: aUser on: Dictionary new.
	].! !
!SalesBook methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 10:13:10'!
listPurchasesOf: aUser on: salesOrderedByBook

	^sales inject: salesOrderedByBook
		into: [ :purchases :aSale | | total |
			total _ 0.
			(aSale wasDoneBy: aUser) ifTrue: [ aSale lineItemsDo: [ :aLineItem | | oldTotal newTotal |
				oldTotal := salesOrderedByBook at: aLineItem item ifAbsentPut: [ 0 ].
				newTotal := oldTotal + aLineItem total.
				total _ total + newTotal.
				salesOrderedByBook at: aLineItem item put: newTotal ] ].
			purchases at: 'total amount' put: total.
			purchases.
		].! !
!SalesBook methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 10:16:14'!
register: aSale on: aTicket

	| total |

	total _ 0.

	aSale lineItemsDo: [ :aLineItem | | oldTotal newTotal |
				oldTotal := aTicket at: aLineItem item ifAbsentPut: [ 0 ].
				newTotal := oldTotal + aLineItem total.
				total _ total + newTotal.
				aTicket at: aLineItem item put: newTotal ].
			
	^total.! !
!SalesBook methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 10:16:59' prior: 50965853!
listPurchasesOf: aUser on: salesOrderedByBook

	^sales inject: salesOrderedByBook
		into: [ :purchases :aSale | | total |
			total _ 0.
			(aSale wasDoneBy: aUser) ifTrue: [ total _ total + self register: aSale on: purchases].
			purchases at: 'total amount' put: total.
			purchases.
		].! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'GRC 11/15/2021 10:17:17'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'GRC 11/15/2021 10:17:17'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'GRC 11/15/2021 10:17:17'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'GRC 11/15/2021 10:17:17'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'GRC 11/15/2021 10:17:17'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'GRC 11/15/2021 10:17:17'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'GRC 11/15/2021 10:17:17'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/15/2021 10:17:18'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/15/2021 10:17:18'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/15/2021 10:17:18'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 10:17:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/15/2021 10:18:12'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/15/2021 10:18:12'!
ERROR!
!SalesBook methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 10:18:35' prior: 50965885!
listPurchasesOf: aUser on: salesOrderedByBook

	^sales inject: salesOrderedByBook
		into: [ :purchases :aSale | | total |
			total _ 0.
			(aSale wasDoneBy: aUser) ifTrue: [ total _ total + (self register: aSale on: purchases)].
			purchases at: 'total amount' put: total.
			purchases.
		].! !

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/15/2021 10:18:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/15/2021 10:18:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/15/2021 10:18:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/15/2021 10:18:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/15/2021 10:18:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/15/2021 10:18:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/15/2021 10:18:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/15/2021 10:18:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/15/2021 10:18:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/15/2021 10:18:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/15/2021 10:18:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/15/2021 10:18:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/15/2021 10:18:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/15/2021 10:18:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/15/2021 10:18:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/15/2021 10:18:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/15/2021 10:18:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/15/2021 10:18:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/15/2021 10:18:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 10:18:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/15/2021 10:18:43'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 10:18:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 10:18:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/15/2021 10:18:43'!
FAILURE!
!SalesBook methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 10:20:23' prior: 50966027!
listPurchasesOf: aUser on: salesOrderedByBook

	| total |
	
	total _ 0.

	^sales inject: salesOrderedByBook
		into: [ :purchases :aSale |
			(aSale wasDoneBy: aUser) ifTrue: [ total _ total + (self register: aSale on: purchases)].
			purchases at: 'total amount' put: total.
			purchases.
		].! !

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/15/2021 10:20:37'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/15/2021 10:20:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/15/2021 10:20:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/15/2021 10:20:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/15/2021 10:20:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/15/2021 10:20:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/15/2021 10:20:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/15/2021 10:20:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/15/2021 10:20:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/15/2021 10:20:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/15/2021 10:20:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/15/2021 10:20:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/15/2021 10:20:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/15/2021 10:20:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/15/2021 10:20:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/15/2021 10:20:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/15/2021 10:20:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/15/2021 10:20:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 10:20:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/15/2021 10:20:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 10:20:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 10:20:40'!
PASSED!
!Cashier methodsFor: 'checkout - private' stamp: 'GRC 11/15/2021 10:22:15' prior: 50962700!
createTicket

	| lineItems |

	lineItems := OrderedCollection new.
	cart itemsAndQuantitiesDo: [ :anItem :aQuantity |
		lineItems add: (self createLineItemOf: anItem quantity: aQuantity)].

	ticket := Ticket of: lineItems
	! !
!Cashier methodsFor: 'checkout - private' stamp: 'GRC 11/15/2021 10:22:22' prior: 50966227!
createTicket

	| lineItems |

	lineItems := OrderedCollection new.
	cart itemsAndQuantitiesDo: [ :anItem :aQuantity |
		lineItems add: (self createLineItemOf: anItem quantity: aQuantity)].

	ticket := Ticket of: lineItems.! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/15/2021 10:25:04'!
test18CanListPurchasesOfUserWithNoPurchases

	self
		should: [systemFacade listPurchasesOf: self validUser authenticatingWith: self invalidPassword ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidUserAndOrPasswordErrorDescription ]! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/15/2021 10:26:07' prior: 50966248!
test18CanListPurchasesOfUserWithNoPurchases

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: purchases size equals: 1.
	self assert: (purchases at: 'total amount') equals: 0.! !

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/15/2021 10:26:08'!
FAILURE!
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/15/2021 10:26:34' prior: 50966262!
test18CanListPurchasesOfUserWithNoPurchases

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: purchases size equals: 0.! !

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/15/2021 10:26:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/15/2021 10:26:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/15/2021 10:26:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/15/2021 10:26:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/15/2021 10:26:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/15/2021 10:26:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/15/2021 10:26:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/15/2021 10:26:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/15/2021 10:26:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/15/2021 10:26:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/15/2021 10:26:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/15/2021 10:26:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/15/2021 10:26:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/15/2021 10:26:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/15/2021 10:26:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/15/2021 10:26:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/15/2021 10:26:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 10:26:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/15/2021 10:26:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/15/2021 10:26:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 10:26:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 10:26:36'!
PASSED!

!methodRemoval: SalesBook #listOn: stamp: 'GRC 11/15/2021 10:27:24'!
listOn: salesOrderedByBook

	^sales inject: salesOrderedByBook
		into: [ :purchases :aSale | | total |
			total _ 0.
			aSale lineItemsDo: [ :aLineItem | | oldTotal newTotal |
				oldTotal := salesOrderedByBook at: aLineItem item ifAbsentPut: [ 0 ].
				newTotal := oldTotal + aLineItem total.
				total _ total + newTotal.
				salesOrderedByBook at: aLineItem item put: newTotal ].
			purchases at: 'total amount' put: total.
			purchases.
		].!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/15/2021 10:27:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 10:27:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/15/2021 10:27:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/15/2021 10:27:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 10:27:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 10:27:30'!
PASSED!
!SalesBook methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 10:29:43' prior: 50966131!
listPurchasesOf: aUser on: userPurchases

	| total |
	
	total _ 0.

	^sales inject: userPurchases
		into: [ :purchases :aSale |
			(aSale wasDoneBy: aUser) ifTrue: [ total _ total + (self register: aSale on: purchases)].
			userPurchases at: 'total amount' put: total.
			userPurchases.
		].! !
!SalesBook methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 10:30:32' prior: 50966529!
listPurchasesOf: aUser on: userPurchases

	| total |
	
	total _ 0.

	^sales inject: userPurchases
		into: [ :purchases :aSale |
			(aSale wasDoneBy: aUser) ifTrue: [ total _ total + (self register: aSale on: purchases)].
			purchases at: 'total amount' put: total.
			purchases.
		].! !

----SNAPSHOT----(15 November 2021 10:32:53) CuisUniversity-4972.image priorSource: 20283634!

----SNAPSHOT----(15 November 2021 10:37:30) CuisUniversity-4972.image priorSource: 20316894!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 10:38:42' prior: 50925277!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionId |
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		transactionId := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: cced.
		
		aRequest send200Response: transactionId.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 10:38:49' prior: 50925260!
addToCartAction: aRequest	
	[ | cartId bookIsbn bookQuantity |
		cartId := (aRequest fields at: 'cartId') asNumber.
		bookIsbn := aRequest fields at: 'bookIsbn'.
		bookQuantity := (aRequest fields at: 'bookQuantity') asNumber.
		
		tusLibros add: bookQuantity of: bookIsbn toCartIdentifiedAs: cartId.
	
		aRequest send200Response: 'OK'.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 10:38:52' prior: 50925296!
createCartAction: aRequest
	[ | clientId password cartId result  |
		clientId := aRequest fields at: 'clientId'.
		password := aRequest fields at: 'password'.
		
		cartId := tusLibros createCartFor: clientId authenticatedWith: password.
	
		result := WebUtils jsonEncode: cartId.
		aRequest send200Response: result
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 10:38:55' prior: 50925312!
listCartAction: aRequest	
	[ | cartId result cartContent resultDict |
		cartId := (aRequest fields at: 'cartId') asNumber.
		
		cartContent := tusLibros listCartIdentifiedAs: cartId.

		resultDict := Dictionary new.
		cartContent contents keysAndValuesDo: [ :anItem :aQuantity | resultDict add: anItem->aQuantity ].
		result := WebUtils jsonEncode: resultDict.
		
		aRequest send200Response: result.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'initialization' stamp: 'GRC 11/15/2021 10:43:55' prior: 50925233!
initializeWith: aPortNumber
	
	port := aPortNumber.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: self defaultCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: (ManualClock now: DateAndTime now).
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action: [:aRequest | self createCartAction: aRequest].
	webServer addService: '/addToCart' action: [:aRequest | self addToCartAction: aRequest].
	webServer addService: '/listCart' action: [:aRequest | self listCartAction: aRequest].
	webServer addService: '/checkOutCart' action: [:aRequest | self checkOutCartAction: aRequest].
! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 10:45:43' prior: 50925227!
validUsersAndPasswords

	^Dictionary new
		at: 'validUser' put: 'validUserPassword';
		at: 'anotherValidUser' put: 'validUserPassword';
		yourself! !
!TusLibrosRestInterface methodsFor: 'initialization' stamp: 'GRC 11/15/2021 10:52:03' prior: 50966631!
initializeWith: aPortNumber
	
	port := aPortNumber.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: self defaultCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: (ManualClock now: DateAndTime now).
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action: [:aRequest | self createCartAction: aRequest].
	webServer addService: '/addToCart' action: [:aRequest | self addToCartAction: aRequest].
	webServer addService: '/listCart' action: [:aRequest | self listCartAction: aRequest].
	webServer addService: '/checkoutCart' action: [:aRequest | self checkOutCartAction: aRequest].
! !

----SNAPSHOT----(15 November 2021 10:54:02) CuisUniversity-4972.image priorSource: 20316988!

server _ TusLibrosRestInterface listeningOn: 8080.!

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 11:04:31' prior: 50966560!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionId |
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := (aRequest fields at: 'ccn') asNumber.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		transactionId := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: cced.
		
		aRequest send200Response: transactionId.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 11:04:47' prior: 50966699!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionId |
		cartId := aRequest fields at: 'cartId'.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		transactionId := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: cced.
		
		aRequest send200Response: transactionId.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

month _ Month month: 11 year: 2022.!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\TerseGuide.pck.st----!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 11:15:11' prior: 50966718!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionId expMonth expYear expirationDate |
		cartId := aRequest fields at: 'cartId'.
		ccn := aRequest fields at: 'ccn'.
		cced := (aRequest fields at: 'cced') storeString.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ cced copyFrom: 1 to: 2.
		expYear _ cced copyFrom: 4 to: 8.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionId := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: cced.
		
		aRequest send200Response: transactionId.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 11:15:23' prior: 50969663!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionId expMonth expYear expirationDate |
		cartId := aRequest fields at: 'cartId'.
		ccn := aRequest fields at: 'ccn'.
		cced := (aRequest fields at: 'cced') storeString.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ cced copyFrom: 1 to: 2.
		expYear _ cced copyFrom: 4 to: 8.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionId := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		aRequest send200Response: transactionId.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

'11/2022' copyFrom: 1 to: 2.!

'11/2022' copyFrom: 4 to: 8.!

'11/2022' copyFrom: 4 to: 7.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 11:16:15' prior: 50969687!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionId expMonth expYear expirationDate |
		cartId := aRequest fields at: 'cartId'.
		ccn := aRequest fields at: 'ccn'.
		cced := (aRequest fields at: 'cced') storeString.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ cced copyFrom: 1 to: 2.
		expYear _ cced copyFrom: 4 to: 7.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionId := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		aRequest send200Response: transactionId.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

11/2022 storeString.!

cced _ 11/2022 storeString.!

cced _ '11/2022' storeString.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 11:18:47' prior: 50969714!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionId expMonth expYear expirationDate |
		cartId := aRequest fields at: 'cartId'.
		ccn := aRequest fields at: 'ccn'.
		cced := (aRequest fields at: 'cced') storeString.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ cced copyFrom: 2 to: 3.
		expYear _ cced copyFrom: 5 to: 8.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionId := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		aRequest send200Response: transactionId.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 11:19:39' prior: 50969743!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionId expMonth expYear expirationDate |
		cartId := aRequest fields at: 'cartId'.
		ccn := aRequest fields at: 'ccn'.
		cced := (aRequest fields at: 'cced') storeString.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 2 to: 3) asNumber .
		expYear _ (cced copyFrom: 5 to: 8) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionId := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		aRequest send200Response: transactionId.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

month _ Month month: 11 year: 2022.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 11:19:53' prior: 50969770!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionId expMonth expYear expirationDate |
		cartId := aRequest fields at: 'cartId'.
		ccn := aRequest fields at: 'ccn'.
		cced := (aRequest fields at: 'cced') storeString.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 2 to: 3) asNumber.
		expYear _ (cced copyFrom: 5 to: 8) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionId := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		aRequest send200Response: transactionId.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

'11' asNumber!

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 11:21:29' prior: 50969796!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionId expMonth expYear expirationDate |
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := (aRequest fields at: 'ccn') asNumber.
		cced := (aRequest fields at: 'cced') storeString.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 2 to: 3) asNumber.
		expYear _ (cced copyFrom: 5 to: 8) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionId := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		aRequest send200Response: transactionId.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

----SNAPSHOT----(15 November 2021 11:22:41) CuisUniversity-4972.image priorSource: 20321311!
!MerchantProcessor methodsFor: 'debit' stamp: 'GRC 11/15/2021 11:26:37' prior: 50962935!
debit: anAmount from: aCreditCard! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 11:29:20' prior: 50969824!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionTotal expMonth expYear expirationDate |
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := (aRequest fields at: 'ccn') asNumber.
		cced := (aRequest fields at: 'cced') storeString.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 2 to: 3) asNumber.
		expYear _ (cced copyFrom: 5 to: 8) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionTotal := (tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate) total.
		
		aRequest send200Response: transactionTotal.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

server destroy.!

server destroy.!
!Cashier methodsFor: 'checkout' stamp: 'GRC 11/15/2021 11:31:20' prior: 50962728!
checkOut

	self createTicket.
	self debitTotal.
	self registerSale.

	^ ticket ! !

----SNAPSHOT----(15 November 2021 11:31:44) CuisUniversity-4972.image priorSource: 20422418!

----QUIT----(15 November 2021 11:31:47) CuisUniversity-4972.image priorSource: 20423858!

----STARTUP---- (15 November 2021 15:04:08) as C:\Users\Guido\Desktop\windows64\CuisUniversity-4972.image!


server _ TusLibrosRestInterface listeningOn: 8080.!
!CartSession methodsFor: 'cart' stamp: 'GRC 11/15/2021 15:11:57' prior: 50962636!
checkOutCartWithCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	^(Cashier
		toCheckout: cart
		ownedBy: owner
		charging: (CreditCard expiringOn: anExpirationMonthOfYear)
		throught: systemFacade merchantProcessor
		on: self today
		registeringOn: systemFacade salesBook) checkOut ! !
!Cashier methodsFor: 'checkout - private' stamp: 'GRC 11/15/2021 15:12:50' prior: 50962717!
registerSale

	salesBook add: self createSale! !

webRequest _ WebRequest readFrom: 'http://localhost:8080/checkoutCart?cartId=1&ccn=1111222233334444&cced=11/2022&cco=Juan Perez'.!

webRequest _ WebRequest readFrom: 'checkoutCart?cartId=1&ccn=1111222233334444&cced=11/2022&cco=Juan Perez'.!
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'GRC 11/15/2021 15:18:23' prior: 50963830!
test10CanCheckoutACart

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
		ownedBy: testObjectsFactory notExpiredCreditCardOwner
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: testObjectsFactory itemSellByTheStorePrice.
! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'GRC 11/15/2021 15:19:27'!
test20CanCheckoutACart

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: 1.
	systemFacade
		checkOutCartIdentifiedAs: 1
		withCreditCardNumbered: 1111222233334444
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: testObjectsFactory itemSellByTheStorePrice.
! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'GRC 11/15/2021 15:20:10' prior: 50969958!
test20CanCheckoutACart

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: 1.
	systemFacade
		checkOutCartIdentifiedAs: 1
		withCreditCardNumbered: 1111222233334444
		ownedBy: 'Juan Perez'
		expiringOn: (Month month: 11 year: 2022).

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: testObjectsFactory itemSellByTheStorePrice.
! !

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/15/2021 15:20:18'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/15/2021 15:20:18'!
FAILURE!
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'GRC 11/15/2021 15:20:31' prior: 50969980!
test20CanCheckoutACart

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: 1.
	systemFacade
		checkOutCartIdentifiedAs: 1
		withCreditCardNumbered: 1111222233334444
		ownedBy: 'Juan Perez'
		expiringOn: (Month month: 11 year: 2022).

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: 20.
! !

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/15/2021 15:20:35'!
PASSED!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 15:21:24' prior: 50969862!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionTotal expMonth expYear expirationDate |
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := (aRequest fields at: 'ccn') asNumber.
		cced := (aRequest fields at: 'cced') storeString.
		cco := (aRequest fields at: 'cco') storeString.
		
		expMonth _ (cced copyFrom: 2 to: 3) asNumber.
		expYear _ (cced copyFrom: 5 to: 8) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionTotal := (tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate) total.
		
		aRequest send200Response: transactionTotal.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.
!
!WebRequest methodsFor: 'initialize' stamp: 'GRC 11/15/2021 15:22:52' prior: 50958042!
readFrom: aStream
	"Initialize the receiver initialized from an existing socket stream 
	This method will block until the headers have been parsed."

	| tokens |
	stream := aStream.
	stream isBinary ifTrue:[stream ascii].
	"Parse request header"
	request := stream upToAll: String crlfString.
	tokens := request findTokens: ' '.
	tokens size < 2 ifTrue:[^self error: 'Invalid HTTP request: ', request].
	method := tokens first.
	rawUrl := tokens second.
	tokens size > 2 
		ifTrue:[protocol := tokens third]
		ifFalse:[protocol := 'HTTP/1.0'].

	"Parse HTTP header"
	headers := WebUtils readHeadersFrom: stream.
! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 15:25:56' prior: 50970031!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionTotal expMonth expYear expirationDate |
		cartId := 1.
		ccn := 1111222233334444.
		cced := '11/2022' storeString.
		cco := 'Juan Perez' storeString.
		
		expMonth _ (cced copyFrom: 2 to: 3) asNumber.
		expYear _ (cced copyFrom: 5 to: 8) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionTotal := (tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate) total.
		
		aRequest send200Response: transactionTotal.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 15:26:41' prior: 50970083!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionTotal expMonth expYear expirationDate |
		cartId := 1.
		ccn := 1111222233334444.
		cced := (aRequest fields at: 'cced') storeString.
		cco := 'Juan Perez' storeString.
		
		expMonth _ (cced copyFrom: 2 to: 3) asNumber.
		expYear _ (cced copyFrom: 5 to: 8) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionTotal := (tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate) total.
		
		aRequest send200Response: transactionTotal.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

cartId := 1.!

ccn := 1111222233334444.!

cced := '11/2022' storeString.!

cco := 'Juan Perez' storeString.!

cced := '11/2022' storeString.!

cco := 'Juan Perez' storeString.!

expMonth _ (cced copyFrom: 2 to: 3) asNumber.!

expYear _ (cced copyFrom: 5 to: 8) asNumber.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 15:30:41' prior: 50970109!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionTotal expMonth expYear expirationDate |
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := (aRequest fields at: 'ccn') asNumber.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionTotal := (tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate) total.
		
		aRequest send200Response: transactionTotal.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 15:31:40' prior: 50970142!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionTotal expMonth expYear expirationDate |
		cartId := aRequest fields at: 'cartId'.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionTotal := (tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate) total.
		
		aRequest send200Response: transactionTotal.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 15:32:05' prior: 50970170!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionTotal expMonth expYear expirationDate |
		cartId := aRequest fields at: 'cartId'.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionTotal := (tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate) total.
		
		aRequest send200Response: transactionTotal.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 15:32:47' prior: 50970198!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionTotal expMonth expYear expirationDate |
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionTotal := (tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate) total.
		
		aRequest send200Response: transactionTotal.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

Month month: 11 year: 2022!
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'GRC 11/15/2021 15:35:58' prior: 50969934!
test10CanCheckoutACart

	| cartId purchases exp |

	exp _ testObjectsFactory notExpiredMonthOfYear.

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
		ownedBy: testObjectsFactory notExpiredCreditCardOwner
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: testObjectsFactory itemSellByTheStorePrice.
! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'GRC 11/15/2021 15:36:32' prior: 50970252!
test10CanCheckoutACart

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
		ownedBy: testObjectsFactory notExpiredCreditCardOwner
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: testObjectsFactory itemSellByTheStorePrice.
! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 15:37:13' prior: 50970223!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionId expMonth expYear expirationDate |
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionId := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		aRequest send200Response: transactionId.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'initialization' stamp: 'GRC 11/15/2021 15:47:55' prior: 50966666!
initializeWith: aPortNumber
	
	port := aPortNumber.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: self defaultCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: (ManualClock now: DateAndTime now).
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action: [:aRequest | self createCartAction: aRequest].
	webServer addService: '/addToCart' action: [:aRequest | self addToCartAction: aRequest].
	webServer addService: '/listCart' action: [:aRequest | self listCartAction: aRequest].
	webServer addService: '/checkoutCart' action: [:aRequest | self checkOutCartAction: aRequest].
	webServer addService: '/listPurchases' action: [:aRequest | self checkOutCartAction: aRequest].
! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 15:48:27'!
listPurchasesAction: aRequest
	[ | clientId password cartId result  |
		clientId := aRequest fields at: 'clientId'.
		password := aRequest fields at: 'password'.
		
		cartId := tusLibros createCartFor: clientId authenticatedWith: password.
	
		result := WebUtils jsonEncode: cartId.
		aRequest send200Response: result
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'initialization' stamp: 'GRC 11/15/2021 15:48:36' prior: 50970327!
initializeWith: aPortNumber
	
	port := aPortNumber.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: self defaultCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: (ManualClock now: DateAndTime now).
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action: [:aRequest | self createCartAction: aRequest].
	webServer addService: '/addToCart' action: [:aRequest | self addToCartAction: aRequest].
	webServer addService: '/listCart' action: [:aRequest | self listCartAction: aRequest].
	webServer addService: '/checkoutCart' action: [:aRequest | self checkOutCartAction: aRequest].
	webServer addService: '/listPurchases' action: [:aRequest | self listPurchasesAction: aRequest].
! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 15:49:53' prior: 50970356!
listPurchasesAction: aRequest
	[ | clientId password cartId result  |
		clientId := aRequest fields at: 'clientId'.
		password := aRequest fields at: 'password'.
		
		cartId := tusLibros listPurchasesOf: clientId authenticatingWith: password.
	
		result := WebUtils jsonEncode: cartId.
		aRequest send200Response: result
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 15:50:23' prior: 50970402!
listPurchasesAction: aRequest
	[ | clientId password cartId purchases result  |
		clientId := aRequest fields at: 'clientId'.
		password := aRequest fields at: 'password'.
		
		purchases := tusLibros listPurchasesOf: clientId authenticatingWith: password.
	
		result := WebUtils jsonEncode: cartId.
		aRequest send200Response: result
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 15:50:36' prior: 50970418!
listPurchasesAction: aRequest
	[ | clientId password purchases result  |
		clientId := aRequest fields at: 'clientId'.
		password := aRequest fields at: 'password'.
		
		purchases := tusLibros listPurchasesOf: clientId authenticatingWith: password.
	
		result := WebUtils jsonEncode: purchases.
		aRequest send200Response: result
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 15:51:33' prior: 50970435!
listPurchasesAction: aRequest
	[ | clientId password purchases resultDict result |
		clientId := aRequest fields at: 'clientId'.
		password := aRequest fields at: 'password'.
		
		purchases := tusLibros listPurchasesOf: clientId authenticatingWith: password.
	
		resultDict := Dictionary new.
		purchases contents keysAndValuesDo: [ :anItem :aQuantity | resultDict add: anItem->aQuantity ].
		result := WebUtils jsonEncode: resultDict.
		
		aRequest send200Response: result
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 15:52:15' prior: 50970452!
listPurchasesAction: aRequest
	[ | clientId password purchases resultDict result |
		clientId := aRequest fields at: 'clientId'.
		password := aRequest fields at: 'password'.
		
		purchases := tusLibros listPurchasesOf: clientId authenticatingWith: password.
	
		"resultDict := Dictionary new.
		purchases contents keysAndValuesDo: [ :anItem :aQuantity | resultDict add: anItem->aQuantity ]."
		result := WebUtils jsonEncode: purchases.
		
		aRequest send200Response: result
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 15:54:39' prior: 50970473!
listPurchasesAction: aRequest
	[ | clientId password purchases result |
		clientId := aRequest fields at: 'clientId'.
		password := aRequest fields at: 'password'.
		
		purchases := tusLibros listPurchasesOf: clientId authenticatingWith: password.
		
		result := WebUtils jsonEncode: purchases.
		
		aRequest send200Response: result
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/15/2021 15:54:59' prior: 50965534!
checkOutCartIdentifiedAs: aCartId withCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	self
		withCartSessionIdentifiedAs: aCartId
		do: [ :cartSession | cartSession
			checkOutCartWithCreditCardNumbered: aCreditCartNumber
			ownedBy: anOwner
			expiringOn: anExpirationMonthOfYear ].
		
	^1.
! !

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/15/2021 15:55:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/15/2021 15:55:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/15/2021 15:55:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/15/2021 15:55:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/15/2021 15:55:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/15/2021 15:55:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/15/2021 15:55:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/15/2021 15:55:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/15/2021 15:55:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/15/2021 15:55:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/15/2021 15:55:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/15/2021 15:55:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/15/2021 15:55:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/15/2021 15:55:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/15/2021 15:55:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/15/2021 15:55:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/15/2021 15:55:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 15:55:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/15/2021 15:55:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/15/2021 15:55:10'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 15:55:10'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 15:55:10'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/15/2021 15:55:10'!
PASSED!

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 15:56:33' prior: 50970302!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionId expMonth expYear expirationDate result |
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionId := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		result := WebUtils jsonEncode: transactionId .
		
		aRequest send200Response: result.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!
!SalesBook methodsFor: 'list purchases' stamp: 'GRC 11/15/2021 15:58:27' prior: 50966542!
listPurchasesOf: aUser on: userPurchases

	| total |
	
	total _ 0.

	^sales inject: userPurchases
		into: [ :purchases :aSale |
			(aSale wasDoneBy: aUser) ifTrue: [ total _ total + (self register: aSale on: purchases)].
			purchases at: 'totalAmount' put: total.
			purchases.
		].! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/15/2021 15:59:04' prior: 50964401!
test14ListPurchasesIncludesBoughtItems

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: (testObjectsFactory itemSellByTheStorePrice * 2).
	self assert: (purchases at: self anotherValidBook) equals: testObjectsFactory anotherItemSellByTheStorePrice.
	self assert: (purchases at: 'totalAmount') equals: 35.! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/15/2021 15:59:12' prior: 50965799!
test17ListPurchasesOnlyIncludesUserPurchases

	| cartId cartId2 purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	cartId2 _ systemFacade createCartFor: self anotherValidUser authenticatedWith: self validUserPassword. 
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId2.
	
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.
		
	systemFacade
		checkOutCartIdentifiedAs: cartId2
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: (testObjectsFactory itemSellByTheStorePrice * 2).
	self assert: (purchases at: self anotherValidBook) equals: testObjectsFactory anotherItemSellByTheStorePrice.
	self assert: (purchases at: 'totalAmount') equals: 35.! !

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/15/2021 15:59:16'!
PASSED!
!LineItem methodsFor: 'accessing' stamp: 'GRC 11/15/2021 16:03:22'!
quantity

	^quantity.! !
!SalesBook methodsFor: 'list purchases' stamp: 'GRC 11/15/2021 16:03:37' prior: 50965872!
register: aSale on: aTicket

	| total |

	total _ 0.

	aSale lineItemsDo: [ :aLineItem | | oldTotal newTotal |
				oldTotal := aTicket at: aLineItem item ifAbsentPut: [ 0 ].
				newTotal := oldTotal + aLineItem total.
				total _ total + newTotal.
				aTicket at: aLineItem item put: aLineItem quantity].
			
	^total.! !

server destroy.!

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/15/2021 16:04:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/15/2021 16:04:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/15/2021 16:04:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/15/2021 16:04:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/15/2021 16:04:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/15/2021 16:04:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/15/2021 16:04:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/15/2021 16:04:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/15/2021 16:04:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/15/2021 16:04:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/15/2021 16:04:17'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/15/2021 16:04:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/15/2021 16:04:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/15/2021 16:04:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/15/2021 16:04:17'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/15/2021 16:04:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/15/2021 16:04:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 16:04:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/15/2021 16:04:17'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/15/2021 16:04:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 16:04:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 16:04:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/15/2021 16:04:17'!
FAILURE!
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/15/2021 16:05:08' prior: 50970658!
test14ListPurchasesIncludesBoughtItems

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: 2.
	self assert: (purchases at: self anotherValidBook) equals: 1.
	self assert: (purchases at: 'totalAmount') equals: 35.! !

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/15/2021 16:05:11'!
PASSED!
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/15/2021 16:06:10' prior: 50970689!
test17ListPurchasesOnlyIncludesUserPurchases

	| cartId cartId2 purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	cartId2 _ systemFacade createCartFor: self anotherValidUser authenticatedWith: self validUserPassword. 
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId2.
	
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.
		
	systemFacade
		checkOutCartIdentifiedAs: cartId2
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: 2.
	self assert: (purchases at: self anotherValidBook) equals: 1.
	self assert: (purchases at: 'totalAmount') equals: 35.! !

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/15/2021 16:06:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/15/2021 16:06:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/15/2021 16:06:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/15/2021 16:06:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/15/2021 16:06:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/15/2021 16:06:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/15/2021 16:06:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/15/2021 16:06:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/15/2021 16:06:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/15/2021 16:06:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/15/2021 16:06:14'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/15/2021 16:06:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/15/2021 16:06:14'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/15/2021 16:06:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/15/2021 16:06:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/15/2021 16:06:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/15/2021 16:06:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 16:06:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/15/2021 16:06:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/15/2021 16:06:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 16:06:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 16:06:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/15/2021 16:06:15'!
FAILURE!
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'GRC 11/15/2021 16:06:24' prior: 50970278!
test10CanCheckoutACart

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
		ownedBy: testObjectsFactory notExpiredCreditCardOwner
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: 1.
! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'GRC 11/15/2021 16:06:41' prior: 50970008!
test20CanCheckoutACart

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: 1.
	systemFacade
		checkOutCartIdentifiedAs: 1
		withCreditCardNumbered: 1111222233334444
		ownedBy: 'Juan Perez'
		expiringOn: (Month month: 11 year: 2022).

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: 2.
! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/15/2021 16:06:45'!
PASSED!
!TusLibrosSystemFacade methodsFor: 'cart session management' stamp: 'GRC 11/15/2021 16:07:57' prior: 50963158!
withCartSessionIdentifiedAs: aCartId do: aBlock

	| cartSession |

	cartSession := cartSessions at: aCartId ifAbsent: [self signalInvalidCartId ].
	^cartSession do: aBlock
! !
!Ticket class methodsFor: 'instance creation' stamp: 'GRC 11/15/2021 16:08:50' prior: 50963024!
of: aCollectionOfLineItems
	^self new initializeOf: aCollectionOfLineItems ! !
!Ticket class methodsFor: 'instance creation' stamp: 'GRC 11/15/2021 16:08:55' prior: 50971218!
of: aCollectionOfLineItems

	^self new initializeOf: aCollectionOfLineItems ! !

----SNAPSHOT----(15 November 2021 16:18:43) CuisUniversity-4972.image priorSource: 20423952!

----SNAPSHOT----(15 November 2021 16:19:00) CuisUniversity-4972.image priorSource: 20466511!

----QUIT----(15 November 2021 16:19:16) CuisUniversity-4972.image priorSource: 20466605!

----STARTUP---- (15 November 2021 17:32:44) as C:\Users\Guido\Desktop\windows64\CuisUniversity-4972.image!


----End fileIn of \Users\Guido\Desktop\windows64\Morphic-Widgets-Extras.pck.st----!

CodePackage subclass: #ColorExtrasPackage
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Color-Extras'!

!classDefinition: #ColorExtrasPackage category: 'Color-Extras' stamp: 'Install-Color-Extras 11/15/2021 18:10:19'!
CodePackage subclass: #ColorExtrasPackage
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Color-Extras'!

ColorExtrasPackage class
	instanceVariableNames: ''!

!classDefinition: 'ColorExtrasPackage class' category: 'Color-Extras' stamp: 'Install-Color-Extras 11/15/2021 18:10:19'!
ColorExtrasPackage class
	instanceVariableNames: ''!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\Features\Color-Extras.pck.st----!

CodePackage subclass: #MorphicMisc1Package
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Misc1'!

!classDefinition: #MorphicMisc1Package category: 'Morphic-Misc1' stamp: 'Install-Morphic-Misc1 11/15/2021 18:10:20'!
CodePackage subclass: #MorphicMisc1Package
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Misc1'!
!MorphicMisc1Package commentStamp: '<historical>' prior: 0!
My purpose in life is to check that any base image methods overridden have not been updated.
See #MorphMisc1Package class>>prePackageInstall!

MorphicMisc1Package class
	instanceVariableNames: ''!

!classDefinition: 'MorphicMisc1Package class' category: 'Morphic-Misc1' stamp: 'Install-Morphic-Misc1 11/15/2021 18:10:20'!
MorphicMisc1Package class
	instanceVariableNames: ''!

----End fileIn of \Users\Guido\Desktop\windows64\Morphic-Misc1.pck.st----!

----End fileIn of \Users\Guido\Desktop\windows64\WordsClientDemo.st----!
!TusLibrosSystemFacade class methodsFor: 'instance creation' stamp: 'GRC 11/15/2021 19:13:13' prior: 50963287!
authenticatingWith: aValidUsersAndPasswords
	acceptingItemsOf: aCatalog
	registeringOn: aSalesBook
	debitingThrought: aMerchantProcessor
	measuringTimeWith: aClock

	^self new
		initializeAuthenticatingWith: aValidUsersAndPasswords
		acceptingItemsOf: aCatalog
		registeringOn: aSalesBook
		debitingThrought: aMerchantProcessor
		measuringTimeWith: aClock! !
!TusLibrosSystemFacadeTest methodsFor: 'setup' stamp: 'GRC 11/15/2021 19:27:01' prior: 50963766 overrides: 16927572!
setUp

	testObjectsFactory := StoreTestObjectsFactory new.
	clock := ManualClock now: testObjectsFactory today.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: testObjectsFactory defaultCatalog
		registeringOn: self createSalesBook
		debitingThrought: self merchantProcessor
		measuringTimeWith: clock
! !

Object subclass: #TusLibrosWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TusLibrosWindow category: 'TusLibros-View' stamp: 'GRC 11/15/2021 19:30:10'!
Object subclass: #TusLibrosWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

Object subclass: #TusLibrosWindowModel
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TusLibrosWindowModel category: 'TusLibros-View' stamp: 'GRC 11/15/2021 19:30:15'!
Object subclass: #TusLibrosWindowModel
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TusLibrosWindow class methodsFor: 'no messages' stamp: 'GRC 11/15/2021 19:30:52'!
open
	
	^self new initializeWith: 'TusLibros-Service Client Window'.! !
!TusLibrosWindow methodsFor: 'no messages' stamp: 'GRC 11/15/2021 19:31:16'!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (WordsClientWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #newWordsArrived send: #refreshListOfWords to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

Panel subclass: #TusLibrosWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TusLibrosWindow category: 'TusLibros-View' stamp: 'GRC 11/15/2021 19:31:55'!
Panel subclass: #TusLibrosWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:32:11' prior: 50981209!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TusLibrosWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #newWordsArrived send: #refreshListOfWords to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosWindow methodsFor: 'nil' stamp: 'GRC 11/15/2021 19:32:23' overrides: 50977854!
defaultExtent

	^ 1035@485
	! !
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:33:06' overrides: 50977758!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow.! !

!classDefinition: #TusLibrosWindow category: 'TusLibros-View' stamp: 'GRC 11/15/2021 19:33:39'!
Panel subclass: #TusLibrosWindow
	instanceVariableNames: 'sentenceTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:33:37'!
build1stRow
	| sendRequestButtonMorph firstRowLayoutMorph |
	
	sendRequestButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #sendWordsFromSentenceRequest  label: 'Send Request To Server'.
	
	sentenceTextBoxMorph := TextModelMorph textProvider: self model textGetter: #sentenceText textSetter: #sentenceText:. 
	sentenceTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | sentenceTextBoxMorph innerTextMorph acceptContents ] .
	sentenceTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter sentence:');
	addMorph: sentenceTextBoxMorph;
 	addMorph: sendRequestButtonMorph.
	
	^firstRowLayoutMorph.! !
!TusLibrosWindow methodsFor: 'nil' stamp: 'GRC 11/15/2021 19:33:55'!
build2ndRow
	| showInTranscriptButtonMorph secondRowLayoutMorph |
	
	showInTranscriptButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #showWordInTranscript label: 'Show Selected Word In Transcript'.	
	
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self build1stColumn2ndRow;
	addMorph: showInTranscriptButtonMorph.
	
	^secondRowLayoutMorph.
	! !
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:34:15' prior: 50981302!
build2ndRow
	| showInTranscriptButtonMorph secondRowLayoutMorph |
	
	showInTranscriptButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #showWordInTranscript label: 'Show Selected Word In Transcript'.	
	
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: showInTranscriptButtonMorph.
	
	^secondRowLayoutMorph.
	! !
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:35:05' prior: 50981274!
build1stRow

	| sendRequestButtonMorph firstRowLayoutMorph |
	
	sendRequestButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #sendWordsFromSentenceRequest  label: 'Send Request To Server'.
	
	sentenceTextBoxMorph := TextModelMorph textProvider: self model textGetter: #sentenceText textSetter: #sentenceText:. 
	sentenceTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | sentenceTextBoxMorph innerTextMorph acceptContents ] .
	sentenceTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter sentence:');
	addMorph: sentenceTextBoxMorph;
 	addMorph: sendRequestButtonMorph.
	
	^firstRowLayoutMorph.! !

TusLibrosWindow open.!
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:36:42' prior: 50981258 overrides: 50977758!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	"addMorph: self build1stRow;
	addMorph: self build2ndRow."! !

TusLibrosWindow open.!
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:37:01' prior: 50981366 overrides: 50977758!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow.
	"addMorph: self build2ndRow."! !

!classDefinition: #TusLibrosWindow category: 'TusLibros-View' stamp: 'GRC 11/15/2021 19:40:15'!
Panel subclass: #TusLibrosWindow
	instanceVariableNames: 'sentenceTextBoxMorph clientIdTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:40:14' prior: 50981336!
build1stRow

	| firstRowLayoutMorph |
	
	clientIdTextBoxMorph := TextModelMorph textProvider: self model textGetter: #sentenceText textSetter: #sentenceText:. 
	clientIdTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | clientIdTextBoxMorph innerTextMorph acceptContents ] .
	clientIdTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter sentence:');
	addMorph: clientIdTextBoxMorph.
	
	^firstRowLayoutMorph.! !

Panel subclass: #TusLibrosWindow
	instanceVariableNames: 'clientIdTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TusLibrosWindow category: 'TusLibros-View' stamp: 'GRC 11/15/2021 19:40:25'!
Panel subclass: #TusLibrosWindow
	instanceVariableNames: 'clientIdTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TusLibrosWindowModel category: 'TusLibros-View' stamp: 'GRC 11/15/2021 19:41:59'!
Object subclass: #TusLibrosWindowModel
	instanceVariableNames: 'sentence'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TusLibrosWindowModel methodsFor: 'nil' stamp: 'GRC 11/15/2021 19:41:55'!
clientIdText
	
	^sentence.! !

!classDefinition: #TusLibrosWindowModel category: 'TusLibros-View' stamp: 'GRC 11/15/2021 19:42:13'!
Object subclass: #TusLibrosWindowModel
	instanceVariableNames: 'sentence clientId'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TusLibrosWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:42:10' prior: 50981435!
clientIdText
	
	^clientId.! !
!TusLibrosWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:42:49'!
cleintIdText: aClientId

	clientId := aClientId.
	^true.! !
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:43:31' prior: 50981393!
build1stRow

	| firstRowLayoutMorph |
	
	clientIdTextBoxMorph := TextModelMorph textProvider: self model textGetter: #clientIdText textSetter: #clientIdText:. 
	clientIdTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | clientIdTextBoxMorph innerTextMorph acceptContents ] .
	clientIdTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter sentence:');
	addMorph: clientIdTextBoxMorph.
	
	^firstRowLayoutMorph.! !

TusLibrosWindow open.!
!TusLibrosWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:44:27'!
clientIdText: aClientId

	clientId := aClientId.
	^true.! !

!methodRemoval: TusLibrosWindowModel #cleintIdText: stamp: 'GRC 11/15/2021 19:44:31'!
cleintIdText: aClientId

	clientId := aClientId.
	^true.!

TusLibrosWindow open.!
!TusLibrosWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:45:57' overrides: 16896425!
initialize

	clientId := ''.! !

Object subclass: #TusLibrosWindowModel
	instanceVariableNames: 'clientId password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TusLibrosWindowModel category: 'TusLibros-View' stamp: 'GRC 11/15/2021 19:46:06'!
Object subclass: #TusLibrosWindowModel
	instanceVariableNames: 'clientId password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TusLibrosWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:46:18' prior: 50981492 overrides: 16896425!
initialize

	clientId _ ''.
	password _ ''.! !

TusLibrosWindow open.!
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:47:14' prior: 50981320!
build2ndRow

	| secondRowLayoutMorph |
	
	clientIdTextBoxMorph := TextModelMorph textProvider: self model textGetter: #clientIdText textSetter: #clientIdText:. 
	clientIdTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | clientIdTextBoxMorph innerTextMorph acceptContents ] .
	clientIdTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter sentence:');
	addMorph: clientIdTextBoxMorph.
	
	^secondRowLayoutMorph.! !

!classDefinition: #TusLibrosWindow category: 'TusLibros-View' stamp: 'GRC 11/15/2021 19:47:36'!
Panel subclass: #TusLibrosWindow
	instanceVariableNames: 'clientIdTextBoxMorph passwordTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:47:34' prior: 50981517!
build2ndRow

	| secondRowLayoutMorph |
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #clientIdText textSetter: #clientIdText:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | clientIdTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter sentence:');
	addMorph: clientIdTextBoxMorph.
	
	^secondRowLayoutMorph.! !
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:48:15' prior: 50981548!
build2ndRow

	| secondRowLayoutMorph |
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #passwordText textSetter: #passwordText:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter sentence:');
	addMorph: passwordTextBoxMorph.
	
	^secondRowLayoutMorph.! !
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:48:35' prior: 50981570!
build2ndRow

	| secondRowLayoutMorph |
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #passwordText textSetter: #passwordText:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter password:');
	addMorph: passwordTextBoxMorph.
	
	^secondRowLayoutMorph.! !
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:48:44' prior: 50981458!
build1stRow

	| firstRowLayoutMorph |
	
	clientIdTextBoxMorph := TextModelMorph textProvider: self model textGetter: #clientIdText textSetter: #clientIdText:. 
	clientIdTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | clientIdTextBoxMorph innerTextMorph acceptContents ] .
	clientIdTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter client ID:');
	addMorph: clientIdTextBoxMorph.
	
	^firstRowLayoutMorph.! !

TusLibrosWindow open.!
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:49:10' prior: 50981376 overrides: 50977758!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow.! !

TusLibrosWindow open.!
!TusLibrosWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:49:28'!
passwordText
	
	^password.! !
!TusLibrosWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:49:47'!
passwordText: aPassword

	password := aPassword.
	^true.! !

TusLibrosWindow open.!
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:50:24' prior: 50981638 overrides: 50977758!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow.! !
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:50:31'!
build3rdRow

	| secondRowLayoutMorph |
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #passwordText textSetter: #passwordText:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter password:');
	addMorph: passwordTextBoxMorph.
	
	^secondRowLayoutMorph.! !
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:53:22' prior: 50981667!
build3rdRow

	| loginButtonMorph thirdRowLayoutMorph |
	
	loginButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #sendCredentialsFromLoginRequest  label: 'login'.
		
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loginButtonMorph.
	
	^thirdRowLayoutMorph.! !

TusLibrosWindow open.!
!TusLibrosWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:54:01'!
sendCredentialsFromLoginRequest! !

!classDefinition: #TusLibrosWindowModel category: 'TusLibros-View' stamp: 'GRC 11/15/2021 19:55:06'!
Object subclass: #TusLibrosWindowModel
	instanceVariableNames: 'clientId password words'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TusLibrosWindowModel category: 'TusLibros-View' stamp: 'GRC 11/15/2021 19:55:07'!
Object subclass: #TusLibrosWindowModel
	instanceVariableNames: 'clientId password words restInterface'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TusLibrosWindowModel category: 'TusLibros-View' stamp: 'GRC 11/15/2021 19:55:08'!
Object subclass: #TusLibrosWindowModel
	instanceVariableNames: 'clientId password words restInterface sentence'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TusLibrosWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:55:03' prior: 50981704!
sendCredentialsFromLoginRequest

	words := restInterface sendWordsRequest: sentence.
	
	self triggerEvent: #newWordsArrived.! !
!TusLibrosWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:56:55' prior: 50981735!
sendCredentialsFromLoginRequest

	| cartId |
	cartId := restInterface sendLoginRequest: {clientId. password}.
	
	self triggerEvent: #newWordsArrived.! !
!TusLibrosWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:57:32' prior: 50981743!
sendCredentialsFromLoginRequest

	restInterface sendLoginRequest: {clientId. password}.
	
	self triggerEvent: #newWordsArrived.! !

!classDefinition: #TusLibrosWindowModel category: 'TusLibros-View' stamp: 'GRC 11/15/2021 19:57:57'!
Object subclass: #TusLibrosWindowModel
	instanceVariableNames: 'clientId password words restInterface sentence cartId'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TusLibrosWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 19:57:56' prior: 50981752!
sendCredentialsFromLoginRequest

	cartId _ restInterface sendLoginRequest: {clientId. password}.
	
	self triggerEvent: #newWordsArrived.! !

Object subclass: #TusLibrosInterface
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TusLibrosInterface category: 'TusLibros-View' stamp: 'GRC 11/15/2021 19:58:51'!
Object subclass: #TusLibrosInterface
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TusLibrosInterface category: 'TusLibros-View' stamp: 'GRC 11/15/2021 19:59:14'!
Object subclass: #TusLibrosInterface
	instanceVariableNames: 'port'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TusLibrosInterface methodsFor: 'no messages' stamp: 'GRC 11/15/2021 19:59:13'!
port
	
	^port ifNil: [port:=8080].! !
!TusLibrosInterface methodsFor: 'nil' stamp: 'GRC 11/15/2021 19:59:26'!
url
	
	^'http://localhost:', self port asString! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:01:22'!
sendLoginRequest: credentials

	| fieldDict resp urlEncodedSentence |

	urlEncodedSentence := self correctlyEncodeSpacesForUrlRequestParameter: credentials.	
	fieldDict := Dictionary newFromPairs: {'credentials'. urlEncodedSentence.}.		
	
	resp:= WebClient htmlSubmit: (self url,'/createCart') fields: fieldDict.
	
	resp isSuccess 
		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)) asOrderedCollection .] 
		ifFalse:[^self error: resp content].! !

TusLibrosWindow open.!
!TusLibrosWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:02:26' prior: 50981511 overrides: 16896425!
initialize

	clientId _ ''.
	password _ ''.
	restInterface _ TusLibrosInterface new.! !

TusLibrosWindow open.!
!TusLibrosWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:06:08' prior: 50981769!
sendCredentialsFromLoginRequest

	cartId _ restInterface sendLoginRequest: {'clientId'. clientId. 'password'. password}.
	
	self triggerEvent: #newWordsArrived.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:06:48' prior: 50981805!
sendLoginRequest: credentials

	| fieldDict resp urlEncodedSentence |

	"urlEncodedSentence := self correctlyEncodeSpacesForUrlRequestParameter: credentials.	"
	fieldDict := Dictionary newFromPairs: credentials.
	
	resp:= WebClient htmlSubmit: (self url,'/createCart') fields: fieldDict.
	
	resp isSuccess 
		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)) asOrderedCollection .] 
		ifFalse:[^self error: resp content].! !

TusLibrosWindow open.!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!

resp content!

(resp content) readStream!
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:10:35' prior: 50981841!
sendLoginRequest: credentials

	| fieldDict resp urlEncodedSentence |

	"urlEncodedSentence := self correctlyEncodeSpacesForUrlRequestParameter: credentials.	"
	fieldDict := Dictionary newFromPairs: credentials.
	
	resp:= WebClient htmlSubmit: (self url,'/createCart') fields: fieldDict.
	
	resp isSuccess 
		ifTrue:[^resp content.]
		ifFalse:[^self error: resp content].! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:10:55' prior: 50981863!
sendLoginRequest: credentials

	| fieldDict resp urlEncodedSentence |

	"urlEncodedSentence := self correctlyEncodeSpacesForUrlRequestParameter: credentials.	"
	fieldDict := Dictionary newFromPairs: credentials.
	
	resp:= WebClient htmlSubmit: (self url,'/createCart') fields: fieldDict.
	
	resp isSuccess 
		ifTrue:[^resp content.]
		ifFalse:[^self error: -1].! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:11:15' prior: 50981878!
sendLoginRequest: credentials

	| fieldDict resp urlEncodedSentence |

	"urlEncodedSentence := self correctlyEncodeSpacesForUrlRequestParameter: credentials.	"
	fieldDict := Dictionary newFromPairs: credentials.
	
	resp:= WebClient htmlSubmit: (self url,'/createCart') fields: fieldDict.
	
	resp isSuccess 
		ifTrue:[^resp content.]
		ifFalse:[^(0-1)].! !
!TusLibrosWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:13:06' prior: 50981832!
sendCredentialsFromLoginRequest

	cartId _ restInterface sendLoginRequest: {'clientId'. clientId. 'password'. password}.
	
	(cartId = (0-1)) ifFalse: [self triggerEvent: #newWordsArrived].! !

TusLibrosWindow open.!

TusLibrosWindow open.!
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:22:23' prior: 50981237!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TusLibrosWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	"self model when: #newWordsArrived send: #refreshListOfWords to: self."
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:23:20' prior: 50981908!
sendCredentialsFromLoginRequest

	cartId _ restInterface sendLoginRequest: {'clientId'. clientId. 'password'. password}.
	
	(cartId = (0-1)) ifFalse: [self triggerEvent: #validLogin ].! !
!TusLibrosWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:23:35' prior: 50981935!
sendCredentialsFromLoginRequest

	cartId _ restInterface sendLoginRequest: {'clientId'. clientId. 'password'. password}.
	
	(cartId = (0-1)) ifFalse: [self triggerEvent: #validLogin with: cartId].! !
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:24:09' prior: 50981919!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TusLibrosWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #validLogin send: #openCatalogue to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

TusLibrosWindow open.!

Panel subclass: #TusLibrosCatalogueWindow
	instanceVariableNames: 'catalogueMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TusLibrosCatalogueWindow category: 'TusLibros-View' stamp: 'GRC 11/15/2021 20:28:02'!
Panel subclass: #TusLibrosCatalogueWindow
	instanceVariableNames: 'catalogueMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

Panel subclass: #TusLibrosCatalogueWindow
	instanceVariableNames: 'catalogueMorph cartId'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TusLibrosCatalogueWindow category: 'TusLibros-View' stamp: 'GRC 11/15/2021 20:28:16'!
Panel subclass: #TusLibrosCatalogueWindow
	instanceVariableNames: 'catalogueMorph cartId'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TusLibrosCatalogueWindow methodsFor: 'no messages' stamp: 'GRC 11/15/2021 20:28:42'!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TusLibrosWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:28:53' overrides: 50977854!
defaultExtent

	^ 1035@485
	! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:29:03' overrides: 50977758!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:29:12' prior: 50982014 overrides: 50977758!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow.! !
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:30:25'!
openCatalogue: aCartId

	TusLibrosCatalogueWindow open.! !
!TusLibrosCatalogueWindow class methodsFor: 'no messages' stamp: 'GRC 11/15/2021 20:30:45'!
open
	
	^self new initializeWith: 'TusLibros-Service Catalogue Window'.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:31:11' prior: 50982024 overrides: 50977758!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	"addMorph: self build1stRow."! !

TusLibrosWindow open.!
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:31:41'!
openCatalogue

	TusLibrosCatalogueWindow open.! !

TusLibrosWindow open.!
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:32:20' prior: 50982051!
openCatalogue

	TusLibrosCatalogueWindow open.! !
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:32:25' prior: 50982057!
openCatalogue

	TusLibrosCatalogueWindow open.
	
	self close.! !
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:32:50' prior: 50982062!
openCatalogue

	TusLibrosCatalogueWindow open.
	
	self closeButtonClicked.! !

TusLibrosWindow open.!
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:34:01' prior: 50982031!
openCatalogue: aCartId

	TusLibrosCatalogueWindow open.
	
	self closeButtonClicked.! !

!methodRemoval: TusLibrosWindow #openCatalogue stamp: 'GRC 11/15/2021 20:34:07'!
openCatalogue

	TusLibrosCatalogueWindow open.
	
	self closeButtonClicked.!
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:34:29' prior: 50981955!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TusLibrosWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #validLogin send: #openCatalogue: to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

TusLibrosWindow open.!
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:35:57' prior: 50982075!
openCatalogue: aCartId

	TusLibrosCatalogueWindow openFor: aCartId.
	
	self closeButtonClicked.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:36:20' prior: 50981893!
sendLoginRequest: credentials

	| fieldDict resp |

	"urlEncodedSentence := self correctlyEncodeSpacesForUrlRequestParameter: credentials.	"
	fieldDict := Dictionary newFromPairs: credentials.
	
	resp:= WebClient htmlSubmit: (self url,'/createCart') fields: fieldDict.
	
	resp isSuccess 
		ifTrue:[^resp content asNumber.]
		ifFalse:[^(0-1)].! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:37:47' prior: 50982043 overrides: 50977758!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self buildCatalogue.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:37:56'!
buildCatalogue.! !
!TusLibrosRestInterface methodsFor: 'initialization' stamp: 'GRC 11/15/2021 20:39:16' prior: 50970372!
initializeWith: aPortNumber
	
	port := aPortNumber.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: self defaultCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: (ManualClock now: DateAndTime now).
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action: [:aRequest | self createCartAction: aRequest].
	webServer addService: '/addToCart' action: [:aRequest | self addToCartAction: aRequest].
	webServer addService: '/listCart' action: [:aRequest | self listCartAction: aRequest].
	webServer addService: '/checkoutCart' action: [:aRequest | self checkOutCartAction: aRequest].
	webServer addService: '/listPurchases' action: [:aRequest | self listPurchasesAction: aRequest].
	webServer addService: '/catalogue' action: [:aRequest | self catalogueAction: aRequest].! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 20:40:26'!
catalogueAction: aRequest

	[ | cartId result cartContent resultDict |
		cartId := (aRequest fields at: 'cartId') asNumber.
		
		cartContent := tusLibros listCartIdentifiedAs: cartId.

		resultDict := Dictionary new.
		cartContent contents keysAndValuesDo: [ :anItem :aQuantity | resultDict add: anItem->aQuantity ].
		result := WebUtils jsonEncode: resultDict.
		
		aRequest send200Response: result.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 20:43:06'!
catalogAction: aRequest

	[ | result cartContent resultDict catalog |
		
		catalog := tusLibros catalog.

		resultDict := Dictionary new.
		cartContent contents keysAndValuesDo: [ :anItem :aQuantity | resultDict add: anItem->aQuantity ].
		result := WebUtils jsonEncode: resultDict.
		
		aRequest send200Response: result.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

!methodRemoval: TusLibrosRestInterface #catalogueAction: stamp: 'GRC 11/15/2021 20:43:13'!
catalogueAction: aRequest

	[ | cartId result cartContent resultDict |
		cartId := (aRequest fields at: 'cartId') asNumber.
		
		cartContent := tusLibros listCartIdentifiedAs: cartId.

		resultDict := Dictionary new.
		cartContent contents keysAndValuesDo: [ :anItem :aQuantity | resultDict add: anItem->aQuantity ].
		result := WebUtils jsonEncode: resultDict.
		
		aRequest send200Response: result.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]!
!TusLibrosRestInterface methodsFor: 'initialization' stamp: 'GRC 11/15/2021 20:43:21' prior: 50982136!
initializeWith: aPortNumber
	
	port := aPortNumber.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: self defaultCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: (ManualClock now: DateAndTime now).
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action: [:aRequest | self createCartAction: aRequest].
	webServer addService: '/addToCart' action: [:aRequest | self addToCartAction: aRequest].
	webServer addService: '/listCart' action: [:aRequest | self listCartAction: aRequest].
	webServer addService: '/checkoutCart' action: [:aRequest | self checkOutCartAction: aRequest].
	webServer addService: '/listPurchases' action: [:aRequest | self listPurchasesAction: aRequest].
	webServer addService: '/catalog' action: [:aRequest | self catalogAction: aRequest].! !
!TusLibrosSystemFacade methodsFor: 'nil' stamp: 'GRC 11/15/2021 20:44:15'!
catalog

	^catalog.! !
!TusLibrosSystemFacade methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:44:20' prior: 50982253!
catalog

	^catalog copy.! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/15/2021 20:44:48' prior: 50982186!
catalogAction: aRequest

	[ | result catalog |
		
		catalog := tusLibros catalog.
		
		result := WebUtils jsonEncode: catalog.
		
		aRequest send200Response: result.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!
!TusLibrosCatalogueWindow class methodsFor: 'category-name' stamp: 'GRC 11/15/2021 20:46:38'!
openFor: aSmallInteger 
	self shouldBeImplemented.! !
!TusLibrosCatalogueWindow class methodsFor: 'category-name' stamp: 'GRC 11/15/2021 20:47:16' prior: 50982276!
openFor: aCartId

	^self new initializeWith: 'TusLibros-Service Catalogue Window'.! !

Object subclass: #TusLibrosCatalogueWindowModel
	instanceVariableNames: 'restInterface cartId'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TusLibrosCatalogueWindowModel category: 'TusLibros-View' stamp: 'GRC 11/15/2021 20:48:57'!
Object subclass: #TusLibrosCatalogueWindowModel
	instanceVariableNames: 'restInterface cartId'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TusLibrosCatalogueWindowModel methodsFor: 'no messages' stamp: 'GRC 11/15/2021 20:49:25'!
initializeWith: aCartId

	cartId _ aCartId.

	restInterface _ TusLibrosInterface new.! !

!methodRemoval: TusLibrosCatalogueWindow class #open stamp: 'GRC 11/15/2021 20:49:56'!
open
	
	^self new initializeWith: 'TusLibros-Service Catalogue Window'.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:50:42'!
initializeWith: aTitle for: aCartId

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TusLibrosWindowModel new initializeWith: aCartId).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.! !

!methodRemoval: TusLibrosCatalogueWindow #initializeWith: stamp: 'GRC 11/15/2021 20:50:47'!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TusLibrosWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.!
!TusLibrosCatalogueWindow class methodsFor: 'category-name' stamp: 'GRC 11/15/2021 20:50:59' prior: 50982282!
openFor: aCartId

	^self new initializeWith: 'TusLibros-Service Catalogue Window' for: aCartId.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:52:01' prior: 50982313!
initializeWith: aTitle for: aCartId

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TusLibrosCatalogueWindowModel new initializeWith: aCartId).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.! !

TusLibrosWindow open.!

TusLibrosWindow open.!
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:58:24' prior: 50982103!
openCatalogue: aCartId

	TusLibrosCatalogueWindow openFor: aCartId.
	
	"self closeButtonClicked."! !

TusLibrosWindow open.!
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 20:59:10' prior: 50982358!
openCatalogue: aCartId

	TusLibrosCatalogueWindow openFor: aCartId.
	
	self closeButtonClicked.! !

TusLibrosWindow open.!

TusLibrosWindow open.!
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:03:24' prior: 50982366!
openCatalogue: aCartId

	self halt.

	TusLibrosCatalogueWindow openFor: aCartId.
	
	self closeButtonClicked.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:05:40' prior: 50982132!
buildCatalogue! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:07:24' prior: 50982382!
buildCatalogue

	^LabelMorph contents:'Enter client ID:'.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:13:14' prior: 50982386!
buildCatalogue

	| firstRowLayoutMorph |
	
	"clientIdTextBoxMorph := TextModelMorph textProvider: self model textGetter: #clientIdText textSetter: #clientIdText:. 
	clientIdTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | clientIdTextBoxMorph innerTextMorph acceptContents ] .
	clientIdTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter client ID:');
	addMorph: clientIdTextBoxMorph.
	
	^firstRowLayoutMorph."

	^LabelMorph contents:'Enter client ID:'.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:14:03' prior: 50982393!
buildCatalogue

	| firstRowLayoutMorph |
	
	"clientIdTextBoxMorph := TextModelMorph textProvider: self model textGetter: #clientIdText textSetter: #clientIdText:. 
	clientIdTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | clientIdTextBoxMorph innerTextMorph acceptContents ] .
	clientIdTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter client ID:');
	addMorph: clientIdTextBoxMorph.
	
	^firstRowLayoutMorph."

	^LabelMorph contents:'Enter client ID:'.! !

!classDefinition: #TusLibrosCatalogueWindow category: 'TusLibros-View' stamp: 'GRC 11/15/2021 21:15:32'!
Panel subclass: #TusLibrosCatalogueWindow
	instanceVariableNames: 'catalogueMorph cartId catalogue'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:15:29' prior: 50982344!
initializeWith: aTitle for: aCartId

	cartId _ aCartId.
	catalogue _ self obtainCatalogue.
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TusLibrosCatalogueWindowModel new initializeWith: aCartId).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.! !

Panel subclass: #TusLibrosCatalogueWindow
	instanceVariableNames: 'catalogueMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TusLibrosCatalogueWindow category: 'TusLibros-View' stamp: 'GRC 11/15/2021 21:16:22'!
Panel subclass: #TusLibrosCatalogueWindow
	instanceVariableNames: 'catalogueMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:16:31' prior: 50982450!
initializeWith: aTitle for: aCartId

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TusLibrosCatalogueWindowModel new initializeWith: aCartId).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.! !

!classDefinition: #TusLibrosCatalogueWindowModel category: 'TusLibros-View' stamp: 'GRC 11/15/2021 21:17:10'!
Object subclass: #TusLibrosCatalogueWindowModel
	instanceVariableNames: 'restInterface cartId catalogue'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:17:09' prior: 50982302!
initializeWith: aCartId

	cartId _ aCartId.
	restInterface _ TusLibrosInterface new.
	catalogue _ restInterface catalog. ! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:17:51' prior: 50982500!
initializeWith: aCartId

	cartId _ aCartId.
	restInterface _ TusLibrosInterface new.
	catalogue _ restInterface sendCatalogRequest. ! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:18:12'!
sendCatalogueRequest

	! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:19:43' prior: 50982515!
sendCatalogueRequest

	| resp |
	
	resp := WebClient htmlSubmit: (self url,'/catalog') fields: (Dictionary new).
	
	resp isSuccess 
		ifTrue:[^resp.]
		ifFalse:[^(Dictionary new)].! !

TusLibrosWindow open!
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:21:31' prior: 50982374!
openCatalogue: aCartId

	TusLibrosCatalogueWindow openFor: aCartId.
	
	self closeButtonClicked.! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:21:44' prior: 50982508!
initializeWith: aCartId

	cartId _ aCartId.
	restInterface _ TusLibrosInterface new.
	catalogue _ restInterface sendCatalogueRequest. ! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:22:13' prior: 50966658!
validUsersAndPasswords

	^Dictionary new
		at: 'validUser' put: 'validUserPassword';
		at: 'anotherValidUser' put: 'validUserPassword';
		at: '' put: '';
		yourself! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:22:39' prior: 50982545!
validUsersAndPasswords

	^Dictionary new
		at: 'validUser' put: 'validUserPassword';
		at: 'anotherValidUser' put: 'validUserPassword';
		at: 'a' put: 'a';
		yourself! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!

server destroy!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!

TusLibrosRestInterface allInstances do: [:aServer | aServer destroy]!

TusLibrosRestInterface allInstances do: [:aServer | aServer destroy]!

server _ TusLibrosRestInterface listeningOn: 8080.!

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:26:17' prior: 50982557!
validUsersAndPasswords

	^Dictionary new
		at: 'validUser' put: 'validUserPassword';
		at: 'anotherValidUser' put: 'validUserPassword';
		at: '' put: '';
		yourself! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:29:02' prior: 50982417!
buildCatalogue

	
	
	self model catalog do: [].
	
	"clientIdTextBoxMorph := TextModelMorph textProvider: self model textGetter: #clientIdText textSetter: #clientIdText:. 
	clientIdTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | clientIdTextBoxMorph innerTextMorph acceptContents ] .
	clientIdTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter client ID:');
	addMorph: clientIdTextBoxMorph.
	
	^firstRowLayoutMorph."

	^LabelMorph contents:'Enter client ID:'.! !
!TusLibrosCatalogueWindowModel methodsFor: 'nil' stamp: 'GRC 11/15/2021 21:29:17'!
catalog

	^catalogue.! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:29:26'!
catalogue

	^catalogue.! !

!methodRemoval: TusLibrosCatalogueWindowModel #catalog stamp: 'GRC 11/15/2021 21:29:30'!
catalog

	^catalogue.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:29:39' prior: 50982595!
buildCatalogue

	
	
	self model catalogue do: [].
	
	"clientIdTextBoxMorph := TextModelMorph textProvider: self model textGetter: #clientIdText textSetter: #clientIdText:. 
	clientIdTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | clientIdTextBoxMorph innerTextMorph acceptContents ] .
	clientIdTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter client ID:');
	addMorph: clientIdTextBoxMorph.
	
	^firstRowLayoutMorph."

	^LabelMorph contents:'Enter client ID:'.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:31:08' prior: 50982631!
buildCatalogue
	
	self model catalogue do: [:anItem | | layoutMorph2 |
		
	].
	
	"clientIdTextBoxMorph := TextModelMorph textProvider: self model textGetter: #clientIdText textSetter: #clientIdText:. 
	clientIdTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | clientIdTextBoxMorph innerTextMorph acceptContents ] .
	clientIdTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter client ID:');
	addMorph: clientIdTextBoxMorph.
	
	^firstRowLayoutMorph."

	^LabelMorph contents:'Enter client ID:'.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:34:16' prior: 50982655!
buildCatalogue
	
	| layoutMorph2 |
	
	layoutMorph2 := LayoutMorph newRow.
	layoutMorph2 separation: 25;
	axisEdgeWeight: 0.5.
	
	self model catalogue keys do: [:anItem |
		layoutMorph2 addMorph: (LabelMorph contents:'anItem').
	].

	^layoutMorph2.
		
	"firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter client ID:');
	addMorph: clientIdTextBoxMorph.
	
	^firstRowLayoutMorph."! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:35:01' prior: 50982680!
buildCatalogue
	
	| catalogueLayoutMorph |
	
	catalogueLayoutMorph := LayoutMorph newRow.
	catalogueLayoutMorph separation: 25;
	axisEdgeWeight: 0.5.
	
	self model catalogue keys do: [:anItem |
		catalogueLayoutMorph addMorph: (LabelMorph contents:'anItem').
	].

	^catalogueLayoutMorph.
		
	"firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter client ID:');
	addMorph: clientIdTextBoxMorph.
	
	^firstRowLayoutMorph."! !

TusLibrosWindow open.!
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:36:15' prior: 50982520!
sendCatalogueRequest

	| resp |
	
	resp := WebClient htmlSubmit: (self url,'/catalog') fields: (Dictionary new).
	
	resp isSuccess 
		ifTrue:[^WebUtils jsonDecode: resp content.]
		ifFalse:[^(Dictionary new)].! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:37:33' prior: 50982719!
sendCatalogueRequest

	| resp |
	
	resp := WebClient htmlSubmit: (self url,'/catalog') fields: (Dictionary new).
	
	resp isSuccess 
		ifTrue:[^WebUtils jsonDecode: resp content readStream.]
		ifFalse:[^(Dictionary new)].! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:39:25' prior: 50982699!
buildCatalogue
	
	| catalogueLayoutMorph |
	
	catalogueLayoutMorph := LayoutMorph newRow.
	catalogueLayoutMorph separation: 25;
	axisEdgeWeight: 0.5.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice |
		catalogueLayoutMorph addMorph: (LabelMorph contents:'anItem').
	].

	^catalogueLayoutMorph.
		
	"firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter client ID:');
	addMorph: clientIdTextBoxMorph.
	
	^firstRowLayoutMorph."! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:39:50' prior: 50982746!
buildCatalogue
	
	| catalogueLayoutMorph |
	
	catalogueLayoutMorph := LayoutMorph newRow.
	catalogueLayoutMorph separation: 25;
	axisEdgeWeight: 0.5.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice |
		catalogueLayoutMorph addMorph: (LabelMorph contents:'anItem').
	].

	^catalogueLayoutMorph.
		
	"firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter client ID:');
	addMorph: clientIdTextBoxMorph.
	
	^firstRowLayoutMorph."! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:40:03' prior: 50982766!
buildCatalogue
	
	| catalogueLayoutMorph |
	
	catalogueLayoutMorph := LayoutMorph newRow.
	catalogueLayoutMorph separation: 25;
	axisEdgeWeight: 0.5.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice |
		
		catalogueLayoutMorph addMorph: (LabelMorph contents:'anItem').
	].

	^catalogueLayoutMorph.
		
	"firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter client ID:');
	addMorph: clientIdTextBoxMorph.
	
	^firstRowLayoutMorph."! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:41:08' prior: 50982786!
buildCatalogue
	
	| catalogueLayoutMorph columnMorph |
	
	columnMorph _ self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	
	catalogueLayoutMorph := LayoutMorph newRow.
	catalogueLayoutMorph separation: 25;
	axisEdgeWeight: 0.5.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice |
		
		catalogueLayoutMorph addMorph: (LabelMorph contents:'anItem').
	].

	^catalogueLayoutMorph.
		
	"firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter client ID:');
	addMorph: clientIdTextBoxMorph.
	
	^firstRowLayoutMorph."! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:41:47' prior: 50982806!
buildCatalogue
	
	| catalogueLayoutMorph columnMorph |
	
	columnMorph _ self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice |
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 25;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents:'anItem').
		columnMorph addMorph: catalogueLayoutMorph.
	].

	^columnMorph.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:42:52' prior: 50982829!
buildCatalogue
	
	| catalogueLayoutMorph columnMorph |
	
	columnMorph _ self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice |
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 25;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', aPrice)).
		columnMorph addMorph: catalogueLayoutMorph.
	].

	^columnMorph.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:43:25' prior: 50982847!
buildCatalogue
	
	| catalogueLayoutMorph columnMorph |
	
	columnMorph _ self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice |
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 25;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		columnMorph addMorph: catalogueLayoutMorph.
	].

	^columnMorph.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:44:02' prior: 50982866!
buildCatalogue
	
	| catalogueLayoutMorph columnMorph |
	
	columnMorph _ self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	
	self halt.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice |
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 25;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		columnMorph addMorph: catalogueLayoutMorph.
	].

	^columnMorph.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:46:42' prior: 50982884!
buildCatalogue
	
	| columnMorph |
	
	columnMorph _ self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	
	self halt.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph|
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 25;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		columnMorph addMorph: catalogueLayoutMorph.
	].

	^columnMorph.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:47:39' prior: 50982904!
buildCatalogue
	
	| columnMorph |
	
	columnMorph _ self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph|
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 25;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		columnMorph addMorph: catalogueLayoutMorph.
	].

	^columnMorph.! !

----SNAPSHOT----(15 November 2021 21:47:42) CuisUniversity-4972.image priorSource: 20466699!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:52:10' prior: 50982924!
buildCatalogue
	
	| columnMorph |
	
	columnMorph _ self layoutMorph beRow;
	separation: 15;
	axisEdgeWeight: 0.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph|
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 25;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		columnMorph addMorph: catalogueLayoutMorph.
	].

	^columnMorph.! !

TusLibrosWindow open!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:54:22' prior: 50982125 overrides: 50977758!
buildMorphicWindow
		
	| morph |
	
	morph _ self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:54:39' prior: 50982965 overrides: 50977758!
buildMorphicWindow
		
	| morph |
	
	morph _ self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph|
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 25;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		morph addMorph: catalogueLayoutMorph.
	].
! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:55:43' prior: 50982973 overrides: 50977758!
buildMorphicWindow
		
	| morph |
	
	morph _ self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph|
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		morph addMorph: catalogueLayoutMorph.
	].
! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:55:54' prior: 50982992 overrides: 50977758!
buildMorphicWindow
		
	| morph |
	
	morph _ self layoutMorph beColumn;
	separation: 5;
	axisEdgeWeight: 0.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph|
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		morph addMorph: catalogueLayoutMorph.
	].
! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:56:09' prior: 50983011 overrides: 50977758!
buildMorphicWindow
		
	| morph |
	
	morph _ self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph|
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 15;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		morph addMorph: catalogueLayoutMorph.
	].
! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:56:46' prior: 50983030 overrides: 50977758!
buildMorphicWindow
		
	| morph |
	
	morph _ self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	self buildCatalogueOn: morph.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph|
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 15;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		morph addMorph: catalogueLayoutMorph.
	].
! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:57:06'!
buildCatalogueOn: morph.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph|
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 25;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		morph addMorph: catalogueLayoutMorph.
	].! !

!methodRemoval: TusLibrosCatalogueWindow #buildCatalogue stamp: 'GRC 11/15/2021 21:57:09'!
buildCatalogue
	
	| columnMorph |
	
	columnMorph _ self layoutMorph beRow;
	separation: 15;
	axisEdgeWeight: 0.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph|
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 25;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		columnMorph addMorph: catalogueLayoutMorph.
	].

	^columnMorph.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/15/2021 21:57:13' prior: 50983049 overrides: 50977758!
buildMorphicWindow
		
	| morph |
	
	morph _ self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	self buildCatalogueOn: morph.
! !

TusLibrosWindow open.!

TusLibrosRestInterface allInstances do: [:aServer | aServer destroy]!

TusLibrosWindow open.!

----SNAPSHOT----(15 November 2021 21:57:54) CuisUniversity-4972.image priorSource: 20841298!

----QUIT----(15 November 2021 21:57:58) CuisUniversity-4972.image priorSource: 20846727!

----STARTUP---- (16 November 2021 16:16:43) as /home/ryan/UBA/Ing1/cuis3/CuisUniversity-4972.image!


----End fileIn of /home/ryan/UBA/Ing1/isw1-ejercicios/20-TusLibros/it4/TusLibros-View.st----!

----End fileIn of /home/ryan/UBA/Ing1/isw1-ejercicios/20-TusLibros/it4/TusLibros-Tests.st----!

----End fileIn of /home/ryan/UBA/Ing1/isw1-ejercicios/20-TusLibros/it4/TusLibros-Model.st----!

----End fileIn of /home/ryan/UBA/Ing1/isw1-ejercicios/20-TusLibros/it4/TusLibros-80.st----!

----End fileIn of /home/ryan/UBA/Ing1/isw1-ejercicios/20-TusLibros/it4/StringsServicesServer.st----!

----End fileIn of /home/ryan/UBA/Ing1/cuis3/Packages/System/Collections-CompactArrays.pck.st----!

----End fileIn of /home/ryan/UBA/Ing1/cuis3/Packages/Features/Compression.pck.st----!

----End fileIn of /home/ryan/UBA/Ing1/cuis3/Packages/Features/Sound.pck.st----!

----End fileIn of /home/ryan/UBA/Ing1/cuis3/Packages/Features/Cryptography-DigitalSignatures.pck.st----!

----End fileIn of /home/ryan/UBA/Ing1/cuis3/Packages/Features/Identities-UUID.pck.st----!

----End fileIn of /home/ryan/UBA/Ing1/cuis3/Packages/System/Network-Kernel.pck.st----!

----End fileIn of /home/ryan/UBA/Ing1/isw1-ejercicios/20-TusLibros/it4/WebClient.pck.st----!

server _ TusLibrosRestInterface listeningOn: 8080.!

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!

CodePackage subclass: #ColorExtrasPackage
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Color-Extras'!

!classDefinition: #ColorExtrasPackage category: 'Color-Extras' stamp: 'Install-Color-Extras 11/16/2021 16:34:47'!
CodePackage subclass: #ColorExtrasPackage
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Color-Extras'!

ColorExtrasPackage class
	instanceVariableNames: ''!

!classDefinition: 'ColorExtrasPackage class' category: 'Color-Extras' stamp: 'Install-Color-Extras 11/16/2021 16:34:47'!
ColorExtrasPackage class
	instanceVariableNames: ''!

----End fileIn of /home/ryan/UBA/Ing1/cuis3/Packages/Features/Color-Extras.pck.st----!

CodePackage subclass: #MorphicMisc1Package
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Misc1'!

!classDefinition: #MorphicMisc1Package category: 'Morphic-Misc1' stamp: 'Install-Morphic-Misc1 11/16/2021 16:34:48'!
CodePackage subclass: #MorphicMisc1Package
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Misc1'!
!MorphicMisc1Package commentStamp: '<historical>' prior: 0!
My purpose in life is to check that any base image methods overridden have not been updated.
See #MorphMisc1Package class>>prePackageInstall!

MorphicMisc1Package class
	instanceVariableNames: ''!

!classDefinition: 'MorphicMisc1Package class' category: 'Morphic-Misc1' stamp: 'Install-Morphic-Misc1 11/16/2021 16:34:48'!
MorphicMisc1Package class
	instanceVariableNames: ''!

----End fileIn of /home/ryan/UBA/Ing1/cuis3/Packages/Morphic/Morphic-Misc1/Morphic-Misc1.pck.st----!

TusLibrosWindow open.!

----End fileIn of /home/ryan/UBA/Ing1/cuis3/Packages/Morphic/Morphic-Widgets-Extras.pck.st----!

TusLibrosWindow open.!

server destroy.!

----SNAPSHOT----(16 November 2021 16:37:14) CuisUniversity-4972.image priorSource: 18974255!

----STARTUP---- (16 November 2021 16:37:22) as /home/ryan/UBA/Ing1/cuis3/CuisUniversity-4972.image!


TusLibrosWindow open.!

!classRemoval: #TusLibrosSystemFacade stamp: 'RI 11/16/2021 16:38:20'!
Object subclass: #TusLibrosSystemFacade
	instanceVariableNames: 'validUsersAndPasswords catalog lastId merchantProcessor salesBook clock cartSessions'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #TusLibrosRestInterface stamp: 'RI 11/16/2021 16:38:21'!
Object subclass: #TusLibrosRestInterface
	instanceVariableNames: 'webServer port tusLibros'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #Ticket stamp: 'RI 11/16/2021 16:38:21'!
Object subclass: #Ticket
	instanceVariableNames: 'lineItems'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #SalesBook stamp: 'RI 11/16/2021 16:38:22'!
Object subclass: #SalesBook
	instanceVariableNames: 'sales'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #Sale stamp: 'RI 11/16/2021 16:38:22'!
Object subclass: #Sale
	instanceVariableNames: 'customer ticket'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #MerchantProcessor stamp: 'RI 11/16/2021 16:38:22'!
Object subclass: #MerchantProcessor
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #LineItem stamp: 'RI 11/16/2021 16:38:23'!
Object subclass: #LineItem
	instanceVariableNames: 'item quantity total'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #CreditCard stamp: 'RI 11/16/2021 16:38:23'!
Object subclass: #CreditCard
	instanceVariableNames: 'expiration'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #Clock stamp: 'RI 11/16/2021 16:38:23'!
Object subclass: #Clock
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #Cashier stamp: 'RI 11/16/2021 16:38:24'!
Object subclass: #Cashier
	instanceVariableNames: 'cart salesBook merchantProcessor creditCard owner ticket'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #CartSession stamp: 'RI 11/16/2021 16:38:24'!
Object subclass: #CartSession
	instanceVariableNames: 'owner cart lastUsedTime systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #Cart stamp: 'RI 11/16/2021 16:38:25'!
Object subclass: #Cart
	instanceVariableNames: 'catalog items'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #TusLibrosWindow stamp: 'RI 11/16/2021 16:38:32'!
ProtoObject subclass: #TusLibrosWindow
	instanceVariableNames: 'clientIdTextBoxMorph passwordTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classRemoval: #TusLibrosCatalogueWindow stamp: 'RI 11/16/2021 16:38:33'!
ProtoObject subclass: #TusLibrosCatalogueWindow
	instanceVariableNames: 'catalogueMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classRemoval: #TusLibrosWindowModel stamp: 'RI 11/16/2021 16:38:33'!
Object subclass: #TusLibrosWindowModel
	instanceVariableNames: 'clientId password words restInterface sentence cartId'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classRemoval: #TusLibrosInterface stamp: 'RI 11/16/2021 16:38:33'!
Object subclass: #TusLibrosInterface
	instanceVariableNames: 'port'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classRemoval: #TusLibrosCatalogueWindowModel stamp: 'RI 11/16/2021 16:38:34'!
Object subclass: #TusLibrosCatalogueWindowModel
	instanceVariableNames: 'restInterface cartId catalogue'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classRemoval: #StoreTestObjectsFactory stamp: 'RI 11/16/2021 16:38:37'!
Object subclass: #StoreTestObjectsFactory
	instanceVariableNames: 'today'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classRemoval: #TusLibrosSystemFacadeTest stamp: 'RI 11/16/2021 16:38:38'!
TestCase subclass: #TusLibrosSystemFacadeTest
	instanceVariableNames: 'testObjectsFactory clock systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classRemoval: #CashierTest stamp: 'RI 11/16/2021 16:38:38'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'testObjectsFactory debitBehavior'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classRemoval: #CartTest stamp: 'RI 11/16/2021 16:38:39'!
TestCase subclass: #CartTest
	instanceVariableNames: 'testObjectsFactory'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

----End fileIn of /home/ryan/UBA/Ing1/isw1-ejercicios/20-TusLibros/it4/TusLibros-Model.st----!

----End fileIn of /home/ryan/UBA/Ing1/isw1-ejercicios/20-TusLibros/it4/WebClient.pck.st----!

----End fileIn of /home/ryan/UBA/Ing1/isw1-ejercicios/20-TusLibros/it4/TusLibros-View.st----!

----End fileIn of /home/ryan/UBA/Ing1/isw1-ejercicios/20-TusLibros/it4/TusLibros-80.st----!

----End fileIn of /home/ryan/UBA/Ing1/isw1-ejercicios/20-TusLibros/it4/StringsServicesServer.st----!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 16:46:01' prior: 51023971 overrides: 51007968!
buildMorphicWindow
		
	| morph |
	
	morph _ self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0,5.
	
	self buildCatalogueOn: morph.
! !

TusLibrosWindow open.!

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 16:46:27' prior: 51026173 overrides: 51007968!
buildMorphicWindow
		
	| morph |
	
	morph _ self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	self buildCatalogueOn: morph.
! !
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 16:47:16' prior: 51024069!
build3rdRow

	| loginButtonMorph thirdRowLayoutMorph |
	
	loginButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #sendCredentialsFromLoginRequest label: 'login'.
		
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loginButtonMorph.
	
	^thirdRowLayoutMorph.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 16:49:36' prior: 51023956!
buildCatalogueOn: morph.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph addBookButtonMorph|
		addBookButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #addBook label: 'Add 1 book'.
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 25;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		catalogueLayoutMorph addMorph: addBookButtonMorph.
		morph addMorph: catalogueLayoutMorph.
	].! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 16:50:09' prior: 51026207!
buildCatalogueOn: morph.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph addBookButtonMorph|
		addBookButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #addBook label: 'Add 1 book'.
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 0;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		catalogueLayoutMorph addMorph: addBookButtonMorph.
		morph addMorph: catalogueLayoutMorph.
	].! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 16:50:20' prior: 51026229!
buildCatalogueOn: morph.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph addBookButtonMorph|
		addBookButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #addBook label: 'Add 1 book'.
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		catalogueLayoutMorph addMorph: addBookButtonMorph.
		morph addMorph: catalogueLayoutMorph.
	].! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 16:50:34' prior: 51026251!
buildCatalogueOn: morph.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph addBookButtonMorph|
		addBookButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #addBook label: 'Add 1 book'.
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 10;
		axisEdgeWeight: 0.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		catalogueLayoutMorph addMorph: addBookButtonMorph.
		morph addMorph: catalogueLayoutMorph.
	].! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 16:52:08' prior: 51026273!
buildCatalogueOn: morph.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph addBookButtonMorph|
		addBookButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #addBook label: 'Add 1 book'.
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 10;
		axisEdgeWeight: 0;
		direction: 0.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		catalogueLayoutMorph addMorph: addBookButtonMorph.
		morph addMorph: catalogueLayoutMorph.
	].! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 16:52:27' prior: 51026295!
buildCatalogueOn: morph.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph addBookButtonMorph|
		addBookButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #addBook label: 'Add 1 book'.
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		catalogueLayoutMorph addMorph: addBookButtonMorph.
		morph addMorph: catalogueLayoutMorph.
	].! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 16:55:51' prior: 51026317!
buildCatalogueOn: morph.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph addBookButtonMorph|
		addBookButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #addBook: label: 'Add 1 book' .
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		catalogueLayoutMorph addMorph: addBookButtonMorph.
		morph addMorph: catalogueLayoutMorph.
	].! !

PluggableButtonMorph!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 16:57:00' prior: 51026339!
buildCatalogueOn: morph.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph addBookButtonMorph|
		addBookButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: (#addBook: anItem) label: 'Add 1 book' .
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		catalogueLayoutMorph addMorph: addBookButtonMorph.
		morph addMorph: catalogueLayoutMorph.
	].! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 16:57:56'!
addBook: anItem

	self halt.! !

TusLibrosWindow open.!

----End fileIn of /home/ryan/UBA/Ing1/cuis3/WordsClientDemo.st----!
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 17:01:35'!
addBook

	self halt.! !

!methodRemoval: TusLibrosCatalogueWindow #addBook: stamp: 'RI 11/16/2021 17:01:39'!
addBook: anItem

	self halt.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 17:01:48' prior: 51026361!
buildCatalogueOn: morph.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph addBookButtonMorph|
		addBookButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #addBook label: 'Add 1 book' .
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		catalogueLayoutMorph addMorph: addBookButtonMorph.
		morph addMorph: catalogueLayoutMorph.
	].! !

TusLibrosRestInterface allInstances do: [:a | a destroy]!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!

WordsClientWindow open.!
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 17:42:51' prior: 51026635!
addBook
	
	restInterface addToCart.
	self halt.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 17:45:13'!
sendAddToCartRequest: book

	| fieldDict resp |

	"urlEncodedSentence := self correctlyEncodeSpacesForUrlRequestParameter: credentials.	"
	fieldDict := Dictionary newFromPairs: book.
	
	resp:= WebClient htmlSubmit: (self url,'/addToCart') fields: fieldDict.
	
	resp isSuccess
		ifTrue:[^resp content.]
		ifFalse:[^'Error'].! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 17:48:20' prior: 51026669!
addBook

	| book |
	book _ Dictionary new.
	book at: 'cartId' put: 1.
	book at: 'bookIsbn' put: 'validBook'.
	book at: 'bookQuantity' put: 1. 
	
	restInterface sendAddToCartRequest: book
	self halt.! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 17:48:25' prior: 51026688!
addBook

	| book |
	book _ Dictionary new.
	book at: 'cartId' put: 1.
	book at: 'bookIsbn' put: 'validBook'.
	book at: 'bookQuantity' put: 1. 
	
	restInterface sendAddToCartRequest: book! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 17:49:52' prior: 51026698!
addBook

	| book |
	book _ Dictionary new.
	book add: 'cartId'->1.
	book add: 'bookIsbn'->'validBook'.
	book add: 'bookQuantity'->1. 
	
	restInterface sendAddToCartRequest: book! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 17:50:40' prior: 51026709!
addBook

	| book |
	book _ Dictionary new.
	book add: #cartId->1.
	book add: #bookIsbn->'validBook'.
	book add: #bookQuantity->1. 
	
	restInterface sendAddToCartRequest: book! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 17:52:43' prior: 51026719!
addBook

	| book |
	book _ {'cartId'. 1. 'bookIsbn'. 'validBook'. 'bookQuantity'. 1}.
	
	restInterface sendAddToCartRequest: book! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 17:53:12' prior: 51026729!
addBook

	| book |
	book _ {'cartId'. 1. 'bookIsbn'. 'anotherValidBook'. 'bookQuantity'. 1}.
	
	restInterface sendAddToCartRequest: book! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 17:56:27' prior: 51026184 overrides: 51007968!
buildMorphicWindow
		
	| morph leftColumn |
	
	morph _ self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	leftColumn _ self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	self buildCatalogueOn: leftColumn.
	
	morph addMorph: leftColumn.
	morph addMorph: leftColumn.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 17:57:00' prior: 51026746 overrides: 51007968!
buildMorphicWindow
		
	| morph leftColumn |
	
	morph _ self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	leftColumn _ self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	self buildCatalogueOn: leftColumn.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 17:57:46' prior: 51026761 overrides: 51007968!
buildMorphicWindow
		
	| morph leftColumn |
	
	morph _ self layoutMorph beRow;
	separation: 25;
	axisEdgeWeight: 0.
	
	leftColumn _ self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	self buildCatalogueOn: leftColumn.
	
	morph addMorph: leftColumn.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 17:58:06' prior: 51026773 overrides: 51007968!
buildMorphicWindow
		
	| morph leftColumn |
	
	morph _ self layoutMorph beRow;
	separation: 25;
	axisEdgeWeight: 0.
	
	leftColumn _ self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	self buildCatalogueOn: leftColumn.
	self halt.
	morph addMorph: leftColumn.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:00:14' prior: 51026787 overrides: 51007968!
buildMorphicWindow
		
	| morph leftColumn |
	
	morph _ self layoutMorph beRow;
	separation: 25;
	axisEdgeWeight: 0.
	
	leftColumn _ self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	self buildCatalogueOn: leftColumn.
	morph addMorph: leftColumn.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:00:52' prior: 51026800 overrides: 51007968!
buildMorphicWindow
		
	| morph leftColumn |
	
	morph _ LayoutMorph beRow;
	separation: 25;
	axisEdgeWeight: 0.
	
	leftColumn _ self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	self buildCatalogueOn: leftColumn.
	morph addMorph: leftColumn.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:01:47' prior: 51026813 overrides: 51007968!
buildMorphicWindow
		
	| columnsMorph leftColumn |
	
	columnsMorph _ LayoutMorph newRow.
	columnsMorph separation: 10;
	axisEdgeWeight: 0.5.
	
	leftColumn _ self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	self buildCatalogueOn: leftColumn.
	columnsMorph addMorph: leftColumn.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:02:11' prior: 51026826 overrides: 51007968!
buildMorphicWindow
		
	| morph leftColumn |
	
	morph _ LayoutMorph newRow.
	morph separation: 10;
	axisEdgeWeight: 0.5.
	
	leftColumn _ self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	self buildCatalogueOn: leftColumn.
	morph addMorph: leftColumn.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:02:25' prior: 51026841 overrides: 51007968!
buildMorphicWindow
		
	| morph leftColumn |
	
	morph _ self layoutMorph newRow.
	morph separation: 10;
	axisEdgeWeight: 0.5.
	
	leftColumn _ self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	self buildCatalogueOn: leftColumn.
	morph addMorph: leftColumn.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:02:37' prior: 51026855 overrides: 51007968!
buildMorphicWindow
		
	| morph leftColumn |
	
	morph _ self layoutMorph beRow.
	morph separation: 10;
	axisEdgeWeight: 0.5.
	
	leftColumn _ self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	self buildCatalogueOn: leftColumn.
	morph addMorph: leftColumn.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:02:52' prior: 51026869 overrides: 51007968!
buildMorphicWindow
		
	| morph leftColumn |
	
	morph _ self layoutMorph beColumn.
	morph separation: 10;
	axisEdgeWeight: 0.5.
	
	leftColumn _ self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	self buildCatalogueOn: leftColumn.
	morph addMorph: leftColumn.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:03:09' prior: 51026882 overrides: 51007968!
buildMorphicWindow
		
	| morph leftColumn |
	
	morph _ LayoutMorph newRow.
	morph separation: 10;
	axisEdgeWeight: 0.5.
	
	leftColumn _ self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	self buildCatalogueOn: leftColumn.
	morph addMorph: leftColumn.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:03:32' prior: 51026895 overrides: 51007968!
buildMorphicWindow
		
	| morph leftColumn |
	
	morph _ LayoutMorph newRow.
	morph separation: 10;
	axisEdgeWeight: 0.5.
	
	leftColumn _ self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	self buildCatalogueOn: leftColumn.
	morph addMorph: leftColumn.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:05:11' prior: 51026908 overrides: 51007968!
buildMorphicWindow
		
	| morph leftColumn |
	
	leftColumn _ LayoutMorph newColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	self buildCatalogueOn: leftColumn.

	morph _ self layoutMorph beRow;
	separation: 10;
	axisEdgeWeight: 0.5;
	addMorph: leftColumn.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:05:45' prior: 51026921 overrides: 51007968!
buildMorphicWindow
		
	| morph leftColumn |
	
	leftColumn _ LayoutMorph newColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	self buildCatalogueOn: leftColumn.

	morph _ self layoutMorph beRow;
	addMorph: leftColumn.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:05:59' prior: 51026934 overrides: 51007968!
buildMorphicWindow
		
	| morph leftColumn |
	
	leftColumn _ LayoutMorph newColumn;
	separation: 25;
	axisEdgeWeight: 0.
	
	self buildCatalogueOn: leftColumn.

	morph _ self layoutMorph beRow;
	separation: 10;
	axisEdgeWeight: 0.5;
	addMorph: leftColumn.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:06:30' prior: 51026945 overrides: 51007968!
buildMorphicWindow
		
	| morph leftColumn |
	
	leftColumn _ LayoutMorph newColumn.
	leftColumn separation: 25.
	leftColumn axisEdgeWeight: 0.
	
	self buildCatalogueOn: leftColumn.

	morph _ self layoutMorph beRow;
	separation: 10;
	axisEdgeWeight: 0.5;
	addMorph: leftColumn.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:06:42' prior: 51026958 overrides: 51007968!
buildMorphicWindow
		
	| morph leftColumn |
	
	leftColumn _ LayoutMorph newColumn.
	leftColumn separation: 25.
	leftColumn axisEdgeWeight: 0.
	
	self buildCatalogueOn: leftColumn.

	morph _ self layoutMorph beRow;
	separation: 10;
	axisEdgeWeight: 0.5;
	addMorph: leftColumn;
	addMorph: leftColumn.! !

TusLibrosWindow open.!

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:07:05' prior: 51026971 overrides: 51007968!
buildMorphicWindow
		
	| leftColumn |
	
	leftColumn _ LayoutMorph newColumn.
	leftColumn separation: 25.
	leftColumn axisEdgeWeight: 0.
	
	self buildCatalogueOn: leftColumn.

	self layoutMorph beRow;
	separation: 10;
	axisEdgeWeight: 0.5;
	addMorph: leftColumn;
	addMorph: leftColumn.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:07:18' prior: 51026986 overrides: 51007968!
buildMorphicWindow
		
	| leftColumn |
	
	leftColumn _ LayoutMorph newColumn.
	leftColumn separation: 25.
	leftColumn axisEdgeWeight: 0.
	
	self buildCatalogueOn: leftColumn.

	self layoutMorph beRow;
	separation: 10;
	axisEdgeWeight: 0.5.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:07:53' prior: 51027000 overrides: 51007968!
buildMorphicWindow
		
	| leftColumn rightColumn |
	
	leftColumn _ LayoutMorph newColumn.
	leftColumn separation: 25.
	leftColumn axisEdgeWeight: 0.

	rightColumn _ LayoutMorph newColumn.
	rightColumn separation: 25.
	rightColumn axisEdgeWeight: 0.
		
	self buildCatalogueOn: leftColumn.

	self layoutMorph beRow;
	separation: 10;
	axisEdgeWeight: 0.5;
	addMorph: leftColumn;
	addMorph: rightColumn.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:08:34' prior: 51027013 overrides: 51007968!
buildMorphicWindow
		
	| leftColumn rightColumn |
	
	leftColumn _ LayoutMorph newColumn.
	leftColumn separation: 25.
	leftColumn axisEdgeWeight: 0.

	rightColumn _ LayoutMorph newColumn.
	rightColumn separation: 25.
	rightColumn axisEdgeWeight: 0.
		
	self buildCatalogueOn: leftColumn.
	self buildCartOn: rightColumn.

	self layoutMorph beRow;
	separation: 10;
	axisEdgeWeight: 0.5;
	addMorph: leftColumn;
	addMorph: rightColumn.! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:10:26'!
listCart

	^restInterface sendListCartRequest: cartId.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:10:53'!
sendListCartRequest: cart

	| fieldDict resp |

	"urlEncodedSentence := self correctlyEncodeSpacesForUrlRequestParameter: credentials.	"
	fieldDict := Dictionary newFromPairs: cart.
	
	resp:= WebClient htmlSubmit: (self url,'/addToCart') fields: fieldDict.
	
	resp isSuccess
		ifTrue:[^resp content.]
		ifFalse:[^'Error'].! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:11:11' prior: 51027048!
listCart

	^restInterface sendListCartRequest: {'cartId'. cartId}.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:11:21' prior: 51027053!
sendListCartRequest: cart

	| fieldDict resp |

	"urlEncodedSentence := self correctlyEncodeSpacesForUrlRequestParameter: credentials.	"
	fieldDict := Dictionary newFromPairs: cart.
	
	resp:= WebClient htmlSubmit: (self url,'/listCart') fields: fieldDict.
	
	resp isSuccess
		ifTrue:[^resp content.]
		ifFalse:[^'Error'].! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:12:22'!
buildCartOn: morph| cart |
.

	cart _ self model listCart.
	
	"self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph addBookButtonMorph|
		addBookButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #addBook label: 'Add 1 book' .
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		catalogueLayoutMorph addMorph: addBookButtonMorph.
		morph addMorph: catalogueLayoutMorph.
	]."! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:12:35' prior: 51027087!
buildCartOn: morph

	| cart |

	cart _ self model listCart.
	self halt.
	
	"self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph addBookButtonMorph|
		addBookButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #addBook label: 'Add 1 book' .
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		catalogueLayoutMorph addMorph: addBookButtonMorph.
		morph addMorph: catalogueLayoutMorph.
	]."! !

TusLibrosWindow open.!

self model listCart!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:15:04' prior: 51027109!
buildCartOn: morph

	| cart |

	cart _ self model listCart.
	
	"self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph addBookButtonMorph|
		addBookButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #addBook label: 'Add 1 book' .
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		catalogueLayoutMorph addMorph: addBookButtonMorph.
		morph addMorph: catalogueLayoutMorph.
	]."! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:16:52' prior: 51027133!
buildCartOn: morph
	
	self model listCart keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph addBookButtonMorph|
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': ', (aPrice asString))).
		catalogueLayoutMorph addMorph: addBookButtonMorph.
		morph addMorph: catalogueLayoutMorph.
	].! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:18:26' prior: 51026643!
buildCatalogueOn: morph.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph addBookButtonMorph|
		addBookButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #addBook label: 'Add 1 book' .
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		catalogueLayoutMorph addMorph: addBookButtonMorph.
		morph addMorph: catalogueLayoutMorph.
	].! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:18:39' prior: 51023984!
initializeWith: aTitle for: aCartId

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TusLibrosCatalogueWindowModel new initializeWith: aCartId).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
	
	self halt.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:19:15' prior: 51027172!
buildCatalogueOn: morph.
	
	self model catalogue keysAndValuesDo: [:anItem :aPrice | |catalogueLayoutMorph addBookButtonMorph|
		addBookButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #addBook label: 'Add 1 book' .
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': $', (aPrice asString))).
		catalogueLayoutMorph addMorph: addBookButtonMorph.
		morph addMorph: catalogueLayoutMorph.
	].! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:19:43' prior: 51027155!
buildCartOn: morph
	
	self model listCart keysAndValuesDo: [:anItem :aQuantity | |catalogueLayoutMorph|
		catalogueLayoutMorph := LayoutMorph newRow.
		catalogueLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		catalogueLayoutMorph addMorph: (LabelMorph contents: (anItem, ': ', (aQuantity asString))).
		morph addMorph: catalogueLayoutMorph.
	].! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:19:53' prior: 51027228!
buildCartOn: morph
	
	self model listCart keysAndValuesDo: [:anItem :aQuantity | |cartLayoutMorph|
		cartLayoutMorph := LayoutMorph newRow.
		cartLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		cartLayoutMorph addMorph: (LabelMorph contents: (anItem, ': ', (aQuantity asString))).
		morph addMorph: cartLayoutMorph.
	].! !

self model listCart !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:20:20' prior: 51027243!
buildCartOn: morph
	
	self model listCart keysAndValuesDo: [:anItem :aQuantity | |cartLayoutMorph|
		cartLayoutMorph := LayoutMorph newRow.
		cartLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		cartLayoutMorph addMorph: (LabelMorph contents: (anItem, ': ', (aQuantity asString))).
		morph addMorph: cartLayoutMorph.
	].! !

	self model catalogue.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:21:37' prior: 51027258!
buildCartOn: morph

	self model listCart keysAndValuesDo: [:anItem :aQuantity | |cartLayoutMorph|
		cartLayoutMorph := LayoutMorph newRow.
		cartLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		cartLayoutMorph addMorph: (LabelMorph contents: (anItem, ': ', (aQuantity asString))).
		morph addMorph: cartLayoutMorph.
	].! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:22:11' prior: 51027073!
sendListCartRequest: cart

	| fieldDict resp |

	"urlEncodedSentence := self correctlyEncodeSpacesForUrlRequestParameter: credentials.	"
	fieldDict := Dictionary newFromPairs: cart.
	
	resp:= WebClient htmlSubmit: (self url,'/listCart') fields: fieldDict.
	
	resp isSuccess
		ifTrue:[^WebUtils jsonDecode: resp content readStream.]
		ifFalse:[^'Error'].! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:22:20' prior: 51027287!
sendListCartRequest: cart

	| fieldDict resp |

	"urlEncodedSentence := self correctlyEncodeSpacesForUrlRequestParameter: credentials.	"
	fieldDict := Dictionary newFromPairs: cart.
	
	resp:= WebClient htmlSubmit: (self url,'/listCart') fields: fieldDict.
	
	resp isSuccess
		ifTrue:[^WebUtils jsonDecode: resp content readStream.]
		ifFalse:[^Dictionary new].! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:24:31' prior: 51027193!
initializeWith: aTitle for: aCartId

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TusLibrosCatalogueWindowModel new initializeWith: aCartId).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.! !
!TusLibrosWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:25:42' prior: 51024097!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TusLibrosWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.

	self model when: #validLogin send: #openCatalogue: to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:26:13' prior: 51027318!
initializeWith: aTitle for: aCartId

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TusLibrosCatalogueWindowModel new initializeWith: aCartId).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
	
	self model when: #updateCart send: #buildCartOn to: self.! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:26:43' prior: 51026737!
addBook

	| book |
	book _ {'cartId'. 1. 'bookIsbn'. 'anotherValidBook'. 'bookQuantity'. 1}.
	
	restInterface sendAddToCartRequest: book.
	
	self triggerEvent: #updateCart.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:27:35' prior: 51027361!
addBook

	| book |
	book _ {'cartId'. 1. 'bookIsbn'. 'anotherValidBook'. 'bookQuantity'. 1}.
	
	restInterface sendAddToCartRequest: book.
	
	self triggerEvent: #updateCart: with .! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:27:51' prior: 51027346!
initializeWith: aTitle for: aCartId

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TusLibrosCatalogueWindowModel new initializeWith: aCartId).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
	
	self model when: #updateCart send: #buildCartOn to: self.! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:28:00' prior: 51027371!
addBook

	| book |
	book _ {'cartId'. 1. 'bookIsbn'. 'anotherValidBook'. 'bookQuantity'. 1}.
	
	restInterface sendAddToCartRequest: book.
	
	self triggerEvent: #updateCart.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:28:54' prior: 51027381!
initializeWith: aTitle for: aCartId

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TusLibrosCatalogueWindowModel new initializeWith: aCartId).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
	
	self model when: #updateCart send: #updateCart to: self.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:29:09' prior: 51027406!
initializeWith: aTitle for: aCartId

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TusLibrosCatalogueWindowModel new initializeWith: aCartId).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
	
	self model when: #updateCart send: #reloadCart to: self.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:29:28'!
reloadCart

	self model listCart! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:29:47' prior: 51027435!
reloadCart

	| cart |
	cart _ self model listCart.
	self halt.! !

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosRestInterface allInstances do: [:a | a destroy].!

TusLibrosWindow open.!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!

	self layoutMorph.!

	self layoutMorph layoutSubmorphs.!

	self layoutMorph layoutSubmorphs submorphsToLayout !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:32:47' prior: 51027440!
reloadCart

	| cart |
	cart _ self model listCart.
	self halt.! !

	submorphs!

	submorphs asArray !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:33:21' prior: 51027456!
reloadCart

	| cart |
	cart _ self model listCart.
	self halt.! !

Panel subclass: #TusLibrosCatalogueWindow
	instanceVariableNames: 'catalogueMorph cartMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TusLibrosCatalogueWindow category: 'TusLibros-View' stamp: 'RI 11/16/2021 18:33:50'!
Panel subclass: #TusLibrosCatalogueWindow
	instanceVariableNames: 'catalogueMorph cartMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:34:33' prior: 51027031 overrides: 51007968!
buildMorphicWindow
		
	| leftColumn |
	
	leftColumn _ LayoutMorph newColumn.
	leftColumn separation: 25.
	leftColumn axisEdgeWeight: 0.

	cartMorph _ LayoutMorph newColumn.
	cartMorph separation: 25.
	cartMorph axisEdgeWeight: 0.
		
	self buildCatalogueOn: leftColumn.
	self buildCartOn: cartMorph.

	self layoutMorph beRow;
	separation: 10;
	axisEdgeWeight: 0.5;
	addMorph: leftColumn;
	addMorph: cartMorph.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:35:28' prior: 51027463!
reloadCart

	| cart |
	cart _ self model listCart.
	self buildCartOn: cartMorph.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:35:46' prior: 51027501!
reloadCart

	| cart |
	cart _ self model listCart.
	self buildCartOn: cartMorph.
	self halt ! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:37:02' prior: 51027273!
buildCartOn: morph

	self model listCart keysAndValuesDo: [:anItem :aQuantity | |cartLayoutMorph|
		self halt.
		cartLayoutMorph := LayoutMorph newRow.
		cartLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		cartLayoutMorph addMorph: (LabelMorph contents: (anItem, ': ', (aQuantity asString))).
		morph addMorph: cartLayoutMorph.
	].! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:38:18' prior: 51027396!
addBook

	| book |
	book _ {'cartId'. cartId . 'bookIsbn'. 'anotherValidBook'. 'bookQuantity'. 1}.
	
	restInterface sendAddToCartRequest: book.
	
	self triggerEvent: #updateCart.! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:38:19' prior: 51027530!
addBook

	| book |
	book _ {'cartId'. cartId. 'bookIsbn'. 'anotherValidBook'. 'bookQuantity'. 1}.
	
	restInterface sendAddToCartRequest: book.
	
	self triggerEvent: #updateCart.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:38:41' prior: 51027508!
reloadCart

	| cart |
	cart _ self model listCart.
	self buildCartOn: cartMorph.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:38:46' prior: 51027550!
reloadCart
	self buildCartOn: cartMorph.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:38:47' prior: 51027557!
reloadCart

	self buildCartOn: cartMorph.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:38:56' prior: 51027515!
buildCartOn: morph

	self model listCart keysAndValuesDo: [:anItem :aQuantity | |cartLayoutMorph|
		cartLayoutMorph := LayoutMorph newRow.
		cartLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		cartLayoutMorph addMorph: (LabelMorph contents: (anItem, ': ', (aQuantity asString))).
		morph addMorph: cartLayoutMorph.
	].! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:39:19' prior: 51027562!
reloadCart

	cartMorph _ nil.
	self buildCartOn: cartMorph.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:39:44' prior: 51027581!
reloadCart

	cartMorph _ LayoutMorph newColumn.
	cartMorph separation: 25.
	cartMorph axisEdgeWeight: 0.
	
	self buildCartOn: cartMorph.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:40:02' prior: 51027587!
reloadCart
	
	self buildCartOn: cartMorph.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:42:16' prior: 51027483 overrides: 51007968!
buildMorphicWindow
		
	
	
	catalogueMorph _ LayoutMorph newColumn.
	catalogueMorph separation: 25.
	catalogueMorph axisEdgeWeight: 0.

	cartMorph _ LayoutMorph newColumn.
	cartMorph separation: 25.
	cartMorph axisEdgeWeight: 0.
		
	self buildCatalogueOn: catalogueMorph.
	self buildCartOn: cartMorph.

	self layoutMorph beRow;
	separation: 10;
	axisEdgeWeight: 0.5;
	addMorph: catalogueMorph;
	addMorph: cartMorph.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:42:20' prior: 51027603 overrides: 51007968!
buildMorphicWindow	
	
	catalogueMorph _ LayoutMorph newColumn.
	catalogueMorph separation: 25.
	catalogueMorph axisEdgeWeight: 0.

	cartMorph _ LayoutMorph newColumn.
	cartMorph separation: 25.
	cartMorph axisEdgeWeight: 0.
		
	self buildCatalogueOn: catalogueMorph.
	self buildCartOn: cartMorph.

	self layoutMorph beRow;
	separation: 10;
	axisEdgeWeight: 0.5;
	addMorph: catalogueMorph;
	addMorph: cartMorph.! !

TusLibrosWindow open.!

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:43:45' prior: 51027567!
buildCartOn: morph

	| checkoutButtonMorph |
	self model listCart keysAndValuesDo: [:anItem :aQuantity | |cartLayoutMorph|
		cartLayoutMorph := LayoutMorph newRow.
		cartLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		cartLayoutMorph addMorph: (LabelMorph contents: (anItem, ': ', (aQuantity asString))).
		morph addMorph: cartLayoutMorph.
	].

	checkoutButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout'.
	morph addMorph: checkoutButtonMorph.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:44:04' prior: 51027639!
buildCartOn: morph

	
	self model listCart keysAndValuesDo: [:anItem :aQuantity | |cartLayoutMorph|
		cartLayoutMorph := LayoutMorph newRow.
		cartLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		cartLayoutMorph addMorph: (LabelMorph contents: (anItem, ': ', (aQuantity asString))).
		morph addMorph: cartLayoutMorph.
	].! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:44:07' prior: 51027660!
buildCartOn: morph

	self model listCart keysAndValuesDo: [:anItem :aQuantity | |cartLayoutMorph|
		cartLayoutMorph := LayoutMorph newRow.
		cartLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		cartLayoutMorph addMorph: (LabelMorph contents: (anItem, ': ', (aQuantity asString))).
		morph addMorph: cartLayoutMorph.
	].! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:44:20' prior: 51027621 overrides: 51007968!
buildMorphicWindow	
	
	| checkoutButtonMorph |
	catalogueMorph _ LayoutMorph newColumn.
	catalogueMorph separation: 25.
	catalogueMorph axisEdgeWeight: 0.

	cartMorph _ LayoutMorph newColumn.
	cartMorph separation: 25.
	cartMorph axisEdgeWeight: 0.
		
	self buildCatalogueOn: catalogueMorph.
	self buildCartOn: cartMorph.
	checkoutButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout'.
	cartMorph addMorph: checkoutButtonMorph.

	self layoutMorph beRow;
	separation: 10;
	axisEdgeWeight: 0.5;
	addMorph: catalogueMorph;
	addMorph: cartMorph.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:44:27' prior: 51027689 overrides: 51007968!
buildMorphicWindow	
	
	catalogueMorph _ LayoutMorph newColumn.
	catalogueMorph separation: 25.
	catalogueMorph axisEdgeWeight: 0.

	cartMorph _ LayoutMorph newColumn.
	cartMorph separation: 25.
	cartMorph axisEdgeWeight: 0.
		
	self buildCatalogueOn: catalogueMorph.
	self buildCartOn: cartMorph.

	self layoutMorph beRow;
	separation: 10;
	axisEdgeWeight: 0.5;
	addMorph: catalogueMorph;
	addMorph: cartMorph.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:44:04' prior: 51027674!
buildCartOn: morph

	
	self model listCart keysAndValuesDo: [:anItem :aQuantity | |cartLayoutMorph|
		cartLayoutMorph := LayoutMorph newRow.
		cartLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		cartLayoutMorph addMorph: (LabelMorph contents: (anItem, ': ', (aQuantity asString))).
		morph addMorph: cartLayoutMorph.
	].! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'RI 11/16/2021 18:43:45' prior: 51027729!
buildCartOn: morph

	| checkoutButtonMorph |
	self model listCart keysAndValuesDo: [:anItem :aQuantity | |cartLayoutMorph|
		cartLayoutMorph := LayoutMorph newRow.
		cartLayoutMorph separation: 10;
		axisEdgeWeight: 0.5.
		cartLayoutMorph addMorph: (LabelMorph contents: (anItem, ': ', (aQuantity asString))).
		morph addMorph: cartLayoutMorph.
	].

	checkoutButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout'.
	morph addMorph: checkoutButtonMorph.! !

----SNAPSHOT----(16 November 2021 18:45:14) CuisUniversity-4972.image priorSource: 21812814!

----STARTUP---- (28 November 2021 14:06:44) as C:\Users\Guido\Desktop\TusLibros Actualizado\CuisUniversity-4972.image!


----End fileIn of \Users\Guido\Desktop\TusLibros Actualizado\TusLibros-Model.st----!

----End fileIn of \Users\Guido\Desktop\TusLibros Actualizado\TusLibros-Tests.st----!

----End fileIn of \Users\Guido\Desktop\TusLibros Actualizado\StringsServicesServer.st----!

----End fileIn of C:\Users\Guido\Desktop\TusLibros Actualizado\Packages\System\Collections-CompactArrays.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\TusLibros Actualizado\Packages\Features\Compression.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\TusLibros Actualizado\Packages\Features\Sound.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\TusLibros Actualizado\Packages\Features\Cryptography-DigitalSignatures.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\TusLibros Actualizado\Packages\Features\Identities-UUID.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\TusLibros Actualizado\Packages\System\Network-Kernel.pck.st----!

----End fileIn of \Users\Guido\Desktop\TusLibros Actualizado\WebClient.pck.st----!
!TusLibrosSystemFacade methodsFor: 'initialization' stamp: 'GRC 11/28/2021 14:13:46' prior: 51028777!
initializeAuthenticatingWith: aValidUsersAndPasswords
	acceptingItemsOf: aCatalog
	registeringOn: aSalesBook
	debitingThrought: aMerchantProcessor
	measuringTimeWith: aClock

	validUsersAndPasswords := aValidUsersAndPasswords.
	catalog := aCatalog.
	salesBook := SalesBook new.
	merchantProcessor := aMerchantProcessor.
	clock := aClock.

	cartSessions := Dictionary new.
	lastId := 0.! !

!methodRemoval: TusLibrosRestInterface #notExpiredCreditCard stamp: 'GRC 11/28/2021 14:15:41'!
notExpiredCreditCard

	^CreditCard expiringOn: self notExpiredMonthOfYear!

!methodRemoval: TusLibrosRestInterface #notExpiredCreditCardNumber stamp: 'GRC 11/28/2021 14:15:42'!
notExpiredCreditCardNumber

	^ '1111222233334444' 
!

!methodRemoval: TusLibrosRestInterface #notExpiredCreditCardOwner stamp: 'GRC 11/28/2021 14:15:44'!
notExpiredCreditCardOwner

	^'Juan Perez'!

!methodRemoval: TusLibrosRestInterface #notExpiredMonthOfYear stamp: 'GRC 11/28/2021 14:15:48'!
notExpiredMonthOfYear
	
	|today| 
	today := DateAndTime now.
	^ Month month: today monthIndex year: today yearNumber + 1.!

----SNAPSHOT----(28 November 2021 14:17:06) CuisUniversity-4972.image priorSource: 18974255!

----SNAPSHOT----(28 November 2021 14:21:24) CuisUniversity-4972.image priorSource: 23525537!

----End fileIn of \Users\Guido\Desktop\TusLibros Actualizado\TusLibros-80.st----!

----End fileIn of \Users\Guido\Desktop\TusLibros Actualizado\TusLibros-View.st----!
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:42:42'!
sendAddToCartRequest: aRequest

    | temp2 temp3 |
    temp2 _ Dictionary newFromPairs: aRequest.
    temp3 _ WebClient
        htmlSubmit: self url , '/addToCart'
        fields: temp2.
    temp3 isSuccess ifTrue: [ ^ temp3 content ].
    ^ 'Error'.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:43:01' prior: 51069213!
sendAddToCartRequest: aRequest

    | temp2 temp3 |

    temp2 _ Dictionary newFromPairs: aRequest.
    temp3 _ WebClient
        htmlSubmit: self url , '/addToCart'
        fields: temp2.

    temp3 isSuccess ifTrue: [ ^ temp3 content ].
    ^ 'Error'.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:43:10' prior: 51069225!
sendAddToCartRequest: aRequest

    | requestDictionary temp3 |

    requestDictionary _ Dictionary newFromPairs: aRequest.
    temp3 _ WebClient
        htmlSubmit: self url , '/addToCart'
        fields: requestDictionary.

    temp3 isSuccess ifTrue: [ ^ temp3 content ].
    ^ 'Error'.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:43:21' prior: 51069237!
sendAddToCartRequest: aRequest

    | requestDictionary response |

    requestDictionary _ Dictionary newFromPairs: aRequest.
    response _ WebClient
        htmlSubmit: self url , '/addToCart'
        fields: requestDictionary.

    response isSuccess ifTrue: [ ^ response content ].
    ^ 'Error'.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:44:07'!
sendCheckoutRequest: request
    | requestDictionary res |

    requestDictionary _ Dictionary newFromPairs: request.

    res _ WebClient
        htmlSubmit: self url , '/checkoutCart'
        fields: requestDictionary.

    res isSuccess ifTrue: [ ^ res content ].
    ^ 'Error'.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:44:57'!
sendListCartRequest: aRequest

    | temp2 temp3 |

    temp2 _ Dictionary newFromPairs: aRequest.
    temp3 _ WebClient
        htmlSubmit: self url , '/listCart'
        fields: temp2.

    temp3 isSuccess ifTrue: [ ^ WebUtils jsonDecode: temp3 content readStream ].
    ^ Dictionary new.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:45:10' prior: 51069275!
sendListCartRequest: aRequest

    | requestDictionary temp3 |

    requestDictionary _ Dictionary newFromPairs: aRequest.
    temp3 _ WebClient
        htmlSubmit: self url , '/listCart'
        fields: requestDictionary.

    temp3 isSuccess ifTrue: [ ^ WebUtils jsonDecode: temp3 content readStream ].
    ^ Dictionary new.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:45:15' prior: 51069288!
sendListCartRequest: aRequest

    | requestDictionary response |

    requestDictionary _ Dictionary newFromPairs: aRequest.
    response _ WebClient
        htmlSubmit: self url , '/listCart'
        fields: requestDictionary.

    response isSuccess ifTrue: [ ^ WebUtils jsonDecode: response content readStream ].
    ^ Dictionary new.! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:46:23'!
addBook
    | request bookIsbn |

    bookIsbn _ self selectedBook.

    request _ {'cartId'. cartId. 'bookIsbn'. bookIsbn. 'bookQuantity'. 1}.
    restInterface sendAddToCartRequest: request.

    self triggerEvent: #updateCart.! !

!classDefinition: #TusLibrosCatalogueWindowModel category: 'TusLibros-View' stamp: 'GRC 11/28/2021 14:46:42'!
Object subclass: #TusLibrosCatalogueWindowModel
	instanceVariableNames: 'restInterface cartId catalogue cartIndex'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:46:39'!
cartIndex

    ^cartIndex.! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:46:53'!
cartIndex: anIndex

    cartIndex := anIndex.! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:47:09' prior: 51069104!
catalogue

    |catalogueAsOrderedCollection|

    catalogueAsOrderedCollection _ OrderedCollection new.
    catalogue keysAndValuesDo: [:anIsbn :aPrice | 
        catalogueAsOrderedCollection add: (anIsbn , ': $' , aPrice asString) ].

    ^catalogueAsOrderedCollection.! !

!classDefinition: #TusLibrosCatalogueWindowModel category: 'TusLibros-View' stamp: 'GRC 11/28/2021 14:47:20'!
Object subclass: #TusLibrosCatalogueWindowModel
	instanceVariableNames: 'restInterface cartId catalogue cartIndex catalogueListIndex'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:47:18'!
catalogueListIndex

    ^catalogueListIndex.! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:47:30'!
catalogueListIndex: anIndex

    catalogueListIndex := anIndex.! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:47:48'!
checkout
    | request |

    request _ {'cartId'. (cartId asString). 'cco'. 'Juan Perez'. 'cced'. '11/2022'. 'ccn'. '1111222233334444'}.
    restInterface sendCheckoutRequest: request.

    self triggerEvent: #openTicket.! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:48:08' prior: 51069108!
initializeWith: aCartId

    cartId _ aCartId.
    restInterface _ TusLibrosInterface new.
    catalogue _ restInterface sendCatalogueRequest.
    catalogueListIndex _ 1.

    cartIndex _ 1.! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:48:31'!
listCart

    |res cart |

    res _ OrderedCollection new.

    cart _ restInterface sendListCartRequest: {'cartId'. cartId}.
    cart keysAndValuesDo: [:anIsbn :aQuantity | 
        res add: (anIsbn , ': ' , aQuantity asString)].

    ^res! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:50:05'!
buildButtonWithAction: anAction andLabel: aLabel in: aMorph

    | buttonMorph |

    buttonMorph _ PluggableButtonMorph
        model: self model
        stateGetter: nil
        action: anAction
        label: aLabel.
        
    aMorph addMorph: buttonMorph.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:50:33'!
buildCartOn: aMorph
    
    
    "self model listCart keysAndValuesDo: [ :anIsbn :aQuantity | | item |
        item _ self buildRow.
        item addMorph: (LabelMorph contents: anIsbn , ': ' , aQuantity asString).
        aMorph addMorph: item ]."

    | cartListMorph |
    cartListMorph _ PluggableListMorph
        model: self model
        listGetter: #listCart
        indexGetter: #cartIndex
        indexSetter: #cartIndex:.
    cartListMorph borderColor: Color skyBlue;
        borderWidth: 1;
        morphWidth: 300.
        
    aMorph addMorph: cartListMorph.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:50:45' prior: 51068914!
buildCatalogueOn: aMorph
    
    | wordsListMorph |
    
    wordsListMorph _ PluggableListMorph
        model: self model
        listGetter: #catalogue
        indexGetter: #catalogueListIndex
        indexSetter: #catalogueListIndex:.
    wordsListMorph borderColor: Color skyBlue;
        borderWidth: 1;
        morphWidth: 300.

    aMorph addMorph: wordsListMorph.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:51:03'!
buildColumn

    | morph |
    morph _ LayoutMorph newColumn.
    morph separation: 25.
    morph axisEdgeWeight: 0.
    
    ^morph! !

!classDefinition: #TusLibrosCatalogueWindow category: 'TusLibros-View' stamp: 'GRC 11/28/2021 14:51:26'!
ProtoObject subclass: #TusLibrosCatalogueWindow
	instanceVariableNames: 'catalogueMorph cartMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TusLibrosCatalogueWindow category: 'TusLibros-View' stamp: 'GRC 11/28/2021 14:51:28'!
ProtoObject subclass: #TusLibrosCatalogueWindow
	instanceVariableNames: 'catalogueMorph cartMorph cartMorphList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:51:24' prior: 51068929!
buildMorphicWindow
    | catalogueMorphList |
    
    catalogueMorph _ self buildColumn.
    catalogueMorphList _ self buildColumn.
    cartMorph _ self buildColumn.
    cartMorphList _ self buildColumn.
    
    self buildCatalogueOn: catalogueMorphList.
    catalogueMorph addMorph: catalogueMorphList.
    self buildButtonWithAction: #addBook andLabel: 'Add 1 book' in: catalogueMorph.
    
    self buildCartOn: cartMorphList.
    cartMorph addMorph: cartMorphList.
    self buildButtonWithAction: #checkout andLabel: 'Checkout' in: cartMorph.
    
    self layoutMorph
        beRow;
        separation: 10;
        axisEdgeWeight: 0.5;
        addMorph: catalogueMorph;
        addMorph: cartMorph.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:51:47'!
buildRow
    
    | morph |
    
    morph _ LayoutMorph newRow.
    morph separation: 10.
    morph axisEdgeWeight: 0.5.
    
    ^morph.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:51:57' prior: 51068941!
initializeWith: aTitle for: cartId

    self titleMorph showButtonsNamed: #(#close #collapse ).
    self setLabel: aTitle.
    self model: (TusLibrosCatalogueWindowModel new initializeWith: cartId).
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.
    self model
        when: #updateCart
        send: #reloadCart
        to: self.! !
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:52:12'!
reloadCart

    cartMorphList removeAllMorphs.
    self buildCartOn: cartMorphList.! !

CodePackage subclass: #ColorExtrasPackage
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Color-Extras'!

!classDefinition: #ColorExtrasPackage category: 'Color-Extras' stamp: 'Install-Color-Extras 11/28/2021 14:55:28'!
CodePackage subclass: #ColorExtrasPackage
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Color-Extras'!

ColorExtrasPackage class
	instanceVariableNames: ''!

!classDefinition: 'ColorExtrasPackage class' category: 'Color-Extras' stamp: 'Install-Color-Extras 11/28/2021 14:55:28'!
ColorExtrasPackage class
	instanceVariableNames: ''!

----End fileIn of C:\Users\Guido\Desktop\TusLibros Actualizado\Packages\Features\Color-Extras.pck.st----!

CodePackage subclass: #MorphicMisc1Package
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Misc1'!

!classDefinition: #MorphicMisc1Package category: 'Morphic-Misc1' stamp: 'Install-Morphic-Misc1 11/28/2021 14:55:30'!
CodePackage subclass: #MorphicMisc1Package
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Misc1'!
!MorphicMisc1Package commentStamp: '<historical>' prior: 0!
My purpose in life is to check that any base image methods overridden have not been updated.
See #MorphMisc1Package class>>prePackageInstall!

MorphicMisc1Package class
	instanceVariableNames: ''!

!classDefinition: 'MorphicMisc1Package class' category: 'Morphic-Misc1' stamp: 'Install-Morphic-Misc1 11/28/2021 14:55:30'!
MorphicMisc1Package class
	instanceVariableNames: ''!

----End fileIn of \Users\Guido\Desktop\TusLibros Actualizado\Morphic-Misc1.pck.st----!

----End fileIn of \Users\Guido\Desktop\TusLibros Actualizado\Morphic-Widgets-Extras.pck.st----!

Panel subclass: #TusLibrosCatalogueWindow
	instanceVariableNames: 'catalogueMorph cartMorph cartMorphList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TusLibrosCatalogueWindow category: 'TusLibros-View' stamp: 'GRC 11/28/2021 14:55:50'!
Panel subclass: #TusLibrosCatalogueWindow
	instanceVariableNames: 'catalogueMorph cartMorph cartMorphList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

Panel subclass: #TusLibrosWindow
	instanceVariableNames: 'clientIdTextBoxMorph passwordTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TusLibrosWindow category: 'TusLibros-View' stamp: 'GRC 11/28/2021 14:56:08'!
Panel subclass: #TusLibrosWindow
	instanceVariableNames: 'clientIdTextBoxMorph passwordTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

----SNAPSHOT----(28 November 2021 14:56:13) CuisUniversity-4972.image priorSource: 23525631!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 14:57:24'!
selectedBook
    
    ^catalogue keys at: catalogueListIndex.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 15:01:08' prior: 51069521!
initializeWith: aTitle for: cartId

    self titleMorph showButtonsNamed: #(#close #collapse ).
    self setLabel: aTitle.
    self model: (TusLibrosCatalogueWindowModel new initializeWith: cartId).
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.
    self model
        when: #updateCart
        send: #reloadCart
        to: self.
    self model
        when: #openTicket
        send: #openTicket
        to: self.! !

!classDefinition: #TusLibrosTicketWindow category: 'TusLibros-View' stamp: 'GRC 11/28/2021 15:03:33'!
Object subclass: #TusLibrosTicketWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 15:03:27'!
openTicket: aTicket

	TusLibrosTicketWindow openFor: aTicket.
	
	"self closeButtonClicked."! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 15:04:43' prior: 51069380!
checkout
    | request response |

    request _ {'cartId'. (cartId asString). 'cco'. 'Juan Perez'. 'cced'. '11/2022'. 'ccn'. '1111222233334444'}.
    response _ restInterface sendCheckoutRequest: request.

    self triggerEvent: #openTicket with: response.! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/28/2021 15:05:30' prior: 51067565!
checkOutCartIdentifiedAs: aCartId withCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	self
		withCartSessionIdentifiedAs: aCartId
		do: [ :cartSession | cartSession
			checkOutCartWithCreditCardNumbered: aCreditCartNumber
			ownedBy: anOwner
			expiringOn: anExpirationMonthOfYear ]
! !
!TusLibrosTicketWindow methodsFor: 'no messages' stamp: 'GRC 11/28/2021 15:07:45'!
openFor: aTicket! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 15:08:42' prior: 51079303!
openFor: aTicket

	self halt.! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 15:09:58' prior: 51079245!
initializeWith: aTitle for: cartId

    self titleMorph showButtonsNamed: #(#close #collapse ).
    self setLabel: aTitle.
    self model: (TusLibrosCatalogueWindowModel new initializeWith: cartId).
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.
    self model
        when: #updateCart
        send: #reloadCart
        to: self.
    self model
        when: #openTicket
        send: #openTicket:
        to: self.! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 15:10:33' prior: 51079278!
checkout
    | request response |

    request _ {'cartId'. (cartId asString). 'cco'. 'Juan Perez'. 'cced'. '11/2022'. 'ccn'. '1111222233334444'}.
    response _ restInterface sendCheckoutRequest: request.

    self triggerEvent: #openTicket: with: response.! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 15:10:52' prior: 51079332!
checkout
    | request response |

    request _ {'cartId'. (cartId asString). 'cco'. 'Juan Perez'. 'cced'. '11/2022'. 'ccn'. '1111222233334444'}.
    response _ restInterface sendCheckoutRequest: request.

    self triggerEvent: #openTicket with: response.! !

TusLibrosWindow open.!
!TusLibrosTicketWindow class methodsFor: 'no messages' stamp: 'GRC 11/28/2021 15:11:36'!
openFor: aTicket

	self halt.! !

!methodRemoval: TusLibrosTicketWindow #openFor: stamp: 'GRC 11/28/2021 15:11:40'!
openFor: aTicket

	self halt.!

TusLibrosWindow open.!
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 15:13:30' prior: 51079344!
checkout

	| request response |

	request _ {'cartId'. (cartId asString). 'cco'. 'Juan Perez'. 'cced'. '11/2022'. 'ccn'. '1111222233334444'}.
	response _ restInterface sendCheckoutRequest: request.

	response = 'Error' ifFalse: [self triggerEvent: #openTicket with: response.].

	! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 15:13:48' prior: 51079365!
checkout

	| request response |

	request _ {'cartId'. (cartId asString). 'cco'. 'Juan Perez'. 'cced'. '11/2022'. 'ccn'. '1111222233334444'}.
	
	self halt.
	
	response _ restInterface sendCheckoutRequest: request.

	response = 'Error' ifFalse: [self triggerEvent: #openTicket with: response.].

	! !

TusLibrosWindow open.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/28/2021 15:16:39' prior: 51028502!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionId expMonth expYear expirationDate result |
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		self halt.
		
		transactionId := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		result := WebUtils jsonEncode: transactionId .
		
		aRequest send200Response: result.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 15:16:50' prior: 51079378!
checkout

	| request response |

	request _ {'cartId'. (cartId asString). 'cco'. 'Juan Perez'. 'cced'. '11/2022'. 'ccn'. '1111222233334444'}.
	
	response _ restInterface sendCheckoutRequest: request.

	response = 'Error' ifFalse: [self triggerEvent: #openTicket with: response.].

	! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/28/2021 15:19:21' prior: 51079392!
checkOutCartAction: aRequest	
	[ | cartId cced ccn cco transactionId expMonth expYear expirationDate result |
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionId := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		result := WebUtils jsonEncode: transactionId .
		
		aRequest send200Response: result.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/28/2021 15:19:29' prior: 51079435!
checkOutCartAction: aRequest	

	self halt.

	[ | cartId cced ccn cco transactionId expMonth expYear expirationDate result |
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionId := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		result := WebUtils jsonEncode: transactionId .
		
		aRequest send200Response: result.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

server destroy.!

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!

----SNAPSHOT----(28 November 2021 15:20:46) CuisUniversity-4972.image priorSource: 23922589!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/28/2021 15:24:05' prior: 51079462!
checkOutCartAction: aRequest	

	[ | cartId cced ccn cco transactionId expMonth expYear expirationDate result |
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionId := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		result := WebUtils jsonEncode: transactionId .
		
		aRequest send200Response: result.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!MerchantProcessor methodsFor: 'debit' stamp: 'GRC 11/28/2021 15:27:00' prior: 51067323!
debit: anAmount from: aCreditCard! !

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 15:28:37' prior: 51079271!
openTicket: aTicket

	self halt.

	TusLibrosTicketWindow openFor: aTicket.
	
	"self closeButtonClicked."! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 15:29:48' prior: 51079420!
checkout

	| request response |

	request _ {'cartId'. (cartId asString). 'cco'. 'Juan Perez'. 'cced'. '11/2022'. 'ccn'. '1111222233334444'}.
	
	response _ restInterface sendCheckoutRequest: request.

	response = 'Error' ifTrue: [^self error: 'Error'].
	
	self triggerEvent: #openTicket with: response.

	! !

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosRestInterface allInstancesDo: [:unServidor | unServidor destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/28/2021 15:39:19' prior: 51079290!
checkOutCartIdentifiedAs: aCartId withCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	self
		withCartSessionIdentifiedAs: aCartId
		do: [ :cartSession | cartSession
			checkOutCartWithCreditCardNumbered: aCreditCartNumber
			ownedBy: anOwner
			expiringOn: anExpirationMonthOfYear ]
! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/28/2021 15:39:51' prior: 51079496!
checkOutCartAction: aRequest	

	| cartId cced ccn cco transactionId expMonth expYear expirationDate result |
	
		self halt.
	
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionId := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		result := WebUtils jsonEncode: transactionId .
		
		aRequest send200Response: result.

	"[ | cartId cced ccn cco transactionId expMonth expYear expirationDate result |
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionId := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		result := WebUtils jsonEncode: transactionId .
		
		aRequest send200Response: result.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]"! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/28/2021 15:45:41' prior: 51079581!
checkOutCartAction: aRequest	

	| cartId cced ccn cco ticket expMonth expYear expirationDate result ticketItems |
	
		self halt.
	
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		ticket := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		ticketItems _ ticket items.
		
		result := WebUtils jsonEncode: ticketItems.
		
		aRequest send200Response: result.

	"[ | cartId cced ccn cco transactionId expMonth expYear expirationDate result |
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionId := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		result := WebUtils jsonEncode: transactionId .
		
		aRequest send200Response: result.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]"! !
!Ticket methodsFor: 'nil' stamp: 'GRC 11/28/2021 15:46:04'!
items

	^lineItems.! !

TusLibrosRestInterface allInstancesDo: [:unServidor | unServidor destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/28/2021 15:47:38' prior: 51079631!
checkOutCartAction: aRequest	

	| cartId cced ccn cco ticket expMonth expYear expirationDate result ticketItems |
	
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		ticket := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		ticketItems _ ticket items.
		
		result := WebUtils jsonEncode: ticketItems.
		
		aRequest send200Response: result.

	"[ | cartId cced ccn cco transactionId expMonth expYear expirationDate result |
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		transactionId := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		result := WebUtils jsonEncode: transactionId .
		
		aRequest send200Response: result.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]"! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/28/2021 15:49:23' prior: 51079687!
checkOutCartAction: aRequest	

	[ | cartId cced ccn cco expMonth expYear expirationDate result ticket ticketItems |
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		ticket := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		ticketItems _ ticket items.
		
		result := WebUtils jsonEncode: ticketItems.
		
		aRequest send200Response: result.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

TusLibrosRestInterface allInstancesDo: [:unServidor | unServidor destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/28/2021 15:51:29' prior: 51079567!
checkOutCartIdentifiedAs: aCartId withCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	^self
		withCartSessionIdentifiedAs: aCartId
		do: [ :cartSession | cartSession
			checkOutCartWithCreditCardNumbered: aCreditCartNumber
			ownedBy: anOwner
			expiringOn: anExpirationMonthOfYear ]
! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/28/2021 15:54:00' prior: 51079737!
checkOutCartAction: aRequest	

	[ | cartId cced ccn cco expMonth expYear expirationDate result ticket ticketItems |
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		ticket := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		ticketItems _ ticket items.
		
		result := WebUtils jsonEncode: ticketItems.
		
		aRequest send200Response: result.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/28/2021 15:54:06' prior: 51079785!
checkOutCartAction: aRequest	

	[ | cartId cced ccn cco expMonth expYear expirationDate result ticket ticketItems |
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		ticket := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		ticketItems _ ticket items asArray.
		
		result := WebUtils jsonEncode: ticketItems.
		
		aRequest send200Response: result.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!
!Ticket methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 15:55:49' prior: 51079678!
items

	| result |
	
	result _ Dictionary new.
	
	lineItems do: [:anItem |
		result at: anItem 	
	].! !
!Ticket methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 15:56:59' prior: 51079843!
items

	| result |
	
	result _ Dictionary new.
	
	lineItems do: [:anItem |
		result at: anItem 	item put: anItem quantity.
	].! !
!Ticket methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 15:57:04' prior: 51079850!
items

	| result |
	
	result _ Dictionary new.
	
	lineItems do: [:anItem |
		result at: anItem 	item put: anItem quantity.
	].

	^result.! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/28/2021 15:57:23' prior: 51079813!
checkOutCartAction: aRequest	

	[ | cartId cced ccn cco expMonth expYear expirationDate result ticket ticketItems |
		cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		ticket := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		ticketItems _ ticket items.
		
		result := WebUtils jsonEncode: ticketItems.
		
		aRequest send200Response: result.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

----SNAPSHOT----(28 November 2021 15:58:03) CuisUniversity-4972.image priorSource: 23930917!

TusLibrosWindow open.!

TusLibrosRestInterface allInstancesDo: [:unServidor | unServidor destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!

TusLibrosWindow open.!

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 16:03:04' prior: 51069263!
sendCheckoutRequest: request
    | requestDictionary res |

    requestDictionary _ Dictionary newFromPairs: request.

    res _ WebClient
        htmlSubmit: self url , '/checkoutCart'
        fields: requestDictionary.

    res isSuccess ifTrue: [ ^ res content ].
    "^ 'Error'."! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 16:03:21' prior: 51079907!
sendCheckoutRequest: request
    | requestDictionary res |

    requestDictionary _ Dictionary newFromPairs: request.

    res _ WebClient
        htmlSubmit: self url , '/checkoutCart'
        fields: requestDictionary.

    "res isSuccess ifTrue: [ ^ res content ].
    ^ 'Error'."

	^ res content! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 16:03:47' prior: 51079530!
openTicket: aTicket

	TusLibrosTicketWindow openFor: aTicket.
	
	"self closeButtonClicked."! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 16:03:57' prior: 51079920!
sendCheckoutRequest: request
    | requestDictionary res |

	self halt.

    requestDictionary _ Dictionary newFromPairs: request.

    res _ WebClient
        htmlSubmit: self url , '/checkoutCart'
        fields: requestDictionary.

    "res isSuccess ifTrue: [ ^ res content ].
    ^ 'Error'."

	^ res content! !

TusLibrosWindow open.!

TusLibrosRestInterface allInstancesDo: [:unServidor | unServidor destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 16:09:39' prior: 51079941!
sendCheckoutRequest: request
    | requestDictionary res |

    requestDictionary _ Dictionary newFromPairs: request.

    res _ WebClient
        htmlSubmit: self url , '/checkoutCart'
        fields: requestDictionary.

    "res isSuccess ifTrue: [ ^ res content ].
    ^ 'Error'."

	^ res content! !

TusLibrosWindow open.!

----SNAPSHOT----(28 November 2021 16:11:53) CuisUniversity-4972.image priorSource: 23943786!
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 16:14:08' prior: 51079540!
checkout

	| request response |

	request _ {'cartId'. cartId. 'cco'. 'Juan Perez'. 'cced'. '11/2022'. 'ccn'. '1111222233334444'}.
	
	response _ restInterface sendCheckoutRequest: request.

	response = 'Error' ifTrue: [^self error: 'Error'].
	
	self triggerEvent: #openTicket with: response.

	! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 16:14:14' prior: 51079976!
checkout

	| request response |

	request _ {'cartId'. cartId. 'cco'. 'Juan Perez'. 'cced'. '11/2022'. 'ccn'. '1111222233334444'}.
	
	self halt.
	
	response _ restInterface sendCheckoutRequest: request.

	response = 'Error' ifTrue: [^self error: 'Error'].
	
	self triggerEvent: #openTicket with: response.

	! !

TusLibrosRestInterface allInstancesDo: [:unServidor | unServidor destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!

TusLibrosWindow open.!

TusLibrosRestInterface allInstancesDo: [:unServidor | unServidor destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 16:20:55' prior: 51079989!
checkout

	| request response |

	request _ {'cartId'. cartId. 'cco'. 'Juan Perez'. 'cced'. '11/2022'. 'ccn'. '1111222233334444'}.
	
	response _ restInterface sendCheckoutRequest: request.

	response = 'Error' ifTrue: [^self error: 'Error'].
	
	self triggerEvent: #openTicket with: response.

	! !

TusLibrosWindow open.!
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 16:21:43' prior: 51080012!
checkout

	| request response |

	request _ {'cartId'. (cartId asString). 'cco'. 'Juan Perez'. 'cced'. '11/2022'. 'ccn'. '1111222233334444'}.
	
	response _ restInterface sendCheckoutRequest: request.

	response = 'Error' ifTrue: [^self error: 'Error'].
	
	self triggerEvent: #openTicket with: response.

	! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 16:22:22' prior: 51079959!
sendCheckoutRequest: request

    | requestDictionary res |

    requestDictionary _ Dictionary newFromPairs: request.

    res _ WebClient
        htmlSubmit: self url , '/checkoutCart'
        fields: requestDictionary.

    "res isSuccess ifTrue: [ ^ res content ].
    ^ 'Error'."

	^ res content! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 16:24:20' prior: 51080039!
sendCheckoutRequest: request

    | requestDictionary res |

    requestDictionary _ Dictionary newFromPairs: request.

    res _ WebClient
        htmlSubmit: self url , '/checkoutCart'
        fields: requestDictionary.

    "res isSuccess ifTrue: [ ^ res content ].
    ^ 'Error'."

	^ res content! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/28/2021 16:25:58' prior: 51079865!
checkOutCartAction: aRequest	

	[ | cartId cced ccn cco expMonth expYear expirationDate result ticket ticketItems |
		"cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'."
		
		cartId _ 1.
		ccn _ '1111222233334444'.
		cced _ '11/2022'.
		cco _ 'Juan Perez'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		ticket := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		ticketItems _ ticket items.
		
		result := WebUtils jsonEncode: ticketItems.
		
		aRequest send200Response: result.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

TusLibrosRestInterface allInstancesDo: [:unServidor | unServidor destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosWindow open.!
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 16:29:08' prior: 51080026!
checkout

	| request response |
	
	request _ Dictionary new.
	
	request at: 'cartId' put: cartId asString.
	request at: 'cco' put: 'Juan Perez'.
	request at: 'cced' put: '11/2022'.
	request at: 'ccn' put: '1111222233334444'.

	"request _ {'cartId'. (cartId asString). 'cco'. 'Juan Perez'. 'cced'. '11/2022'. 'ccn'. '1111222233334444'}."
	
	response _ restInterface sendCheckoutRequest: request.

	response = 'Error' ifTrue: [^self error: 'Error'].
	
	self triggerEvent: #openTicket with: response.

	! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 16:29:18' prior: 51080052!
sendCheckoutRequest: request

    | requestDictionary res |

    requestDictionary _ Dictionary newFromPairs: request.

    res _ WebClient
        htmlSubmit: self url , '/checkoutCart'
        fields: request.

    "res isSuccess ifTrue: [ ^ res content ].
    ^ 'Error'."

	^ res content! !

TusLibrosWindow open.!
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 16:30:01' prior: 51080120!
sendCheckoutRequest: request

    | requestDictionary res |

    "requestDictionary _ Dictionary newFromPairs: request."

    res _ WebClient
        htmlSubmit: self url , '/checkoutCart'
        fields: request.

    "res isSuccess ifTrue: [ ^ res content ].
    ^ 'Error'."

	^ res content! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 16:30:25' prior: 51080134!
sendCheckoutRequest: request

    | res |

    res _ WebClient
        htmlSubmit: self url , '/checkoutCart'
        fields: request.

    "res isSuccess ifTrue: [ ^ res content ].
    ^ 'Error'."

	^ res content! !
!TusLibrosCatalogueWindowModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/28/2021 16:30:35' prior: 51080101!
checkout

	| request response |
	
	request _ Dictionary new.
	
	request at: 'cartId' put: cartId asString.
	request at: 'cco' put: 'Juan Perez'.
	request at: 'cced' put: '11/2022'.
	request at: 'ccn' put: '1111222233334444'.
	
	response _ restInterface sendCheckoutRequest: request.

	response = 'Error' ifTrue: [^self error: 'Error'].
	
	self triggerEvent: #openTicket with: response.

	! !

----SNAPSHOT----(28 November 2021 16:31:46) CuisUniversity-4972.image priorSource: 23946278!

----SNAPSHOT----(28 November 2021 16:32:05) CuisUniversity-4972.image priorSource: 23952711!

----QUIT----(28 November 2021 16:32:14) CuisUniversity-4972.image priorSource: 23952805!

----STARTUP---- (29 November 2021 09:26:42) as C:\Users\Guido\Desktop\TusLibros Actualizado\CuisUniversity-4972.image!


!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/29/2021 09:27:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/29/2021 09:27:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 09:27:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/29/2021 09:27:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 09:27:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/29/2021 09:27:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/29/2021 09:27:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/29/2021 09:27:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/29/2021 09:27:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 09:27:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 09:27:09'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/29/2021 09:27:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 09:27:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 09:27:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/29/2021 09:27:09'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 09:27:23'!
PASSED!
!TusLibrosSystemFacadeTest methodsFor: 'tests - add to cart' stamp: 'GRC 11/29/2021 09:27:27' prior: 51068033!
test17CanNotAddToCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self advanceTime: (systemFacade sessionDuration + 1 minutes) .
	self
		should: [systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self revertTime: systemFacade sessionDuration.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
! !

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 09:27:28'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/29/2021 09:27:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 09:27:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 09:27:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/29/2021 09:27:29'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 09:27:45'!
ERROR!
!TusLibrosSystemFacadeTest methodsFor: 'test objects' stamp: 'GRC 11/29/2021 09:28:59' prior: 51068232!
validUsersAndPasswords

	^Dictionary new
		at: self validUser put: self validUserPassword;		at: self anotherValidUser put: self validUserPassword;
		yourself! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'GRC 11/29/2021 09:29:00'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'GRC 11/29/2021 09:29:00'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'GRC 11/29/2021 09:29:00'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'GRC 11/29/2021 09:29:00'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'GRC 11/29/2021 09:29:00'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'GRC 11/29/2021 09:29:00'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'GRC 11/29/2021 09:29:00'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'GRC 11/29/2021 09:29:00'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 09:29:00'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'GRC 11/29/2021 09:29:00'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'GRC 11/29/2021 09:29:00'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'GRC 11/29/2021 09:29:00'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'GRC 11/29/2021 09:29:00'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'GRC 11/29/2021 09:29:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/29/2021 09:29:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/29/2021 09:29:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/29/2021 09:29:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/29/2021 09:29:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/29/2021 09:29:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/29/2021 09:29:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/29/2021 09:29:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/29/2021 09:29:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/29/2021 09:29:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 09:29:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/29/2021 09:29:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 09:29:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/29/2021 09:29:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/29/2021 09:29:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/29/2021 09:29:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/29/2021 09:29:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 09:29:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 09:29:01'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/29/2021 09:29:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 09:29:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 09:29:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/29/2021 09:29:01'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 09:29:06'!
FAILURE!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/29/2021 09:30:58' prior: 51067602!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ | sales |
		sales := self salesDoneBy: aUser.
		sales
			inject: Dictionary new
			into: [ :salesOrderedByBook :aSale |
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook ] ]! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/29/2021 09:31:04' prior: 51067580!
createCartFor: aUser authenticatedWith: aPassword

	^ self if: aUser authenticatesWith: aPassword do: [ | cartId cartSession |

		cartId := self generateCartId.
		cartSession := CartSession ownedBy: aUser with: (Cart acceptingItemsOf: catalog) on: self..
		cartSessions at: cartId put: cartSession.

		cartId  ]! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/29/2021 09:31:09' prior: 51067556!
add: anAmount of: aBook toCartIdentifiedAs: aCartId

	self withCartSessionIdentifiedAs: aCartId do: [ :cartSession | cartSession addToCart: anAmount of: aBook ]! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/29/2021 09:31:14' prior: 51067594!
listCartIdentifiedAs: aCartId

	^ self withCartSessionIdentifiedAs: aCartId do: [ :cartSession | cartSession cartContent ]! !
!CartSession methodsFor: 'cart' stamp: 'GRC 11/29/2021 09:31:26' prior: 51067023!
checkOutCartWithCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	^(Cashier
		toCheckout: cart
		ownedBy: owner
		charging: (CreditCard expiringOn: anExpirationMonthOfYear)
		throught: systemFacade merchantProcessor
		on: self today
		registeringOn: systemFacade salesBook) checkOut ! !
!CartSession methodsFor: 'initialization' stamp: 'GRC 11/29/2021 09:31:39' prior: 51066999!
initializeOwnedBy: aCustomer with: aCart on: aSystemFacade

	owner := aCustomer.
	cart := aCart.
	systemFacade := aSystemFacade.
	lastUsedTime := self now.! !
!TusLibrosSystemFacade methodsFor: 'initialization' stamp: 'GRC 11/29/2021 09:31:47' prior: 51067649!
initializeAuthenticatingWith: aValidUsersAndPasswords
	acceptingItemsOf: aCatalog
	registeringOn: aSalesBook
	debitingThrought: aMerchantProcessor
	measuringTimeWith: aClock

	validUsersAndPasswords := aValidUsersAndPasswords.
	catalog := aCatalog.
	salesBook := aSalesBook.
	merchantProcessor := aMerchantProcessor.
	clock := aClock.

	cartSessions := Dictionary new.
	lastId := 0.! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/29/2021 09:32:17' prior: 51080637!
createCartFor: aUser authenticatedWith: aPassword

	^ self if: aUser authenticatesWith: aPassword do: [ | cartId cartSession |

		cartId := self generateCartId.
		cartSession := CartSession ownedBy: aUser with: (Cart acceptingItemsOf: catalog) on: self.
		cartSessions at: cartId put: cartSession.

		cartId  ]! !
!TusLibrosSystemFacade class methodsFor: 'instance creation' stamp: 'GRC 11/29/2021 09:32:44' prior: 51067675!
authenticatingWith: aValidUsersAndPasswords
	acceptingItemsOf: aCatalog
	registeringOn: aSalesBook
	debitingThrought: aMerchantProcessor
	measuringTimeWith: aClock

	^self new
		initializeAuthenticatingWith: aValidUsersAndPasswords
		acceptingItemsOf: aCatalog
		registeringOn: aSalesBook
		debitingThrought: aMerchantProcessor
		measuringTimeWith: aClock! !
!TusLibrosSystemFacadeTest methodsFor: 'setup' stamp: 'GRC 11/29/2021 09:33:03' prior: 51068160!
createSalesBook

	^OrderedCollection new! !
!TusLibrosSystemFacadeTest methodsFor: 'setup' stamp: 'GRC 11/29/2021 09:33:05' prior: 51068165!
merchantProcessor

	^self! !
!TusLibrosSystemFacadeTest methodsFor: 'setup' stamp: 'GRC 11/29/2021 09:33:08' prior: 51068170 overrides: 16927572!
setUp

	testObjectsFactory := StoreTestObjectsFactory new.
	clock := ManualClock now: testObjectsFactory today.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: testObjectsFactory defaultCatalog
		registeringOn: self createSalesBook
		debitingThrought: self merchantProcessor
		measuringTimeWith: clock
! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - create cart' stamp: 'GRC 11/29/2021 09:33:30' prior: 51068115!
test01CanCreateCartWithValidUserAndPassword

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty
	! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/29/2021 09:33:40' prior: 51068056!
test14ListPurchasesIncludesBoughtItems

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: (testObjectsFactory itemSellByTheStorePrice * 2).
	self assert: (purchases at: self anotherValidBook) equals: testObjectsFactory anotherItemSellByTheStorePrice.! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/29/2021 09:33:49' prior: 51068086!
test15CanNotListPurchasesOfInvalidCustomer

	self
		should: [systemFacade listPurchasesOf: self invalidUser authenticatingWith: self validUserPassword ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidUserAndOrPasswordErrorDescription ]! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/29/2021 09:33:51' prior: 51068100!
test16CanNotListPurchasesOfValidCustomerWithInvalidPassword

	self
		should: [systemFacade listPurchasesOf: self validUser authenticatingWith: self invalidPassword ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidUserAndOrPasswordErrorDescription ]! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/29/2021 09:33:54' prior: 51029222!
test17ListPurchasesOnlyIncludesUserPurchases

	| cartId cartId2 purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	cartId2 _ systemFacade createCartFor: self anotherValidUser authenticatedWith: self validUserPassword. 
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId2.
	
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.
		
	systemFacade
		checkOutCartIdentifiedAs: cartId2
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: 2.
	self assert: (purchases at: self anotherValidBook) equals: 1.
	self assert: (purchases at: 'totalAmount') equals: 35.! !

----STARTUP---- (29 November 2021 09:36:37) as C:\Users\Guido\Desktop\TusLibros Actualizado\CuisUniversity-4972.image!

!TusLibrosSystemFacadeTest methodsFor: 'tests - add to cart' stamp: 'GRC 11/29/2021 09:27:27' prior: 51068033!
test17CanNotAddToCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self advanceTime: (systemFacade sessionDuration + 1 minutes) .
	self
		should: [systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self revertTime: systemFacade sessionDuration.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
! !
!TusLibrosSystemFacadeTest methodsFor: 'test objects' stamp: 'GRC 11/29/2021 09:28:59' prior: 51068232!
validUsersAndPasswords

	^Dictionary new
		at: self validUser put: self validUserPassword;		at: self anotherValidUser put: self validUserPassword;
		yourself! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/29/2021 09:30:58' prior: 51067602!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ | sales |
		sales := self salesDoneBy: aUser.
		sales
			inject: Dictionary new
			into: [ :salesOrderedByBook :aSale |
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook ] ]! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/29/2021 09:31:04' prior: 51067580!
createCartFor: aUser authenticatedWith: aPassword

	^ self if: aUser authenticatesWith: aPassword do: [ | cartId cartSession |

		cartId := self generateCartId.
		cartSession := CartSession ownedBy: aUser with: (Cart acceptingItemsOf: catalog) on: self..
		cartSessions at: cartId put: cartSession.

		cartId  ]! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/29/2021 09:31:09' prior: 51067556!
add: anAmount of: aBook toCartIdentifiedAs: aCartId

	self withCartSessionIdentifiedAs: aCartId do: [ :cartSession | cartSession addToCart: anAmount of: aBook ]! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/29/2021 09:31:14' prior: 51067594!
listCartIdentifiedAs: aCartId

	^ self withCartSessionIdentifiedAs: aCartId do: [ :cartSession | cartSession cartContent ]! !
!CartSession methodsFor: 'cart' stamp: 'GRC 11/29/2021 09:31:26' prior: 51067023!
checkOutCartWithCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	^(Cashier
		toCheckout: cart
		ownedBy: owner
		charging: (CreditCard expiringOn: anExpirationMonthOfYear)
		throught: systemFacade merchantProcessor
		on: self today
		registeringOn: systemFacade salesBook) checkOut ! !
!CartSession methodsFor: 'initialization' stamp: 'GRC 11/29/2021 09:31:39' prior: 51066999!
initializeOwnedBy: aCustomer with: aCart on: aSystemFacade

	owner := aCustomer.
	cart := aCart.
	systemFacade := aSystemFacade.
	lastUsedTime := self now.! !
!TusLibrosSystemFacade methodsFor: 'initialization' stamp: 'GRC 11/29/2021 09:31:47' prior: 51067649!
initializeAuthenticatingWith: aValidUsersAndPasswords
	acceptingItemsOf: aCatalog
	registeringOn: aSalesBook
	debitingThrought: aMerchantProcessor
	measuringTimeWith: aClock

	validUsersAndPasswords := aValidUsersAndPasswords.
	catalog := aCatalog.
	salesBook := aSalesBook.
	merchantProcessor := aMerchantProcessor.
	clock := aClock.

	cartSessions := Dictionary new.
	lastId := 0.! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/29/2021 09:32:17' prior: 51080916!
createCartFor: aUser authenticatedWith: aPassword

	^ self if: aUser authenticatesWith: aPassword do: [ | cartId cartSession |

		cartId := self generateCartId.
		cartSession := CartSession ownedBy: aUser with: (Cart acceptingItemsOf: catalog) on: self.
		cartSessions at: cartId put: cartSession.

		cartId  ]! !
!TusLibrosSystemFacade class methodsFor: 'instance creation' stamp: 'GRC 11/29/2021 09:32:44' prior: 51067675!
authenticatingWith: aValidUsersAndPasswords
	acceptingItemsOf: aCatalog
	registeringOn: aSalesBook
	debitingThrought: aMerchantProcessor
	measuringTimeWith: aClock

	^self new
		initializeAuthenticatingWith: aValidUsersAndPasswords
		acceptingItemsOf: aCatalog
		registeringOn: aSalesBook
		debitingThrought: aMerchantProcessor
		measuringTimeWith: aClock! !
!TusLibrosSystemFacadeTest methodsFor: 'setup' stamp: 'GRC 11/29/2021 09:33:03' prior: 51068160!
createSalesBook

	^OrderedCollection new! !
!TusLibrosSystemFacadeTest methodsFor: 'setup' stamp: 'GRC 11/29/2021 09:33:05' prior: 51068165!
merchantProcessor

	^self! !
!TusLibrosSystemFacadeTest methodsFor: 'setup' stamp: 'GRC 11/29/2021 09:33:08' prior: 51068170 overrides: 16927572!
setUp

	testObjectsFactory := StoreTestObjectsFactory new.
	clock := ManualClock now: testObjectsFactory today.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: testObjectsFactory defaultCatalog
		registeringOn: self createSalesBook
		debitingThrought: self merchantProcessor
		measuringTimeWith: clock
! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - create cart' stamp: 'GRC 11/29/2021 09:33:30' prior: 51068115!
test01CanCreateCartWithValidUserAndPassword

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty
	! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/29/2021 09:33:40' prior: 51068056!
test14ListPurchasesIncludesBoughtItems

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: (testObjectsFactory itemSellByTheStorePrice * 2).
	self assert: (purchases at: self anotherValidBook) equals: testObjectsFactory anotherItemSellByTheStorePrice.! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/29/2021 09:33:49' prior: 51068086!
test15CanNotListPurchasesOfInvalidCustomer

	self
		should: [systemFacade listPurchasesOf: self invalidUser authenticatingWith: self validUserPassword ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidUserAndOrPasswordErrorDescription ]! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/29/2021 09:33:51' prior: 51068100!
test16CanNotListPurchasesOfValidCustomerWithInvalidPassword

	self
		should: [systemFacade listPurchasesOf: self validUser authenticatingWith: self invalidPassword ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidUserAndOrPasswordErrorDescription ]! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/29/2021 09:33:54' prior: 51029222!
test17ListPurchasesOnlyIncludesUserPurchases

	| cartId cartId2 purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	cartId2 _ systemFacade createCartFor: self anotherValidUser authenticatedWith: self validUserPassword. 
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId2.
	
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.
		
	systemFacade
		checkOutCartIdentifiedAs: cartId2
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: 2.
	self assert: (purchases at: self anotherValidBook) equals: 1.
	self assert: (purchases at: 'totalAmount') equals: 35.! !

----SNAPSHOT----(29 November 2021 09:36:48) CuisUniversity-4972.image priorSource: 23952899!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 09:37:05'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 09:37:05'!
FAILURE!

----STARTUP---- (29 November 2021 09:37:23) as C:\Users\Guido\Desktop\TusLibros Actualizado\CuisUniversity-4972.image!


!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/29/2021 09:37:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/29/2021 09:37:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 09:37:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/29/2021 09:37:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 09:37:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/29/2021 09:37:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/29/2021 09:37:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/29/2021 09:37:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/29/2021 09:37:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 09:37:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 09:37:32'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/29/2021 09:37:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 09:37:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 09:37:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/29/2021 09:37:32'!
FAILURE!

----STARTUP---- (29 November 2021 09:37:50) as C:\Users\Guido\Desktop\TusLibros Actualizado\CuisUniversity-4972.image!


TusLibrosRestInterface allInstancesDo: [:unServidor | unServidor destroy].!

----SNAPSHOT----(29 November 2021 09:38:21) CuisUniversity-4972.image priorSource: 23983851!
!TusLibrosSystemFacadeTest methodsFor: 'tests - add to cart' stamp: 'GRC 11/29/2021 09:38:50'!
test18CanNotAddToCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self advanceTime: (systemFacade sessionDuration + 1 minutes) .
	self
		should: [systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self revertTime: systemFacade sessionDuration.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
! !

!methodRemoval: TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 09:38:50'!
test17CanNotAddToCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self advanceTime: (systemFacade sessionDuration + 1 minutes) .
	self
		should: [systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self revertTime: systemFacade sessionDuration.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
!
!TusLibrosSystemFacadeTest methodsFor: 'tests - add to cart' stamp: 'GRC 11/29/2021 09:39:02'!
test19CanNotAddToCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self advanceTime: (systemFacade sessionDuration + 1 minutes) .
	self
		should: [systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self revertTime: systemFacade sessionDuration.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
! !

!methodRemoval: TusLibrosSystemFacadeTest #test18CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 09:39:02'!
test18CanNotAddToCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self advanceTime: (systemFacade sessionDuration + 1 minutes) .
	self
		should: [systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self revertTime: systemFacade sessionDuration.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
!
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'GRC 11/29/2021 09:39:10'!
test20CanNotCheckOutCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	self advanceTime: (systemFacade sessionDuration + 1 minutes) .
	self should: [
		systemFacade
			checkOutCartIdentifiedAs: cartId
			withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
			ownedBy: testObjectsFactory notExpiredCreditCardOwner
			expiringOn: testObjectsFactory notExpiredMonthOfYear ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self assert: (systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword) isEmpty ]


	! !

!methodRemoval: TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 09:39:10'!
test19CanNotCheckOutCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	self advanceTime: (systemFacade sessionDuration + 1 minutes) .
	self should: [
		systemFacade
			checkOutCartIdentifiedAs: cartId
			withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
			ownedBy: testObjectsFactory notExpiredCreditCardOwner
			expiringOn: testObjectsFactory notExpiredMonthOfYear ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self assert: (systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword) isEmpty ]


	!
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'GRC 11/29/2021 09:39:17'!
test21CanNotCheckOutCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	self advanceTime: (systemFacade sessionDuration + 1 minutes) .
	self should: [
		systemFacade
			checkOutCartIdentifiedAs: cartId
			withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
			ownedBy: testObjectsFactory notExpiredCreditCardOwner
			expiringOn: testObjectsFactory notExpiredMonthOfYear ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self assert: (systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword) isEmpty ]


	! !

!methodRemoval: TusLibrosSystemFacadeTest #test20CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 09:39:17'!
test20CanNotCheckOutCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	self advanceTime: (systemFacade sessionDuration + 1 minutes) .
	self should: [
		systemFacade
			checkOutCartIdentifiedAs: cartId
			withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
			ownedBy: testObjectsFactory notExpiredCreditCardOwner
			expiringOn: testObjectsFactory notExpiredMonthOfYear ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self assert: (systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword) isEmpty ]


	!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 09:39:29'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 09:39:29'!
FAILURE!
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/29/2021 09:40:16' prior: 51081108!
test17ListPurchasesOnlyIncludesUserPurchases

	| cartId cartId2 purchases |

	cartId _ systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	cartId2 _ systemFacade createCartFor: self anotherValidUser authenticatedWith: self validUserPassword. 
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId2.
	
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.
		
	systemFacade
		checkOutCartIdentifiedAs: cartId2
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: 2.
	self assert: (purchases at: self anotherValidBook) equals: 1.
	self assert: (purchases at: 'totalAmount') equals: 35.! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/29/2021 09:40:55' prior: 51081517!
test17ListPurchasesOnlyIncludesUserPurchases

	| cartId cartId2 purchases |
	
	systemFacade clearSalesBook.

	cartId _ systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	cartId2 _ systemFacade createCartFor: self anotherValidUser authenticatedWith: self validUserPassword. 
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId2.
	
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.
		
	systemFacade
		checkOutCartIdentifiedAs: cartId2
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: 2.
	self assert: (purchases at: self anotherValidBook) equals: 1.
	self assert: (purchases at: 'totalAmount') equals: 35.! !
!TusLibrosSystemFacade methodsFor: 'private' stamp: 'GRC 11/29/2021 09:41:41'!
clearSalesBook

	salesBook _ OrderedCollection new.! !

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 09:41:55'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 09:41:55'!
FAILURE!
!Cashier methodsFor: 'checkout - private' stamp: 'GRC 11/29/2021 09:43:49' prior: 51067087!
createTicket

	| lineItems |

	lineItems := OrderedCollection new.
	cart itemsAndQuantitiesDo: [ :anItem :aQuantity |
		lineItems add: (self createLineItemOf: anItem quantity: aQuantity)].

	ticket := Ticket of: lineItems
	! !
!Cart methodsFor: 'initialization' stamp: 'GRC 11/29/2021 09:44:03' prior: 51066887!
initializeAcceptingItemsOf: aCatalog

	catalog := aCatalog.
	items := Bag new.! !
!Cart methodsFor: 'content' stamp: 'GRC 11/29/2021 09:44:13' prior: 51066875!
itemsAndQuantitiesDo: aBlock

	^ items contents keysAndValuesDo: [ :anItem :aQuantity | aBlock value: anItem value: aQuantity ]! !
!Cart methodsFor: 'adding' stamp: 'GRC 11/29/2021 09:44:24' prior: 51066918!
add: aQuantity of: anItem

	self assertIsValidQuantity: aQuantity.
	self assertIsValidItem: anItem.

	items add: anItem withOccurrences: aQuantity ! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/29/2021 09:48:37' prior: 51081556!
test17ListPurchasesOnlyIncludesUserPurchases

	| cartId cartId2 purchases |

	cartId _ systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	cartId2 _ systemFacade createCartFor: self anotherValidUser authenticatedWith: self validUserPassword. 
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId2.
	
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.
		
	systemFacade
		checkOutCartIdentifiedAs: cartId2
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: 2.
	self assert: (purchases at: self anotherValidBook) equals: 1.
	self assert: (purchases at: 'totalAmount') equals: 35.! !

----SNAPSHOT----(29 November 2021 09:48:41) CuisUniversity-4972.image priorSource: 23988643!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 09:49:03'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 09:49:03'!
FAILURE!

----STARTUP---- (29 November 2021 09:51:42) as C:\Users\Guido\Desktop\TusLibros Actualizado\CuisUniversity-4972.image!

!Cashier methodsFor: 'checkout' stamp: 'GRC 11/29/2021 09:52:47' prior: 51067115!
checkOut

	self createTicket.
	self debitTotal.
	self registerSale.

	^ ticket ! !
!LineItem methodsFor: 'initialization' stamp: 'GRC 11/29/2021 09:54:03' prior: 51067281!
initializeOf: anItem quantity: aQuantity total: aTotal

	item := anItem.
	quantity := aQuantity.
	total := aTotal

! !
!TusLibrosSystemFacade methodsFor: 'private' stamp: 'GRC 11/29/2021 09:56:42' prior: 51067625!
list: aSale on: salesOrderedByBook

	"Esto es un indicio de que por ahi conviene empezar a pensar en modelar un SaleBook - Hernan"
	aSale lineItemsDo: [ :aLineItem | | oldTotal newTotal |
		oldTotal := salesOrderedByBook at: aLineItem item ifAbsentPut: [ 0 ].
		newTotal := oldTotal + aLineItem total.
		salesOrderedByBook at: aLineItem item put: newTotal ]! !
!TusLibrosSystemFacade methodsFor: 'initialization' stamp: 'GRC 11/29/2021 09:58:51' prior: 51080969!
initializeAuthenticatingWith: aValidUsersAndPasswords
	acceptingItemsOf: aCatalog
	registeringOn: aSalesBook
	debitingThrought: aMerchantProcessor
	measuringTimeWith: aClock

	validUsersAndPasswords := aValidUsersAndPasswords.
	catalog := aCatalog.
	salesBook := SalesBook new.
	merchantProcessor := aMerchantProcessor.
	clock := aClock.

	cartSessions := Dictionary new.
	lastId := 0.! !
!TusLibrosSystemFacade methodsFor: 'private' stamp: 'GRC 11/29/2021 10:00:38' prior: 51067640!
salesDoneBy: aUser

	"Esto es un indicio de que por ahi conviene empezar a pensar en modelar un SaleBook - Hernan"
	"^ salesBook select: [ :aSale | aSale wasDoneBy: aUser ]"
	
	^salesBook salesDoneBy: aUser.! !
!SalesBook methodsFor: 'nil' stamp: 'GRC 11/29/2021 10:01:25'!
salesDoneBy: aUser

	^sales select: [:aSale | aSale wasDoneBy: aUser].! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/29/2021 10:02:39' prior: 51080903!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ | sales |
		salesBook listPurchasesOf: aUser. 
		sales := self salesDoneBy: aUser.
		sales
			inject: Dictionary new
			into: [ :salesOrderedByBook :aSale |
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook ] ]! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/29/2021 10:03:42' prior: 51081751!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ | result |
		result _ Dictionary new.
		salesBook listPurchasesOf: aUser on: result. 
		"sales := self salesDoneBy: aUser.
		sales
			inject: Dictionary new
			into: [ :salesOrderedByBook :aSale |
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook ]" ]! !
!SalesBook methodsFor: 'list purchases' stamp: 'GRC 11/29/2021 10:04:25' prior: 51028300!
register: aSale on: userPurchases

	| total |

	total _ 0.

	aSale lineItemsDo: [ :aLineItem | | oldTotal newTotal |
				oldTotal := userPurchases at: aLineItem item ifAbsentPut: [ 0 ].
				newTotal := oldTotal + aLineItem total.
				total _ total + newTotal.
				userPurchases at: aLineItem item put: aLineItem quantity].
			
	^total.! !

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 10:04:39'!
PASSED!

----SNAPSHOT----(29 November 2021 10:04:42) CuisUniversity-4972.image priorSource: 24000842!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 10:04:47'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/29/2021 10:04:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 10:04:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/29/2021 10:04:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/29/2021 10:04:48'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/29/2021 10:04:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/29/2021 10:04:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 10:04:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/29/2021 10:04:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 10:04:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 10:04:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/29/2021 10:04:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 10:04:48'!
PASSED!

----SNAPSHOT----(29 November 2021 10:04:58) CuisUniversity-4972.image priorSource: 24004688!
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'GRC 11/29/2021 10:05:11' prior: 51068239!
test10CanCheckoutACart

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
		ownedBy: testObjectsFactory notExpiredCreditCardOwner
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: testObjectsFactory itemSellByTheStorePrice.
! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'GRC 11/29/2021 10:05:31' prior: 51081937!
test10CanCheckoutACart

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
		ownedBy: testObjectsFactory notExpiredCreditCardOwner
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: 'total amount') equals: testObjectsFactory itemSellByTheStorePrice.
! !

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 10:05:32'!
ERROR!
!SalesBook methodsFor: 'list purchases' stamp: 'GRC 11/29/2021 10:05:49' prior: 51028288!
listPurchasesOf: aUser on: userPurchases

	| total |
	
	total _ 0.

	^sales inject: userPurchases
		into: [ :purchases :aSale |
			(aSale wasDoneBy: aUser) ifTrue: [ total _ total + (self register: aSale on: purchases)].
			purchases at: 'total amount' put: total.
			purchases.
		].! !

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 10:06:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/29/2021 10:06:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/29/2021 10:06:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/29/2021 10:06:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/29/2021 10:06:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/29/2021 10:06:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/29/2021 10:06:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/29/2021 10:06:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/29/2021 10:06:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/29/2021 10:06:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 10:06:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/29/2021 10:06:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 10:06:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/29/2021 10:06:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/29/2021 10:06:02'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/29/2021 10:06:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/29/2021 10:06:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 10:06:02'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/29/2021 10:06:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 10:06:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 10:06:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/29/2021 10:06:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 10:06:02'!
PASSED!
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/29/2021 10:06:11' prior: 51081639!
test17ListPurchasesOnlyIncludesUserPurchases

	| cartId cartId2 purchases |

	cartId _ systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	cartId2 _ systemFacade createCartFor: self anotherValidUser authenticatedWith: self validUserPassword. 
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId2.
	
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.
		
	systemFacade
		checkOutCartIdentifiedAs: cartId2
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: 2.
	self assert: (purchases at: self anotherValidBook) equals: 1.
	self assert: (purchases at: 'total amount') equals: 35.! !

----SNAPSHOT----(29 November 2021 10:06:18) CuisUniversity-4972.image priorSource: 24009033!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/29/2021 10:06:21'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 10:06:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/29/2021 10:06:21'!
FAILURE!
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 11/29/2021 10:07:29' prior: 51081050!
test14ListPurchasesIncludesBoughtItems

	| cartId purchases total |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	total _ (testObjectsFactory itemSellByTheStorePrice * 2) + (testObjectsFactory anotherItemSellByTheStorePrice).
	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: 2.
	self assert: (purchases at: self anotherValidBook) equals: 1.
	self assert: (purchases at: 'total amount') equals: total.! !

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/29/2021 10:07:30'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 10:07:47'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'GRC 11/29/2021 10:07:47'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'GRC 11/29/2021 10:07:47'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'GRC 11/29/2021 10:07:47'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 10:07:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 10:07:53'!
PASSED!

----SNAPSHOT----(29 November 2021 10:07:58) CuisUniversity-4972.image priorSource: 24015179!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/29/2021 10:08:37' prior: 51081765!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ | result |
		result _ Dictionary new.
		salesBook listPurchasesOf: aUser on: result. 
		].! !

!methodRemoval: TusLibrosSystemFacade #clearSalesBook stamp: 'GRC 11/29/2021 10:08:54'!
clearSalesBook

	salesBook _ OrderedCollection new.!

!methodRemoval: TusLibrosSystemFacade #list:on: stamp: 'GRC 11/29/2021 10:08:55'!
list: aSale on: salesOrderedByBook

	"Esto es un indicio de que por ahi conviene empezar a pensar en modelar un SaleBook - Hernan"
	aSale lineItemsDo: [ :aLineItem | | oldTotal newTotal |
		oldTotal := salesOrderedByBook at: aLineItem item ifAbsentPut: [ 0 ].
		newTotal := oldTotal + aLineItem total.
		salesOrderedByBook at: aLineItem item put: newTotal ]!

!methodRemoval: TusLibrosSystemFacade #salesDoneBy: stamp: 'GRC 11/29/2021 10:08:56'!
salesDoneBy: aUser

	"Esto es un indicio de que por ahi conviene empezar a pensar en modelar un SaleBook - Hernan"
	"^ salesBook select: [ :aSale | aSale wasDoneBy: aUser ]"
	
	^salesBook salesDoneBy: aUser.!
!TusLibrosSystemFacadeTest methodsFor: 'setup' stamp: 'GRC 11/29/2021 10:10:11' prior: 51081014!
createSalesBook

	^SalesBook new.! !
!TusLibrosSystemFacade methodsFor: 'initialization' stamp: 'GRC 11/29/2021 10:10:28' prior: 51081720!
initializeAuthenticatingWith: aValidUsersAndPasswords
	acceptingItemsOf: aCatalog
	registeringOn: aSalesBook
	debitingThrought: aMerchantProcessor
	measuringTimeWith: aClock

	validUsersAndPasswords := aValidUsersAndPasswords.
	catalog := aCatalog.
	salesBook := aSalesBook.
	merchantProcessor := aMerchantProcessor.
	clock := aClock.

	cartSessions := Dictionary new.
	lastId := 0.! !

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/29/2021 10:10:42'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'GRC 11/29/2021 10:10:42'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'GRC 11/29/2021 10:10:42'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'GRC 11/29/2021 10:10:42'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'GRC 11/29/2021 10:10:42'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'GRC 11/29/2021 10:10:42'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'GRC 11/29/2021 10:10:42'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'GRC 11/29/2021 10:10:42'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'GRC 11/29/2021 10:10:42'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 10:10:42'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'GRC 11/29/2021 10:10:42'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'GRC 11/29/2021 10:10:42'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'GRC 11/29/2021 10:10:42'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'GRC 11/29/2021 10:10:42'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'GRC 11/29/2021 10:10:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/29/2021 10:10:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/29/2021 10:10:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/29/2021 10:10:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/29/2021 10:10:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/29/2021 10:10:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/29/2021 10:10:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/29/2021 10:10:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/29/2021 10:10:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/29/2021 10:10:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 10:10:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/29/2021 10:10:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 10:10:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/29/2021 10:10:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/29/2021 10:10:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/29/2021 10:10:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/29/2021 10:10:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 10:10:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/29/2021 10:10:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 10:10:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 10:10:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/29/2021 10:10:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 10:10:43'!
PASSED!

----SNAPSHOT----(29 November 2021 10:10:46) CuisUniversity-4972.image priorSource: 24023606!

!classRenamed: #TusLibrosWindow as: #TusLibrosLoginWindow stamp: 'GRC 11/29/2021 10:15:54'!
Smalltalk renameClassNamed: #TusLibrosWindow as: #TusLibrosLoginWindow!

!classRenamed: #TusLibrosWindowModel as: #TusLibrosLoginWindowModel stamp: 'GRC 11/29/2021 10:16:01'!
Smalltalk renameClassNamed: #TusLibrosWindowModel as: #TusLibrosLoginWindowModel!
!TusLibrosLoginWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 10:16:01' prior: 51069053!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TusLibrosLoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #validLogin send: #openCatalogue: to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

Panel subclass: #TusLibrosWindows
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TusLibrosWindows category: 'TusLibros-View' stamp: 'GRC 11/29/2021 10:17:06'!
Panel subclass: #TusLibrosWindows
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

TusLibrosWindows subclass: #CatalogueWindow
	instanceVariableNames: 'catalogueMorph cartMorph cartMorphList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #CatalogueWindow category: 'TusLibros-View' stamp: 'GRC 11/29/2021 10:17:34'!
TusLibrosWindows subclass: #CatalogueWindow
	instanceVariableNames: 'catalogueMorph cartMorph cartMorphList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classRemoval: #CatalogueWindow stamp: 'GRC 11/29/2021 10:17:44'!
TusLibrosWindows subclass: #CatalogueWindow
	instanceVariableNames: 'catalogueMorph cartMorph cartMorphList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classRenamed: #TusLibrosCatalogueWindow as: #CatalogueWindow stamp: 'GRC 11/29/2021 10:18:17'!
Smalltalk renameClassNamed: #TusLibrosCatalogueWindow as: #CatalogueWindow!
!TusLibrosLoginWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 10:18:17' prior: 51069068!
openCatalogue: aCartId

	CatalogueWindow openFor: aCartId.
	
	self closeButtonClicked.! !

!classRenamed: #TusLibrosLoginWindow as: #LoginWindow stamp: 'GRC 11/29/2021 10:19:04'!
Smalltalk renameClassNamed: #TusLibrosLoginWindow as: #LoginWindow!

!classRenamed: #TusLibrosTicketWindow as: #TicketWindow stamp: 'GRC 11/29/2021 10:19:11'!
Smalltalk renameClassNamed: #TusLibrosTicketWindow as: #TicketWindow!
!CatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 10:19:11' prior: 51079934!
openTicket: aTicket

	TicketWindow openFor: aTicket.
	
	"self closeButtonClicked."! !

TusLibrosWindows subclass: #CatalogueWindow
	instanceVariableNames: 'catalogueMorph cartMorph cartMorphList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #CatalogueWindow category: 'TusLibros-View' stamp: 'GRC 11/29/2021 10:19:47'!
TusLibrosWindows subclass: #CatalogueWindow
	instanceVariableNames: 'catalogueMorph cartMorph cartMorphList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

----SNAPSHOT----(29 November 2021 10:20:00) CuisUniversity-4972.image priorSource: 24029783!

TusLibrosWindows subclass: #LoginWindow
	instanceVariableNames: 'clientIdTextBoxMorph passwordTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #LoginWindow category: 'TusLibros-View' stamp: 'GRC 11/29/2021 10:20:09'!
TusLibrosWindows subclass: #LoginWindow
	instanceVariableNames: 'clientIdTextBoxMorph passwordTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

TusLibrosWindows subclass: #TicketWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TicketWindow category: 'TusLibros-View' stamp: 'GRC 11/29/2021 10:20:14'!
TusLibrosWindows subclass: #TicketWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

Object subclass: #TusLibrosWindowModels
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TusLibrosWindowModels category: 'TusLibros-View' stamp: 'GRC 11/29/2021 10:21:19'!
Object subclass: #TusLibrosWindowModels
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classRenamed: #TusLibrosCatalogueWindowModel as: #CatalogueModel stamp: 'GRC 11/29/2021 10:21:33'!
Smalltalk renameClassNamed: #TusLibrosCatalogueWindowModel as: #CatalogueModel!
!CatalogueWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 10:21:33' prior: 51079313!
initializeWith: aTitle for: cartId

    self titleMorph showButtonsNamed: #(#close #collapse ).
    self setLabel: aTitle.
    self model: (CatalogueModel new initializeWith: cartId).
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.
    self model
        when: #updateCart
        send: #reloadCart
        to: self.
    self model
        when: #openTicket
        send: #openTicket:
        to: self.! !

TusLibrosWindowModels subclass: #CatalogueModel
	instanceVariableNames: 'restInterface cartId catalogue cartIndex catalogueListIndex'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #CatalogueModel category: 'TusLibros-View' stamp: 'GRC 11/29/2021 10:21:43'!
TusLibrosWindowModels subclass: #CatalogueModel
	instanceVariableNames: 'restInterface cartId catalogue cartIndex catalogueListIndex'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classRenamed: #TusLibrosLoginWindowModel as: #LoginModel stamp: 'GRC 11/29/2021 10:21:53'!
Smalltalk renameClassNamed: #TusLibrosLoginWindowModel as: #LoginModel!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 10:21:54' prior: 51082596!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #validLogin send: #openCatalogue: to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

TusLibrosWindowModels subclass: #LoginModel
	instanceVariableNames: 'clientId password words restInterface sentence cartId'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #LoginModel category: 'TusLibros-View' stamp: 'GRC 11/29/2021 10:21:59'!
TusLibrosWindowModels subclass: #LoginModel
	instanceVariableNames: 'clientId password words restInterface sentence cartId'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

TusLibrosWindowModels subclass: #TicketModel
	instanceVariableNames: 'restInterface'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TicketModel category: 'TusLibros-View' stamp: 'GRC 11/29/2021 10:22:23'!
TusLibrosWindowModels subclass: #TicketModel
	instanceVariableNames: 'restInterface'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TicketModel methodsFor: 'no messages' stamp: 'GRC 11/29/2021 10:22:54' overrides: 16896425!
initialize

	restInterface _ TusLibrosInterface new.! !

----SNAPSHOT----(29 November 2021 10:23:10) CuisUniversity-4972.image priorSource: 24033191!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

server destroy.!

----SNAPSHOT----(29 November 2021 10:32:19) CuisUniversity-4972.image priorSource: 24037527!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

server destroy.!

----QUIT----(29 November 2021 10:33:31) CuisUniversity-4972.image priorSource: 24037712!

----STARTUP---- (29 November 2021 12:06:26) as C:\Users\Guido\Desktop\TusLibros Actualizado\CuisUniversity-4972.image!


server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!LoginModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 12:09:56' prior: 51069201!
sendCredentialsFromLoginRequest

	cartId _ restInterface sendLoginRequest: {'clientId'. clientId. 'password'. password}.
	
	(cartId < 1) 
		ifTrue: [self triggerEvent: #invalidLogin] 
		ifFalse: [self triggerEvent: #validLogin with: cartId].! !
!LoginWindow methodsFor: 'initialization' stamp: 'GRC 11/29/2021 12:11:11' prior: 51082775!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model 
		when: #validLogin 
		send: #openCatalogue: to: self.
		
	self model 
		when: #invalidLogin 
		send: #showInvalidLoginMessage to: self.! !
!LoginWindow methodsFor: 'operations' stamp: 'GRC 11/29/2021 12:11:48'!
showInvalidLoginMessage
! !
!LoginWindow methodsFor: 'operations' stamp: 'GRC 11/29/2021 12:12:39' prior: 51082870!
showInvalidLoginMessage

	self addMorph: self buildInvalidLoginMessage.! !
!LoginWindow methodsFor: 'building' stamp: 'GRC 11/29/2021 12:13:16'!
buildInvalidLoginMessage

	| secondRowLayoutMorph |
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #passwordText textSetter: #passwordText:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter password:');
	addMorph: passwordTextBoxMorph.
	
	^secondRowLayoutMorph.! !
!LoginWindow methodsFor: 'building' stamp: 'GRC 11/29/2021 12:13:24' prior: 51082879!
buildInvalidLoginMessage

	| fourthRowLayoutMorph |
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #passwordText textSetter: #passwordText:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
		
	fourthRowLayoutMorph := LayoutMorph newRow.
	fourthRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter password:');
	addMorph: passwordTextBoxMorph.
	
	^fourthRowLayoutMorph.! !

!classDefinition: #LoginWindow category: 'TusLibros-View' stamp: 'GRC 11/29/2021 12:13:57'!
TusLibrosWindows subclass: #LoginWindow
	instanceVariableNames: 'clientIdTextBoxMorph messageTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 12:13:57' prior: 51069004!
build2ndRow

	| secondRowLayoutMorph |
	
	messageTextBoxMorph := TextModelMorph textProvider: self model textGetter: #passwordText textSetter: #passwordText:. 
	messageTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | messageTextBoxMorph innerTextMorph acceptContents ] .
	messageTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter password:');
	addMorph: messageTextBoxMorph.
	
	^secondRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 12:13:57' prior: 51082901!
buildInvalidLoginMessage

	| fourthRowLayoutMorph |
	
	messageTextBoxMorph := TextModelMorph textProvider: self model textGetter: #passwordText textSetter: #passwordText:. 
	messageTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | messageTextBoxMorph innerTextMorph acceptContents ] .
	messageTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
		
	fourthRowLayoutMorph := LayoutMorph newRow.
	fourthRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter password:');
	addMorph: messageTextBoxMorph.
	
	^fourthRowLayoutMorph.! !
!LoginWindow methodsFor: 'building' stamp: 'GRC 11/29/2021 12:15:24' prior: 51082954!
buildInvalidLoginMessage

	| fourthRowLayoutMorph |
	
	fourthRowLayoutMorph := LayoutMorph newRow.
	fourthRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Invalid Credentials, please try again.').
	
	^fourthRowLayoutMorph.! !

LoginWindow open.!
!LoginWindow methodsFor: 'building' stamp: 'GRC 11/29/2021 12:17:41'!
buildMorphicWindowLoginInvalido
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow;
	addMorph: self buildInvalidLoginMessage.! !
!LoginWindow methodsFor: 'operations' stamp: 'GRC 11/29/2021 12:17:55' prior: 51082874!
showInvalidLoginMessage

	self buildMorphicWindowLoginInvalido.! !

LoginWindow open.!

!methodRemoval: LoginWindow #buildMorphicWindowLoginInvalido stamp: 'GRC 11/29/2021 12:18:11'!
buildMorphicWindowLoginInvalido
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow;
	addMorph: self buildInvalidLoginMessage.!
!LoginWindow methodsFor: 'operations' stamp: 'GRC 11/29/2021 12:18:27' prior: 51082998!
showInvalidLoginMessage

	self addMorph: self buildInvalidLoginMessage.! !
!LoginWindow methodsFor: 'operations' stamp: 'GRC 11/29/2021 12:20:21' prior: 51083014!
showInvalidLoginMessage

	self layoutMorph addMorph: self buildInvalidLoginMessage.! !

LoginWindow open.!
!LoginWindow methodsFor: 'building' stamp: 'GRC 11/29/2021 12:21:38'!
buildMorphicWindowLoginInvalido
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow;
	addMorph: self buildInvalidLoginMessage.! !
!LoginWindow methodsFor: 'operations' stamp: 'GRC 11/29/2021 12:22:00' prior: 51083020!
showInvalidLoginMessage

	self buildMorphicWindowLoginInvalido.
	self openInWorld.
	"self layoutMorph addMorph: self buildInvalidLoginMessage."! !

LoginWindow open.!

!classDefinition: #InvalidLoginWindow category: 'TusLibros-View' stamp: 'GRC 11/29/2021 12:23:23'!
TusLibrosWindows subclass: #InvalidLoginWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!LoginWindow methodsFor: 'operations' stamp: 'GRC 11/29/2021 12:23:10' prior: 51083036!
showInvalidLoginMessage

	InvalidLoginWindow open.
	"self layoutMorph addMorph: self buildInvalidLoginMessage."! !
!LoginWindow methodsFor: 'operations' stamp: 'GRC 11/29/2021 12:23:33' prior: 51083052!
showInvalidLoginMessage

	InvalidLoginWindow open.
	
	"self layoutMorph addMorph: self buildInvalidLoginMessage."! !
!InvalidLoginWindow class methodsFor: 'no messages' stamp: 'GRC 11/29/2021 12:24:14'!
open

	self new initializeWith: 'Invalid Login'.! !
!InvalidLoginWindow methodsFor: 'no messages' stamp: 'GRC 11/29/2021 12:24:23'!
initializeWith: aTitle! !
!InvalidLoginWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 12:24:54' prior: 51083071!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.! !
!InvalidLoginWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 12:25:16' overrides: 51073967!
defaultExtent

	^ 720@360! !
!InvalidLoginWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 12:25:29' overrides: 51073871!
buildMorphicWindow

	! !
!InvalidLoginWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 12:25:58' prior: 51083091 overrides: 51073871!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow.! !
!InvalidLoginWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 12:26:33'!
build1stRow

	| firstRowLayoutMorph |
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Invalid Credentials, please try again').
	
	^firstRowLayoutMorph.! !

LoginWindow open.!
!InvalidLoginWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 12:27:11' prior: 51083086 overrides: 51073967!
defaultExtent

	^ 480@360! !

LoginWindow open.!

----SNAPSHOT----(29 November 2021 12:27:37) CuisUniversity-4972.image priorSource: 24037897!
!TusLibrosRestInterface methodsFor: 'initialization' stamp: 'GRC 11/29/2021 12:29:50' prior: 51028443!
initializeWith: aPortNumber
	
	port := aPortNumber.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: StoreTestObjectsFactory new defaultCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: (ManualClock now: DateAndTime now).
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action: [:aRequest | self createCartAction: aRequest].
	webServer addService: '/addToCart' action: [:aRequest | self addToCartAction: aRequest].
	webServer addService: '/listCart' action: [:aRequest | self listCartAction: aRequest].
	webServer addService: '/checkoutCart' action: [:aRequest | self checkOutCartAction: aRequest].
	webServer addService: '/listPurchases' action: [:aRequest | self listPurchasesAction: aRequest].
	webServer addService: '/catalog' action: [:aRequest | self catalogAction: aRequest].! !
!StoreTestObjectsFactory methodsFor: 'cart' stamp: 'GRC 11/29/2021 12:30:07' prior: 51068536!
defaultCatalog

	^ Dictionary new
		at: self itemSellByTheStore put: self itemSellByTheStorePrice;
		at: self anotherItemSellByTheStore put: self anotherItemSellByTheStorePrice;
		yourself ! !

!methodRemoval: TusLibrosRestInterface #defaultCatalog stamp: 'GRC 11/29/2021 12:30:16'!
defaultCatalog

	^ Dictionary new
		at: self itemSellByTheStore put: self itemSellByTheStorePrice;
		at: self anotherItemSellByTheStore put: self anotherItemSellByTheStorePrice;
		yourself !

!methodRemoval: TusLibrosRestInterface #itemSellByTheStore stamp: 'GRC 11/29/2021 12:30:17'!
itemSellByTheStore

	^ 'validBook'!

!methodRemoval: TusLibrosRestInterface #itemSellByTheStorePrice stamp: 'GRC 11/29/2021 12:30:19'!
itemSellByTheStorePrice

	^10!

!methodRemoval: TusLibrosRestInterface #anotherItemSellByTheStore stamp: 'GRC 11/29/2021 12:30:20'!
anotherItemSellByTheStore

	^'anotherValidBook'!

!methodRemoval: TusLibrosRestInterface #anotherItemSellByTheStorePrice stamp: 'GRC 11/29/2021 12:30:22'!
anotherItemSellByTheStorePrice

	^15!

!classDefinition: #LoginDBMock category: #'TusLibros-Model' stamp: 'GRC 11/29/2021 12:32:09'!
Object subclass: #LoginDBMock
	instanceVariableNames: 'database'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosRestInterface methodsFor: 'initialization' stamp: 'GRC 11/29/2021 12:31:35' prior: 51083124!
initializeWith: aPortNumber
	
	port := aPortNumber.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: LoginDBMock new validUsersAndPasswords
		acceptingItemsOf: StoreTestObjectsFactory new defaultCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: (ManualClock now: DateAndTime now).
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action: [:aRequest | self createCartAction: aRequest].
	webServer addService: '/addToCart' action: [:aRequest | self addToCartAction: aRequest].
	webServer addService: '/listCart' action: [:aRequest | self listCartAction: aRequest].
	webServer addService: '/checkoutCart' action: [:aRequest | self checkOutCartAction: aRequest].
	webServer addService: '/listPurchases' action: [:aRequest | self listPurchasesAction: aRequest].
	webServer addService: '/catalog' action: [:aRequest | self catalogAction: aRequest].! !
!LoginDBMock methodsFor: 'no messages' stamp: 'GRC 11/29/2021 12:32:25' overrides: 16896425!
initialize

	database _ Dictionary new.! !
!LoginDBMock methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 12:32:47' prior: 51083234 overrides: 16896425!
initialize

	database _ Dictionary new
		at: 'validUser' put: 'validUserPassword';
		at: 'anotherValidUser' put: 'validUserPassword';
		at: '' put: '';
		yourself! !
!LoginDBMock methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 12:33:00'!
validUsersAndPasswords

	^database copy.! !

----SNAPSHOT----(29 November 2021 12:34:32) CuisUniversity-4972.image priorSource: 24047024!

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

server destroy.!

!methodRemoval: TusLibrosRestInterface #validUsersAndPasswords stamp: 'GRC 11/29/2021 12:34:57'!
validUsersAndPasswords

	^Dictionary new
		at: 'validUser' put: 'validUserPassword';
		at: 'anotherValidUser' put: 'validUserPassword';
		at: '' put: '';
		yourself!

----SNAPSHOT----(29 November 2021 12:35:06) CuisUniversity-4972.image priorSource: 24051211!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'GRC 11/29/2021 12:35:18'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'GRC 11/29/2021 12:35:18'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'GRC 11/29/2021 12:35:18'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'GRC 11/29/2021 12:35:18'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'GRC 11/29/2021 12:35:18'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'GRC 11/29/2021 12:35:18'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'GRC 11/29/2021 12:35:18'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'GRC 11/29/2021 12:35:18'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 12:35:18'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'GRC 11/29/2021 12:35:18'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'GRC 11/29/2021 12:35:18'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 12:35:19'!
PASSED!

----SNAPSHOT----(29 November 2021 12:35:31) CuisUniversity-4972.image priorSource: 24051678!

----QUIT----(29 November 2021 12:37:40) CuisUniversity-4972.image priorSource: 24055895!

----STARTUP---- (29 November 2021 12:41:05) as C:\Users\Guido\Desktop\TusLibros Actualizado\CuisUniversity-4972.image!


LoginWindow open.!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!CatalogueWindow methodsFor: 'building' stamp: 'GRC 11/29/2021 12:45:20' prior: 51069487 overrides: 51073871!
buildMorphicWindow
    | catalogueMorphList |
    
    catalogueMorph _ self buildColumn.
    catalogueMorphList _ self buildColumn.
    cartMorph _ self buildColumn.
    cartMorphList _ self buildColumn.
    
    self buildCatalogueOn: catalogueMorphList.
    catalogueMorph addMorph: catalogueMorphList.
    self buildButtonWithAction: #addBook andLabel: 'Add 1 book' in: catalogueMorph.
	self buildButtonWithAction: #removeBook andLabel: 'remove book' in: catalogueMorph.
    
    self buildCartOn: cartMorphList.
    cartMorph addMorph: cartMorphList.
    self buildButtonWithAction: #checkout andLabel: 'Checkout' in: cartMorph.
    
    self layoutMorph
        beRow;
        separation: 10;
        axisEdgeWeight: 0.5;
        addMorph: catalogueMorph;
        addMorph: cartMorph.! !

LoginWindow open.!
!CatalogueWindow methodsFor: 'initialization' stamp: 'GRC 11/29/2021 12:46:33' prior: 51082736!
initializeWith: aTitle for: cartId

    self titleMorph showButtonsNamed: #(#close #collapse ).
    self setLabel: aTitle.
    self model: (CatalogueModel new initializeWith: cartId).
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.

    self model
        when: #updateCart
        send: #reloadCart
        to: self.

    self model
        when: #openTicket
        send: #openTicket:
        to: self.! !
!CatalogueModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 12:48:14'!
removeBook

    | request bookIsbn |

    bookIsbn _ self selectedBook.

    request _ {'cartId'. cartId. 'bookIsbn'. bookIsbn. 'bookQuantity'. 1}.
    restInterface sendRemoveFromCartRequest: request.

    self triggerEvent: #updateCart.! !
!TusLibrosInterface methodsFor: 'requests' stamp: 'GRC 11/29/2021 12:48:28'!
sendRemoveFromCartRequest: aRequest

    | requestDictionary response |

    requestDictionary _ Dictionary newFromPairs: aRequest.
    response _ WebClient
        htmlSubmit: self url , '/addToCart'
        fields: requestDictionary.

    response isSuccess ifTrue: [ ^ response content ].
    ^ 'Error'.! !
!TusLibrosInterface methodsFor: 'requests' stamp: 'GRC 11/29/2021 12:48:38' prior: 51083467!
sendRemoveFromCartRequest: aRequest

    | requestDictionary response |

    requestDictionary _ Dictionary newFromPairs: aRequest.
    response _ WebClient
        htmlSubmit: self url , '/removeFromCart'
        fields: requestDictionary.

    response isSuccess ifTrue: [ ^ response content ].
    ^ 'Error'.! !
!TusLibrosInterface methodsFor: 'requests' stamp: 'GRC 11/29/2021 12:48:53' prior: 51083480!
sendRemoveFromCartRequest: aRequest

    | requestDictionary response |

    requestDictionary _ Dictionary newFromPairs: aRequest.
    response _ WebClient
        htmlSubmit: self url , '/removeFromCart'
        fields: requestDictionary.

    response isSuccess ifTrue: [ ^ response content ].
    ^ 'Error, no se pudo remover del carrito'.! !
!TusLibrosRestInterface methodsFor: 'initialization' stamp: 'GRC 11/29/2021 12:49:35' prior: 51083201!
initializeWith: aPortNumber
	
	port := aPortNumber.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: LoginDBMock new validUsersAndPasswords
		acceptingItemsOf: StoreTestObjectsFactory new defaultCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: (ManualClock now: DateAndTime now).
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action: [:aRequest | self createCartAction: aRequest].
	webServer addService: '/addToCart' action: [:aRequest | self addToCartAction: aRequest].
	webServer addService: '/listCart' action: [:aRequest | self listCartAction: aRequest].
	webServer addService: '/checkoutCart' action: [:aRequest | self checkOutCartAction: aRequest].
	webServer addService: '/listPurchases' action: [:aRequest | self listPurchasesAction: aRequest].
	webServer addService: '/catalog' action: [:aRequest | self catalogAction: aRequest].
	webServer addService: '/removeFromCart' action: [:aRequest | self removeFromCartAction: aRequest].! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/29/2021 12:50:17'!
removeFromCartAction: aRequest	

	[ | cartId bookIsbn bookQuantity |
		cartId := (aRequest fields at: 'cartId') asNumber.
		bookIsbn := aRequest fields at: 'bookIsbn'.
		bookQuantity := (aRequest fields at: 'bookQuantity') asNumber.
		
		tusLibros removeBook: bookIsbn fromCartIdentifiedAs: cartId.
	
		aRequest send200Response: 'OK'.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/29/2021 12:51:10'!
removeBook: bookIsbn fromCartIdentifiedAs: cartId

	! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/29/2021 12:51:47' prior: 51083560!
removeBook: aBook fromCartIdentifiedAs: aCartId

	self withCartSessionIdentifiedAs: aCartId do: [ :cartSession | cartSession removeFromCart: 1 of: aBook ]
	! !
!CartSession methodsFor: 'cart' stamp: 'GRC 11/29/2021 12:52:18'!
removeFromCart: anAmount of: aBook

	^cart remove: anAmount of: aBook! !
!Cart methodsFor: 'adding' stamp: 'GRC 11/29/2021 12:52:33'!
remove: anAmount of: aBook! !
!Cart methodsFor: 'adding' stamp: 'GRC 11/29/2021 12:52:39' prior: 51083578!
remove: anAmount of: aBook

	! !
!Cart methodsFor: 'adding' stamp: 'GRC 11/29/2021 12:53:07' prior: 51083582!
remove: aQuantity of: anItem

	self assertIsValidQuantity: aQuantity.
	self assertIsValidItem: anItem.

	items remove: anItem withOccurrences: aQuantity

	! !

----End fileIn of C:\Users\Guido\Desktop\TusLibros Actualizado\Packages\TerseGuide.pck.st----!
!Cart methodsFor: 'removing' stamp: 'GRC 11/29/2021 12:55:49' prior: 51083586!
remove: aQuantity of: anItem

	| cantidad |

	self assertIsValidQuantity: aQuantity.
	self assertIsValidItem: anItem.

	cantidad _ items occurrencesOf: anItem.

	items remove: anItem.
	items add: anItem withOccurrences: (cantidad - 1).

	! !

server destroy.!

LoginWindow open.!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

server destroy.!

LoginWindow open.!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!Cart methodsFor: 'removing' stamp: 'GRC 11/29/2021 13:01:32' prior: 51086520!
remove: aQuantity of: anItem

	| cantidad |

	self assertIsValidQuantity: aQuantity.
	self assertIsValidItem: anItem.

	cantidad _ items occurrencesOf: anItem.

	items remove: anItem.

	cantidad > 1 ifTrue: [items add: anItem withOccurrences: (cantidad - 1).].

	
	

	! !

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

server destroy.!
!CartSession methodsFor: 'cart' stamp: 'GRC 11/29/2021 13:02:26' prior: 51067014!
addToCart: anAmount of: aBook

	^cart add: anAmount of: aBook! !
!Cart methodsFor: 'adding' stamp: 'GRC 11/29/2021 13:02:52' prior: 51066913!
add: anItem

	^ self add: 1 of: anItem ! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - add to cart' stamp: 'GRC 11/29/2021 13:06:12' prior: 51067986!
test04CanAddItemsToACreatedCart

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 1
		! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:06:34'!
testCanRemoveItemsToACreatedCart

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 1
		! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:07:22' prior: 51086576!
testCanRemoveItemsToACreatedCart

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 1.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 0.! !

!testRun: #TusLibrosSystemFacadeTest #testCanRemoveItemsToACreatedCart stamp: 'GRC 11/29/2021 13:07:26'!
PASSED!

----SNAPSHOT----(29 November 2021 13:07:30) CuisUniversity-4972.image priorSource: 24055989!
!TusLibrosSystemFacadeTest methodsFor: 'tests - add to cart' stamp: 'GRC 11/29/2021 13:07:48' prior: 51068000!
test05CanNotAddItemToNotCreatedCart

	self
		should: [systemFacade add: 1 of: self validBook toCartIdentifiedAs: self invalidCartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidCartIdErrorDescription ]
		! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:08:20'!
testCanNotRemoveItemToNotCreatedCart

	self
		should: [systemFacade removeBook: self validBook fromCartIdentifiedAs: self invalidCartId ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidCartIdErrorDescription ]
		! !

!testRun: #TusLibrosSystemFacadeTest #testCanNotRemoveItemToNotCreatedCart stamp: 'GRC 11/29/2021 13:08:24'!
PASSED!
!TusLibrosSystemFacadeTest methodsFor: 'tests - add to cart' stamp: 'GRC 11/29/2021 13:08:31' prior: 51068014!
test06CanNotAddItemNotSellByTheStore

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self
		should: [systemFacade add: 1 of: self invalidBook toCartIdentifiedAs: cartId ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidItemErrorMessage.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
		! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:08:45'!
testCanNotRemoveItemNotSellByTheStore

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self
		should: [systemFacade add: 1 of: self invalidBook toCartIdentifiedAs: cartId ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidItemErrorMessage.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
		! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:09:03' prior: 51086664!
testCanNotRemoveItemNotSellByTheStore

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self
		should: [systemFacade removeBook: self invalidBook fromCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidItemErrorMessage.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
		! !

!testRun: #TusLibrosSystemFacadeTest #testCanNotRemoveItemNotSellByTheStore stamp: 'GRC 11/29/2021 13:09:06'!
PASSED!
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:09:32'!
testCanNotRemoveFromCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self advanceTime: (systemFacade sessionDuration + 1 minutes) .
	self
		should: [systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self revertTime: systemFacade sessionDuration.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:09:49' prior: 51086705!
testCanNotRemoveFromCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self advanceTime: (systemFacade sessionDuration + 1 minutes) .
	self
		should: [systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self revertTime: systemFacade sessionDuration.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
! !

!testRun: #TusLibrosSystemFacadeTest #testCanNotRemoveFromCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:09:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #testCanNotRemoveFromCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #testCanNotRemoveFromCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:09:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #testCanNotRemoveItemNotSellByTheStore stamp: 'GRC 11/29/2021 13:09:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #testCanNotRemoveItemToNotCreatedCart stamp: 'GRC 11/29/2021 13:09:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #testCanRemoveItemsToACreatedCart stamp: 'GRC 11/29/2021 13:09:55'!
PASSED!
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:10:19'!
test22CanRemoveItemsFromACreatedCart

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 1.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 0.! !

!methodRemoval: TusLibrosSystemFacadeTest #testCanRemoveItemsToACreatedCart stamp: 'GRC 11/29/2021 13:10:19'!
testCanRemoveItemsToACreatedCart

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 1.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 0.!
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:10:30'!
test23CanNotRemoveItemFromNotCreatedCart

	self
		should: [systemFacade removeBook: self validBook fromCartIdentifiedAs: self invalidCartId ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidCartIdErrorDescription ]
		! !

!methodRemoval: TusLibrosSystemFacadeTest #testCanNotRemoveItemToNotCreatedCart stamp: 'GRC 11/29/2021 13:10:30'!
testCanNotRemoveItemToNotCreatedCart

	self
		should: [systemFacade removeBook: self validBook fromCartIdentifiedAs: self invalidCartId ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidCartIdErrorDescription ]
		!
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:10:40'!
test24CanNotRemoveItemNotSellByTheStore

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self
		should: [systemFacade removeBook: self invalidBook fromCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidItemErrorMessage.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
		! !

!methodRemoval: TusLibrosSystemFacadeTest #testCanNotRemoveItemNotSellByTheStore stamp: 'GRC 11/29/2021 13:10:40'!
testCanNotRemoveItemNotSellByTheStore

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self
		should: [systemFacade removeBook: self invalidBook fromCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidItemErrorMessage.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
		!
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:10:48'!
test24CanNotRemoveFromCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self advanceTime: (systemFacade sessionDuration + 1 minutes) .
	self
		should: [systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self revertTime: systemFacade sessionDuration.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
! !

!methodRemoval: TusLibrosSystemFacadeTest #testCanNotRemoveFromCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:10:48'!
testCanNotRemoveFromCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self advanceTime: (systemFacade sessionDuration + 1 minutes) .
	self
		should: [systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self revertTime: systemFacade sessionDuration.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

server destroy.!
!CatalogueWindow methodsFor: 'building' stamp: 'GRC 11/29/2021 13:14:28' prior: 51083411 overrides: 51073871!
buildMorphicWindow
    | catalogueMorphList |
    
    catalogueMorph _ self buildColumn.
    catalogueMorphList _ self buildColumn.
    cartMorph _ self buildColumn.
    cartMorphList _ self buildColumn.
    
    self buildCatalogueOn: catalogueMorphList.
    catalogueMorph addMorph: catalogueMorphList.
    self buildButtonWithAction: #addBook andLabel: 'Add 1 book' in: catalogueMorph.
	self buildButtonWithAction: #removeBook andLabel: 'Remove book' in: catalogueMorph.
    
    self buildCartOn: cartMorphList.
    cartMorph addMorph: cartMorphList.
    self buildButtonWithAction: #checkout andLabel: 'Checkout' in: cartMorph.
    
    self layoutMorph
        beRow;
        separation: 10;
        axisEdgeWeight: 0.5;
        addMorph: catalogueMorph;
        addMorph: cartMorph.! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:18:29'!
test25CanRemoveItemMultipleTimes

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self
		should: [systemFacade removeBook: self invalidBook fromCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidItemErrorMessage.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
		! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:18:59' prior: 51087032!
test25CanRemoveItemMultipleTimes

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 3 of: self validBook toCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 3.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 2.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 1.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 0.
		! !

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 11/29/2021 13:19:02'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 11/29/2021 13:19:02'!
FAILURE!

----SNAPSHOT----(29 November 2021 13:19:22) CuisUniversity-4972.image priorSource: 24158748!

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 11/29/2021 13:19:53'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 11/29/2021 13:19:53'!
FAILURE!
!Cart methodsFor: 'removing' stamp: 'GRC 11/29/2021 13:21:27' prior: 51086537!
remove: aQuantity of: anItem

	

	self assertIsValidQuantity: aQuantity.
	self assertIsValidItem: anItem.

	"cantidad _ items occurrencesOf: anItem."

	items remove: anItem.

	"cantidad > 1 ifTrue: [items add: anItem withOccurrences: (cantidad - 1).]."

	
	

	! !

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 11/29/2021 13:21:31'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 11/29/2021 13:21:37'!
PASSED!
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:21:46' prior: 51087051!
test25CanRemoveItemMultipleTimes

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 3 of: self validBook toCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 3.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 2.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 1.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 0.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 0.
		! !

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 11/29/2021 13:21:48'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 11/29/2021 13:21:48'!
ERROR!
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:21:55' prior: 51087118!
test25CanRemoveItemMultipleTimes

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 3 of: self validBook toCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 3.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 2.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 1.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 0.
		! !
!Cart methodsFor: 'removing' stamp: 'GRC 11/29/2021 13:22:46' prior: 51087098!
remove: aQuantity of: anItem

	

	self assertIsValidQuantity: aQuantity.
	self assertIsValidItem: anItem.

	"cantidad _ items occurrencesOf: anItem."

	items remove: anItem ifAbsent: [].

	"cantidad > 1 ifTrue: [items add: anItem withOccurrences: (cantidad - 1).]."

	
	

	! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:22:56' prior: 51087161!
test25CanRemoveItemMultipleTimes

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 3 of: self validBook toCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 3.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 2.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 1.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 0.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 0.
		! !

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 11/29/2021 13:22:57'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/29/2021 13:22:57'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/29/2021 13:22:57'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/29/2021 13:22:57'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/29/2021 13:22:57'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/29/2021 13:22:57'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/29/2021 13:22:57'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/29/2021 13:22:57'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/29/2021 13:22:57'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/29/2021 13:22:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 13:22:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/29/2021 13:22:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 13:22:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/29/2021 13:22:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/29/2021 13:22:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/29/2021 13:22:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/29/2021 13:22:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 13:22:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/29/2021 13:22:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:22:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:22:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/29/2021 13:22:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:22:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test22CanRemoveItemsFromACreatedCart stamp: 'GRC 11/29/2021 13:22:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test23CanNotRemoveItemFromNotCreatedCart stamp: 'GRC 11/29/2021 13:22:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveFromCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:22:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveItemNotSellByTheStore stamp: 'GRC 11/29/2021 13:22:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 11/29/2021 13:22:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 11/29/2021 13:23:03'!
PASSED!

LoginWindow open.!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

server destroy.!
!Cart methodsFor: 'removing' stamp: 'GRC 11/29/2021 13:24:49' prior: 51087190!
remove: aQuantity of: anItem

	

	self assertIsValidQuantity: aQuantity.
	self assertIsValidItem: anItem.

	items remove: anItem ifAbsent: [].

	
	

	! !
!Cart methodsFor: 'removing' stamp: 'GRC 11/29/2021 13:26:22' prior: 51087350!
remove: aQuantity of: anItem

	

	self assertIsValidQuantity: aQuantity.
	self assertIsValidItem: anItem.

	aQuantity timesRepeat: [
		items remove: anItem ifAbsent: [].
	]

	
	

	! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:27:11'!
test26CanNotRemoveItemsMoreTimesThanItAppears

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 3 of: self validBook toCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 3.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 2.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 1.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 0.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 0.
		! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:27:34' prior: 51087367!
test26CanNotRemoveItemsMoreTimesThanItAppears

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 3 of: self validBook toCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 3.
	
	systemFacade removeBook: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 0.
		! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 11/29/2021 13:28:14' prior: 51083544!
removeFromCartAction: aRequest	

	[ | cartId bookIsbn bookQuantity |
		cartId := (aRequest fields at: 'cartId') asNumber.
		bookIsbn := aRequest fields at: 'bookIsbn'.
		bookQuantity := (aRequest fields at: 'bookQuantity') asNumber.
		
		tusLibros remove: bookQuantity of: bookIsbn fromCartIdentifiedAs: cartId.
	
		aRequest send200Response: 'OK'.
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/29/2021 13:28:46'!
remove: bookQuantity of: aBook fromCartIdentifiedAs: aCartId

	self withCartSessionIdentifiedAs: aCartId do: [ :cartSession | cartSession removeFromCart: bookQuantity of: aBook ]
	! !

!methodRemoval: TusLibrosSystemFacade #removeBook:fromCartIdentifiedAs: stamp: 'GRC 11/29/2021 13:28:53'!
removeBook: aBook fromCartIdentifiedAs: aCartId

	self withCartSessionIdentifiedAs: aCartId do: [ :cartSession | cartSession removeFromCart: 1 of: aBook ]
	!
!Cart methodsFor: 'removing' stamp: 'GRC 11/29/2021 13:29:15' prior: 51087358!
remove: aQuantity of: anItem

	

	self assertIsValidQuantity: aQuantity.
	self assertIsValidItem: anItem.

	aQuantity timesRepeat: [
		items remove: anItem ifAbsent: [].
	].

	
	

	! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:29:35' prior: 51086856!
test22CanRemoveItemsFromACreatedCart

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 1.
	
	systemFacade remove: 1 of: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 0.! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:29:50' prior: 51086894!
test23CanNotRemoveItemFromNotCreatedCart

	self
		should: [systemFacade remove: 1 of: self validBook fromCartIdentifiedAs: self invalidCartId ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidCartIdErrorDescription ]
		! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:30:00' prior: 51086956!
test24CanNotRemoveFromCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self advanceTime: (systemFacade sessionDuration + 1 minutes) .
	self
		should: [systemFacade remove: 1 of: self validBook fromCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self revertTime: systemFacade sessionDuration.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:30:08' prior: 51086920!
test24CanNotRemoveItemNotSellByTheStore

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self
		should: [systemFacade remove: 1 of: self invalidBook fromCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidItemErrorMessage.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
		! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:30:24' prior: 51087203!
test25CanRemoveItemMultipleTimes

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 3 of: self validBook toCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 3.
	
	systemFacade remove: 1 of: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 2.
	
	systemFacade remove: 1 of: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 1.
	
	systemFacade remove: 1 of: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 0.
	
	systemFacade remove: 1 of: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 0.
		! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'GRC 11/29/2021 13:30:31' prior: 51087403!
test26CanNotRemoveItemsMoreTimesThanItAppears

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 3 of: self validBook toCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 3.
	
	systemFacade remove: 4 of: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 0.
		! !

!testRun: #TusLibrosSystemFacadeTest #test26CanNotRemoveItemsMoreTimesThanItAppears stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test22CanRemoveItemsFromACreatedCart stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test23CanNotRemoveItemFromNotCreatedCart stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveFromCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveItemNotSellByTheStore stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test26CanNotRemoveItemsMoreTimesThanItAppears stamp: 'GRC 11/29/2021 13:30:33'!
PASSED!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/29/2021 13:31:05' prior: 51087439!
remove: aQuantity of: aBook fromCartIdentifiedAs: aCartId

	self withCartSessionIdentifiedAs: aCartId do: [ :cartSession | cartSession removeFromCart: aQuantity of: aBook ]
	! !

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

server destroy.!

----SNAPSHOT----(29 November 2021 13:31:59) CuisUniversity-4972.image priorSource: 24173967!
!CatalogueWindow methodsFor: 'operations' stamp: 'GRC 11/29/2021 13:34:46' prior: 51082668!
openTicket: aTicket

	self clearCart.

	TicketWindow openFor: aTicket.
	
	"self closeButtonClicked."! !

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

server destroy.!
!CartSession methodsFor: 'session management' stamp: 'GRC 11/29/2021 13:37:06' prior: 51066991!
do: aBlock

	| now |

	now := self now.
	self assertIsNotExpirtedAt: now.

	^ [ aBlock value: self ] ensure: [ lastUsedTime := now  ]! !
!CartSession methodsFor: 'cart' stamp: 'GRC 11/29/2021 13:38:59' prior: 51080946!
checkOutCartWithCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	| result |	

	result _ (Cashier
		toCheckout: cart
		ownedBy: owner
		charging: (CreditCard expiringOn: anExpirationMonthOfYear)
		throught: systemFacade merchantProcessor
		on: self today
		registeringOn: systemFacade salesBook) checkOut.
		
	self 
		
	^result! !
!CartSession methodsFor: 'cart' stamp: 'GRC 11/29/2021 13:39:25' prior: 51087739!
checkOutCartWithCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	| result |	

	result _ (Cashier
		toCheckout: cart
		ownedBy: owner
		charging: (CreditCard expiringOn: anExpirationMonthOfYear)
		throught: systemFacade merchantProcessor
		on: self today
		registeringOn: systemFacade salesBook) checkOut.
		
	self createNewCart.
		
	^result! !
!CartSession methodsFor: 'initialization' stamp: 'GRC 11/29/2021 13:39:34'!
createNewCart! !
!CartSession methodsFor: 'initialization' stamp: 'GRC 11/29/2021 13:39:56' prior: 51087769!
createNewCart

	cart _ Cart new.
	lastUsedTime := self now.! !
!Cart class methodsFor: 'instance creation' stamp: 'GRC 11/29/2021 13:40:05' prior: 51066945!
acceptingItemsOf: aCatalog

	^self new initializeAcceptingItemsOf: aCatalog ! !
!CartSession methodsFor: 'initialization' stamp: 'GRC 11/29/2021 13:40:42' prior: 51087773!
createNewCart

	cart _ Cart acceptingItemsOf: systemFacade defaultCatalog.
	lastUsedTime := self now.! !
!CartSession methodsFor: 'session management' stamp: 'GRC 11/29/2021 13:41:45' prior: 51087784!
createNewCart

	cart _ Cart acceptingItemsOf: systemFacade catalog.
	lastUsedTime := self now.! !

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/29/2021 13:42:41'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/29/2021 13:42:41'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/29/2021 13:42:41'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/29/2021 13:42:41'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/29/2021 13:42:41'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/29/2021 13:42:41'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/29/2021 13:42:41'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/29/2021 13:42:41'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/29/2021 13:42:41'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/29/2021 13:42:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 13:42:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/29/2021 13:42:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 13:42:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/29/2021 13:42:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/29/2021 13:42:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/29/2021 13:42:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/29/2021 13:42:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 13:42:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/29/2021 13:42:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:42:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:42:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/29/2021 13:42:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:42:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test22CanRemoveItemsFromACreatedCart stamp: 'GRC 11/29/2021 13:42:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test23CanNotRemoveItemFromNotCreatedCart stamp: 'GRC 11/29/2021 13:42:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveFromCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:42:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveItemNotSellByTheStore stamp: 'GRC 11/29/2021 13:42:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 11/29/2021 13:42:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test26CanNotRemoveItemsMoreTimesThanItAppears stamp: 'GRC 11/29/2021 13:42:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/29/2021 13:42:44'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'GRC 11/29/2021 13:42:44'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'GRC 11/29/2021 13:42:44'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'GRC 11/29/2021 13:42:44'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'GRC 11/29/2021 13:42:44'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'GRC 11/29/2021 13:42:44'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'GRC 11/29/2021 13:42:44'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'GRC 11/29/2021 13:42:44'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'GRC 11/29/2021 13:42:44'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 13:42:44'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'GRC 11/29/2021 13:42:44'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'GRC 11/29/2021 13:42:44'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'GRC 11/29/2021 13:42:44'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'GRC 11/29/2021 13:42:44'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'GRC 11/29/2021 13:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/29/2021 13:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/29/2021 13:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/29/2021 13:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/29/2021 13:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/29/2021 13:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test22CanRemoveItemsFromACreatedCart stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test23CanNotRemoveItemFromNotCreatedCart stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveFromCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveItemNotSellByTheStore stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test26CanNotRemoveItemsMoreTimesThanItAppears stamp: 'GRC 11/29/2021 13:42:45'!
PASSED!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

server destroy.!
!CatalogueModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 13:44:05' prior: 51080158!
checkout

	| request response |
	
	request _ Dictionary new.
	
	request at: 'cartId' put: cartId asString.
	request at: 'cco' put: 'Juan Perez'.
	request at: 'cced' put: '11/2022'.
	request at: 'ccn' put: '1111222233334444'.
	
	response _ restInterface sendCheckoutRequest: request.

	response = 'Error' ifTrue: [^self error: 'Error'].
	
	self triggerEvent: #openTicket with: response.
	self triggerEvent: #clearCart.

	! !
!CatalogueWindow methodsFor: 'initialization' stamp: 'GRC 11/29/2021 13:44:27' prior: 51083440!
initializeWith: aTitle for: cartId

    self titleMorph showButtonsNamed: #(#close #collapse ).
    self setLabel: aTitle.
    self model: (CatalogueModel new initializeWith: cartId).
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.

    self model
        when: #updateCart
        send: #reloadCart
        to: self.

    self model
        when: #openTicket
        send: #openTicket:
        to: self.

	self model
        when: #clearCart
        send: #clearCart
        to: self.! !
!CatalogueModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 13:45:21' prior: 51088065!
checkout

	| request response |
	
	request _ Dictionary new.
	
	request at: 'cartId' put: cartId asString.
	request at: 'cco' put: 'Juan Perez'.
	request at: 'cced' put: '11/2022'.
	request at: 'ccn' put: '1111222233334444'.
	
	response _ restInterface sendCheckoutRequest: request.

	response = 'Error' ifTrue: [^self error: 'Error'].
	
	self triggerEvent: #openTicket with: response.
	self triggerEvent: #reloadCart.

	! !
!CatalogueModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 13:45:29' prior: 51088102!
checkout

	| request response |
	
	request _ Dictionary new.
	
	request at: 'cartId' put: cartId asString.
	request at: 'cco' put: 'Juan Perez'.
	request at: 'cced' put: '11/2022'.
	request at: 'ccn' put: '1111222233334444'.
	
	response _ restInterface sendCheckoutRequest: request.

	response = 'Error' ifTrue: [^self error: 'Error'].
	
	self triggerEvent: #openTicket with: response.
	self triggerEvent: #updateCart.

	! !

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!CatalogueWindow methodsFor: 'operations' stamp: 'GRC 11/29/2021 13:46:16' prior: 51087722!
openTicket: aTicket

	TicketWindow openFor: aTicket.
	
	"self closeButtonClicked."! !
!CatalogueModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 13:46:46' prior: 51088119!
checkout

	| request response |
	
	request _ Dictionary new.
	
	request at: 'cartId' put: cartId asString.
	request at: 'cco' put: 'Juan Perez'.
	request at: 'cced' put: '11/2022'.
	request at: 'ccn' put: '1111222233334444'.
	
	response _ restInterface sendCheckoutRequest: request.

	response = 'Error' ifTrue: [^self error: 'Error'].
	
	self triggerEvent: #updateCart.
	self triggerEvent: #openTicket with: response.
	

	! !

LoginWindow open.!
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'GRC 11/29/2021 13:49:19' prior: 51081448!
test21CanNotCheckOutCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	self advanceTime: (systemFacade sessionDuration + 1 minutes) .
	self should: [
		systemFacade
			checkOutCartIdentifiedAs: cartId
			withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
			ownedBy: testObjectsFactory notExpiredCreditCardOwner
			expiringOn: testObjectsFactory notExpiredMonthOfYear ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self assert: (systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword) isEmpty ]


	! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'GRC 11/29/2021 13:49:46'!
test30CheckedOutCartIsEmpty

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
		ownedBy: testObjectsFactory notExpiredCreditCardOwner
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: 'total amount') equals: testObjectsFactory itemSellByTheStorePrice.
! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'GRC 11/29/2021 13:50:44' prior: 51088191!
test30CheckedOutCartIsEmpty

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
		ownedBy: testObjectsFactory notExpiredCreditCardOwner
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: 'total amount') equals: testObjectsFactory itemSellByTheStorePrice.
	self assert: Bag new equals: (systemFacade listCartIdentifiedAs: cartId).
! !

!testRun: #TusLibrosSystemFacadeTest #test30CheckedOutCartIsEmpty stamp: 'GRC 11/29/2021 13:50:46'!
PASSED!
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'GRC 11/29/2021 13:51:12' prior: 51088215!
test30CheckedOutCartIsEmpty

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
		ownedBy: testObjectsFactory notExpiredCreditCardOwner
		expiringOn: testObjectsFactory notExpiredMonthOfYear.
		
	self assert: Bag new equals: (systemFacade listCartIdentifiedAs: cartId).
! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'GRC 11/29/2021 13:51:26'!
test27CheckedOutCartIsEmpty

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
		ownedBy: testObjectsFactory notExpiredCreditCardOwner
		expiringOn: testObjectsFactory notExpiredMonthOfYear.
		
	self assert: Bag new equals: (systemFacade listCartIdentifiedAs: cartId).
! !

!methodRemoval: TusLibrosSystemFacadeTest #test30CheckedOutCartIsEmpty stamp: 'GRC 11/29/2021 13:51:26'!
test30CheckedOutCartIsEmpty

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
		ownedBy: testObjectsFactory notExpiredCreditCardOwner
		expiringOn: testObjectsFactory notExpiredMonthOfYear.
		
	self assert: Bag new equals: (systemFacade listCartIdentifiedAs: cartId).
!

server destroy.!

server destroy.!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

----SNAPSHOT----(29 November 2021 13:52:11) CuisUniversity-4972.image priorSource: 24194156!

----SNAPSHOT----(29 November 2021 13:52:32) CuisUniversity-4972.image priorSource: 24213000!

----SNAPSHOT----(29 November 2021 14:26:24) CuisUniversity-4972.image priorSource: 24213094!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!
!CatalogueWindow methodsFor: 'operations' stamp: 'GRC 11/29/2021 14:31:50' prior: 51088138!
openTicket: aTicket

	TicketWindow openFor: aTicket.! !
!TicketWindow class methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 14:32:26' prior: 51079356!
openFor: aTicket

	^self new initializeWith: 'TusLibros-Service Ticket Window' for: aTicket.! !
!TicketWindow methodsFor: 'no messages' stamp: 'GRC 11/29/2021 14:32:38'!
initializeWith: aTitle for: cartId

    self titleMorph showButtonsNamed: #(#close #collapse ).
    self setLabel: aTitle.
    self model: (CatalogueModel new initializeWith: cartId).
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.

    self model
        when: #updateCart
        send: #reloadCart
        to: self.

    self model
        when: #openTicket
        send: #openTicket:
        to: self.

	self model
        when: #clearCart
        send: #clearCart
        to: self.! !
!TicketWindow methodsFor: 'initialization' stamp: 'GRC 11/29/2021 14:33:23' prior: 51088334!
initializeWith: aTitle for: aTicket

    self titleMorph showButtonsNamed: #(#close #collapse ).
    self setLabel: aTitle.
    self model: (TicketModel new initializeWith: aTicket).
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.! !
!TicketWindow methodsFor: 'nil' stamp: 'GRC 11/29/2021 14:34:59' overrides: 51073871!
buildMorphicWindow

    | catalogueMorphList ticketMorph|

    catalogueMorphList _ self buildColumn.
    
    self buildCatalogueOn: catalogueMorphList.

    self layoutMorph
        beRow;
        separation: 10;
        axisEdgeWeight: 0.5;
        addMorph: ticketMorph.! !
!TicketWindow methodsFor: 'nil' stamp: 'GRC 11/29/2021 14:35:46'!
buildColumn

    | morph |
    morph _ LayoutMorph newColumn.
    morph separation: 25.
    morph axisEdgeWeight: 0.
    
    ^morph! !

----SNAPSHOT----(29 November 2021 14:36:11) CuisUniversity-4972.image priorSource: 24213188!
!TicketWindow methodsFor: 'building' stamp: 'GRC 11/29/2021 14:37:09' prior: 51088366 overrides: 51073871!
buildMorphicWindow

    | catalogueMorphList ticketMorph|

    catalogueMorphList _ self buildColumn.
    
    self buildTicketOn: catalogueMorphList.

    self layoutMorph
        beRow;
        separation: 10;
        axisEdgeWeight: 0.5;
        addMorph: ticketMorph.! !
!TicketWindow methodsFor: 'building' stamp: 'GRC 11/29/2021 14:38:01' prior: 51088388 overrides: 51073871!
buildMorphicWindow

    | catalogueMorphList ticketMorph |

    catalogueMorphList _ self buildColumn.
    
    self buildTicketOn: catalogueMorphList.

    self layoutMorph
        beRow;
        separation: 10;
        axisEdgeWeight: 0.5;
        addMorph: ticketMorph.! !
!TicketWindow methodsFor: 'building' stamp: 'GRC 11/29/2021 14:38:14' prior: 51088400 overrides: 51073871!
buildMorphicWindow

    | ticketMorphList ticketMorph |

    ticketMorphList _ self buildColumn.
    
    self buildTicketOn: ticketMorphList.

    self layoutMorph
        beRow;
        separation: 10;
        axisEdgeWeight: 0.5;
        addMorph: ticketMorph.! !
!TicketWindow methodsFor: 'building' stamp: 'GRC 11/29/2021 14:38:32'!
buildTicketOn: ticketMorphList! !
!TicketWindow methodsFor: 'building' stamp: 'GRC 11/29/2021 14:40:40' prior: 51088423!
buildTicketOn: ticketMorphList

	| wordsListMorph |
    
	wordsListMorph _ PluggableListMorph
		model: self model
		listGetter: #catalogue
		indexGetter: #catalogueListIndex
		indexSetter: #catalogueListIndex:.
    
	wordsListMorph borderColor: Color skyBlue;
		borderWidth: 1;
		morphWidth: 300.! !

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!
!TicketWindow methodsFor: 'building' stamp: 'GRC 11/29/2021 14:43:19' prior: 51088427!
buildTicketOn: aMorph
    
    | wordsListMorph |
    
    wordsListMorph _ PluggableListMorph
        model: self model
        listGetter: #catalogue
        indexGetter: #catalogueListIndex
        indexSetter: #catalogueListIndex:.
    wordsListMorph borderColor: Color skyBlue;
        borderWidth: 1;
        morphWidth: 300.

    aMorph addMorph: wordsListMorph.! !
!TicketWindow methodsFor: 'building' stamp: 'GRC 11/29/2021 14:43:42' prior: 51088444!
buildTicketOn: aMorph
    
    | wordsListMorph |
    
    wordsListMorph _ PluggableListMorph
        model: self model
        listGetter: #ticket
        indexGetter: #ticketListIndex
        indexSetter: #ticketListIndex:.
    wordsListMorph borderColor: Color skyBlue;
        borderWidth: 1;
        morphWidth: 300.

    aMorph addMorph: wordsListMorph.! !

TusLibrosWindows subclass: #TicketWindow
	instanceVariableNames: 'ticketMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TicketWindow methodsFor: 'building' stamp: 'GRC 11/29/2021 14:46:23' prior: 51088412 overrides: 51073871!
buildMorphicWindow

    | ticketMorphList ticketMorph |

    ticketMorphList _ self buildColumn.
    
    self buildTicketOn: ticketMorphList.
	ticketMorph addMorph: ticketMorphList.

    self layoutMorph
        beRow;
        separation: 10;
        axisEdgeWeight: 0.5;
        addMorph: ticketMorph.! !
!TicketWindow methodsFor: 'building' stamp: 'GRC 11/29/2021 14:46:40' prior: 51088479 overrides: 51073871!
buildMorphicWindow

    | ticketMorphList ticketMorph2 |

    ticketMorphList _ self buildColumn.
    
    self buildTicketOn: ticketMorphList.
	ticketMorph2 addMorph: ticketMorphList.

    self layoutMorph
        beRow;
        separation: 10;
        axisEdgeWeight: 0.5;
        addMorph: ticketMorph2.! !

!classDefinition: #TicketWindow category: 'TusLibros-View' stamp: 'GRC 11/29/2021 14:46:54'!
TusLibrosWindows subclass: #TicketWindow
	instanceVariableNames: 'ticketMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TicketWindow methodsFor: 'building' stamp: 'GRC 11/29/2021 14:46:52' prior: 51088492 overrides: 51073871!
buildMorphicWindow

    | ticketMorphList |

    ticketMorphList _ self buildColumn.
    
    self buildTicketOn: ticketMorphList.
	ticketMorph addMorph: ticketMorphList.

    self layoutMorph
        beRow;
        separation: 10;
        axisEdgeWeight: 0.5;
        addMorph: ticketMorph.! !

!classDefinition: #TicketModel category: 'TusLibros-View' stamp: 'GRC 11/29/2021 14:50:14'!
TusLibrosWindowModels subclass: #TicketModel
	instanceVariableNames: 'restInterface ticket'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #TicketModel category: 'TusLibros-View' stamp: 'GRC 11/29/2021 14:50:16'!
TusLibrosWindowModels subclass: #TicketModel
	instanceVariableNames: 'restInterface ticket ticketIndex'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TicketModel methodsFor: 'initialization' stamp: 'GRC 11/29/2021 14:50:13'!
initializeWith: aTicket

	ticket _ aTicket.
	ticketIndex _ 1.
	restInterface _ TusLibrosInterface new.! !

!methodRemoval: TicketModel #initialize stamp: 'GRC 11/29/2021 14:50:20'!
initialize

	restInterface _ TusLibrosInterface new.!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!TicketWindow methodsFor: 'building' stamp: 'GRC 11/29/2021 14:54:50' prior: 51088513 overrides: 51073871!
buildMorphicWindow

    | ticketMorphList |

    ticketMorphList _ self buildColumn.
	ticketMorph _ self buildColumn.
    
    self buildTicketOn: ticketMorphList.
	ticketMorph addMorph: ticketMorphList.

    self layoutMorph
        beRow;
        separation: 10;
        axisEdgeWeight: 0.5;
        addMorph: ticketMorph.! !
!TicketModel methodsFor: 'nil' stamp: 'GRC 11/29/2021 14:56:13'!
ticketListIndex

	^ticketIndex.! !
!TicketModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 14:56:27'!
ticketListIndex: anIndex

	ticketIndex _ anIndex.! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

server destroy.!
!TicketModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 14:58:16'!
ticket

    |catalogueAsOrderedCollection|

    catalogueAsOrderedCollection _ OrderedCollection new.
    ticket keysAndValuesDo: [:anIsbn :aPrice | 
        catalogueAsOrderedCollection add: (anIsbn , ': $' , aPrice asString) ].

    ^catalogueAsOrderedCollection.! !
!TicketModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 14:58:29' prior: 51088582!
ticket

    |ticketAsOrderedCollection|

    ticketAsOrderedCollection _ OrderedCollection new.
    ticket keysAndValuesDo: [:anIsbn :aPrice | 
        ticketAsOrderedCollection add: (anIsbn , ': $' , aPrice asString) ].

    ^ticketAsOrderedCollection.! !
!TicketModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 14:59:05' prior: 51088594!
ticket

    | ticketAsOrderedCollection |

    ticketAsOrderedCollection _ OrderedCollection new.
    ticket keysAndValuesDo: [:anIsbn :aPrice | 
        ticketAsOrderedCollection add: (anIsbn , ': $' , aPrice asString) ].

    ^ticketAsOrderedCollection.! !
!TicketModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 14:59:44' prior: 51088606!
ticket

    | ticketAsOrderedCollection |

    ticketAsOrderedCollection _ OrderedCollection new.
    ticket keysAndValuesDo: [:anIsbn :aQuantity | 
        ticketAsOrderedCollection add: (anIsbn , ': #' , aQuantity asString) ].

    ^ticketAsOrderedCollection.! !

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!CatalogueModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 15:01:16' prior: 51088144!
checkout

	| request response |
	
	request _ Dictionary new.
	
	request at: 'cartId' put: cartId asString.
	request at: 'cco' put: 'Juan Perez'.
	request at: 'cced' put: '11/2022'.
	request at: 'ccn' put: '1111222233334444'.
	
	response _ restInterface sendCheckoutRequest: request.

	"response = 'Error' ifTrue: [^self error: 'Error']."
	
	self triggerEvent: #updateCart.
	self triggerEvent: #openTicket with: response.
	

	! !
!TusLibrosInterface methodsFor: 'requests' stamp: 'GRC 11/29/2021 15:04:33' prior: 51080147!
sendCheckoutRequest: request

    | response |

    response _ WebClient
        htmlSubmit: self url , '/checkoutCart'
        fields: request.

    "res isSuccess ifTrue: [ ^ res content ].
    ^ 'Error'."
	
	response isSuccess ifTrue: [ ^ WebUtils jsonDecode: response content readStream ].! !

LoginWindow open.!
!TusLibrosInterface methodsFor: 'requests' stamp: 'GRC 11/29/2021 15:07:18' prior: 51088649!
sendCheckoutRequest: request

    | response |

    response _ WebClient
        htmlSubmit: self url , '/checkoutCart'
        fields: request.

    "res isSuccess ifTrue: [ ^ res content ].
    ^ 'Error'."
	
	response isSuccess ifTrue: [ ^ WebUtils jsonDecode: response content readStream ].
	^ Dictionary new.! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

LoginWindow open.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!
!TicketWindow methodsFor: 'initialization' stamp: 'GRC 11/29/2021 15:11:16' overrides: 51073967!
defaultExtent

	^ 1035@485! !

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!TicketWindow methodsFor: 'initialization' stamp: 'GRC 11/29/2021 15:12:48' prior: 51088687 overrides: 51073967!
defaultExtent

	^ 720@480! !
!CatalogueModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 15:14:22' prior: 51088632!
checkout

	| request response |
	
	request _ Dictionary new.
	
	request at: 'cartId' put: cartId asString.
	request at: 'cco' put: 'Juan Perez'.
	request at: 'cced' put: '11/2022'.
	request at: 'ccn' put: '1111222233334444'.
	
	response _ restInterface sendCheckoutRequest: request.
	
	self triggerEvent: #updateCart.
	self triggerEvent: #openTicket with: response.
	

	! !

!classDefinition: #ErrorWindow category: 'TusLibros-View' stamp: 'GRC 11/29/2021 15:16:54'!
TusLibrosWindows subclass: #ErrorWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!CatalogueModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 15:16:26' prior: 51088698!
checkout

	| request response |
	
	request _ Dictionary new.
	
	request at: 'cartId' put: cartId asString.
	request at: 'cco' put: 'Juan Perez'.
	request at: 'cced' put: '11/2022'.
	request at: 'ccn' put: '1111222233334444'.
	
	response _ restInterface sendCheckoutRequest: request.
	
	response keys size = 0 ifTrue: [ErrorWindow showWithError: 'Could not perform checkout.'].
	
	self triggerEvent: #updateCart.
	self triggerEvent: #openTicket with: response.
	

	! !
!CatalogueModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 15:17:07' prior: 51088720!
checkout

	| request response |
	
	request _ Dictionary new.
	
	request at: 'cartId' put: cartId asString.
	request at: 'cco' put: 'Juan Perez'.
	request at: 'cced' put: '11/2022'.
	request at: 'ccn' put: '1111222233334444'.
	
	response _ restInterface sendCheckoutRequest: request.
	
	response keys size = 0 ifTrue: [^ErrorWindow showWithError: 'Could not perform checkout.'].
	
	self triggerEvent: #updateCart.
	self triggerEvent: #openTicket with: response.
	

	! !
!TusLibrosInterface methodsFor: 'requests' stamp: 'GRC 11/29/2021 15:17:45' prior: 51088662!
sendCheckoutRequest: request

    | response |

    response _ WebClient
        htmlSubmit: self url , '/checkoutCart'
        fields: request.
	
	response isSuccess ifTrue: [ ^ WebUtils jsonDecode: response content readStream ].
	^ Dictionary new.! !
!CatalogueModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 15:19:43' prior: 51088738!
checkout

	| request response |
	
	request _ Dictionary new.
	
	request at: 'cartId' put: cartId asString.
	request at: 'cco' put: 'Juan Perez'.
	request at: 'cced' put: '11/2022'.
	request at: 'ccn' put: '1111222233334444'.
	
	self listCart ifEmpty: [^ErrorWindow showWithError: 'Could not perform checkout.'].
	
	response _ restInterface sendCheckoutRequest: request.
	
	response keys size = 0 ifTrue: [^ErrorWindow showWithError: 'Could not perform checkout.'].
	
	self triggerEvent: #updateCart.
	self triggerEvent: #openTicket with: response.
	

	! !
!CatalogueModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 15:20:06' prior: 51088767!
checkout

	| request response |
	
	request _ Dictionary new.
	
	request at: 'cartId' put: cartId asString.
	request at: 'cco' put: 'Juan Perez'.
	request at: 'cced' put: '11/2022'.
	request at: 'ccn' put: '1111222233334444'.
	
	self listCart ifEmpty: [^ErrorWindow showWithError: 'Could not perform checkout; empty cart.'].
	
	response _ restInterface sendCheckoutRequest: request.
	
	response keys size = 0 ifTrue: [^ErrorWindow showWithError: 'Could not perform checkout.'].
	
	self triggerEvent: #updateCart.
	self triggerEvent: #openTicket with: response.
	

	! !
!ErrorWindow class methodsFor: 'no messages' stamp: 'GRC 11/29/2021 15:20:42'!
showWithError: anErrorMessage

	! !
!ErrorWindow class methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 15:21:05' prior: 51088809!
showWithError: anErrorMessage

	self new showWithError: 'Invalid Login'.
	! !
!ErrorWindow class methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 15:21:22' prior: 51088814!
showWithError: anErrorMessage

	self new showWithError: anErrorMessage.
	! !
!ErrorWindow methodsFor: 'no messages' stamp: 'GRC 11/29/2021 15:21:54'!
showWithError: anErrorMessage

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Error Window'.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.! !

TusLibrosWindows subclass: #ErrorWindow
	instanceVariableNames: 'error'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #ErrorWindow category: 'TusLibros-View' stamp: 'GRC 11/29/2021 15:22:18'!
TusLibrosWindows subclass: #ErrorWindow
	instanceVariableNames: 'error'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 15:22:29' prior: 51088825!
showWithError: anErrorMessage

	error _ anErrorMessage.

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Error Window'.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 15:22:44' overrides: 51073871!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow.! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 15:23:03'!
build1stRow

	| firstRowLayoutMorph |
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents: error).
	
	^firstRowLayoutMorph.! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 15:23:13' overrides: 51073967!
defaultExtent

	^ 480@360! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!LoginModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 15:26:12' prior: 51082844!
sendCredentialsFromLoginRequest

	cartId _ restInterface sendLoginRequest: {'clientId'. clientId. 'password'. password}.
	
	(cartId < 1) 
		ifTrue: [^ErrorWindow showWithError: 'Invalid credentials, please try again.'] 
		ifFalse: [self triggerEvent: #validLogin with: cartId].! !

LoginWindow open.!

!methodRemoval: LoginWindow #showInvalidLoginMessage stamp: 'GRC 11/29/2021 15:26:34'!
showInvalidLoginMessage

	InvalidLoginWindow open.
	
	"self layoutMorph addMorph: self buildInvalidLoginMessage."!

!classRemoval: #InvalidLoginWindow stamp: 'GRC 11/29/2021 15:26:42'!
TusLibrosWindows subclass: #InvalidLoginWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!LoginWindow methodsFor: 'initialization' stamp: 'GRC 11/29/2021 15:26:58' prior: 51082855!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model 
		when: #validLogin 
		send: #openCatalogue: to: self.! !

LoginWindow open.!
!TicketWindow methodsFor: 'building' stamp: 'GRC 11/29/2021 15:30:06' prior: 51088555 overrides: 51073871!
buildMorphicWindow

    | ticketMorphList |

    ticketMorphList _ self buildColumn.
	ticketMorph _ self buildColumn.
    
    self buildTicketOn: ticketMorphList.
	ticketMorph addMorph: ticketMorphList.
	self buildButtonWithAction: #logout andLabel: 'logout' in: ticketMorph.

    self layoutMorph
        beRow;
        separation: 10;
        axisEdgeWeight: 0.5;
        addMorph: ticketMorph.! !
!TicketWindow methodsFor: 'building' stamp: 'GRC 11/29/2021 15:30:24'!
buildButtonWithAction: anAction andLabel: aLabel in: aMorph

    | buttonMorph |

    buttonMorph _ PluggableButtonMorph
        model: self model
        stateGetter: nil
        action: anAction
        label: aLabel.
        
    aMorph addMorph: buttonMorph.! !
!TicketModel methodsFor: 'nil' stamp: 'GRC 11/29/2021 15:30:41'!
logout! !
!TicketModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 15:31:23' prior: 51088954!
logout

	self triggerEvent: #logout! !
!TicketWindow methodsFor: 'initialization' stamp: 'GRC 11/29/2021 15:32:15' prior: 51088354!
initializeWith: aTitle for: aTicket

    self titleMorph showButtonsNamed: #(#close #collapse ).
    self setLabel: aTitle.
    self model: (TicketModel new initializeWith: aTicket).
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.

	self model 
		when: #logout 
		send: #logout to: self.! !
!TicketWindow methodsFor: 'nil' stamp: 'GRC 11/29/2021 15:33:03'!
logout

	self closeButtonClicked.
	
	LoginWindow open.! !
!TicketWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 15:33:19' prior: 51088976!
logout

	LoginWindow open.
	self closeButtonClicked.! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

CatalogueWindow allInstancesDo: [:aWindow | aWindow closeButtonClicked ].!
!CatalogueModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 15:37:05' prior: 51088788!
checkout

	| request response |
	
	request _ Dictionary new.
	
	request at: 'cartId' put: cartId asString.
	request at: 'cco' put: 'Juan Perez'.
	request at: 'cced' put: '11/2022'.
	request at: 'ccn' put: '1111222233334444'.
	
	self listCart ifEmpty: [^ErrorWindow showWithError: 'Could not perform checkout; empty cart.'].
	
	response _ restInterface sendCheckoutRequest: request.
	
	response keys size = 0 ifTrue: [^ErrorWindow showWithError: 'Could not perform checkout.'].
	
	self triggerEvent: #updateCart.
	self triggerEvent: #openTicket with: response.
	

	! !
!CatalogueWindow methodsFor: 'operations' stamp: 'GRC 11/29/2021 15:37:26' prior: 51088323!
openTicket: aTicket

	TicketWindow openFor: aTicket.! !
!CatalogueWindow methodsFor: 'operations' stamp: 'GRC 11/29/2021 15:37:58' prior: 51089014!
openTicket: aTicket

	TicketWindow openFor: aTicket withCatalogue: self.! !
!TicketWindow class methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 15:38:22'!
openFor: aTicket withCatalogue: aCatalogueWindow

	^self new initializeWith: 'TusLibros-Service Ticket Window' for: aTicket withCatalogue: aCatalogueWindow.! !

!classDefinition: #TicketWindow category: 'TusLibros-View' stamp: 'GRC 11/29/2021 15:38:53'!
TusLibrosWindows subclass: #TicketWindow
	instanceVariableNames: 'ticketMorph window'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!TicketWindow methodsFor: 'initialization' stamp: 'GRC 11/29/2021 15:38:52'!
initializeWith: aTitle for: aTicket withCatalogueWindow: aCatalogueWindow

	window _ aCatalogueWindow.

    self titleMorph showButtonsNamed: #(#close #collapse ).
    self setLabel: aTitle.
    self model: (TicketModel new initializeWith: aTicket).
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.

	self model 
		when: #logout 
		send: #logout to: self.! !
!TicketWindow methodsFor: 'operations' stamp: 'GRC 11/29/2021 15:39:05' prior: 51088981!
logout

	LoginWindow open.
	window closeButtonClicked.
	self closeButtonClicked.! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

LoginWindow open.!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!TicketWindow methodsFor: 'initialization' stamp: 'GRC 11/29/2021 15:39:43'!
initializeWith: aTitle for: aTicket withCatalogue: aCatalogueWindow

	window _ aCatalogueWindow.

    self titleMorph showButtonsNamed: #(#close #collapse ).
    self setLabel: aTitle.
    self model: (TicketModel new initializeWith: aTicket).
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.

	self model 
		when: #logout 
		send: #logout to: self.! !

!methodRemoval: TicketWindow #initializeWith:for:withCatalogueWindow: stamp: 'GRC 11/29/2021 15:39:45'!
initializeWith: aTitle for: aTicket withCatalogueWindow: aCatalogueWindow

	window _ aCatalogueWindow.

    self titleMorph showButtonsNamed: #(#close #collapse ).
    self setLabel: aTitle.
    self model: (TicketModel new initializeWith: aTicket).
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.

	self model 
		when: #logout 
		send: #logout to: self.!

!methodRemoval: TicketWindow #initializeWith:for: stamp: 'GRC 11/29/2021 15:40:00'!
initializeWith: aTitle for: aTicket

    self titleMorph showButtonsNamed: #(#close #collapse ).
    self setLabel: aTitle.
    self model: (TicketModel new initializeWith: aTicket).
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.

	self model 
		when: #logout 
		send: #logout to: self.!

!methodRemoval: TicketWindow class #openFor: stamp: 'GRC 11/29/2021 15:40:03'!
openFor: aTicket

	^self new initializeWith: 'TusLibros-Service Ticket Window' for: aTicket.!

----SNAPSHOT----(29 November 2021 15:40:42) CuisUniversity-4972.image priorSource: 24215463!
!CatalogueWindow methodsFor: 'building' stamp: 'GRC 11/29/2021 15:42:46' prior: 51087004 overrides: 51073871!
buildMorphicWindow
    | catalogueMorphList |
    
    catalogueMorph _ self buildColumn.
    catalogueMorphList _ self buildColumn.
    cartMorph _ self buildColumn.
    cartMorphList _ self buildColumn.
    
    self buildCatalogueOn: catalogueMorphList.
    catalogueMorph addMorph: catalogueMorphList.
    self buildButtonWithAction: #addBook andLabel: 'Add 1 book' in: catalogueMorph.
	self buildButtonWithAction: #removeBook andLabel: 'Remove book' in: catalogueMorph.
	self buildButtonWithAction: #purchases andLabel: 'purchase history' in: catalogueMorph.
    
    self buildCartOn: cartMorphList.
    cartMorph addMorph: cartMorphList.
    self buildButtonWithAction: #checkout andLabel: 'Checkout' in: cartMorph.
    
    self layoutMorph
        beRow;
        separation: 10;
        axisEdgeWeight: 0.5;
        addMorph: catalogueMorph;
        addMorph: cartMorph.! !
!CatalogueModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 15:43:28'!
purchases

    |res cart |

    res _ OrderedCollection new.

    cart _ restInterface sendListPurchasesRequest: {'cartId'. cartId}.
    cart keysAndValuesDo: [:anIsbn :aQuantity | 
        res add: (anIsbn , ': ' , aQuantity asString)].

    ^res! !

!classDefinition: #CatalogueModel category: 'TusLibros-View' stamp: 'GRC 11/29/2021 15:45:44'!
TusLibrosWindowModels subclass: #CatalogueModel
	instanceVariableNames: 'restInterface cartId catalogue cartIndex catalogueListIndex clientId'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #CatalogueModel category: 'TusLibros-View' stamp: 'GRC 11/29/2021 15:45:45'!
TusLibrosWindowModels subclass: #CatalogueModel
	instanceVariableNames: 'restInterface cartId catalogue cartIndex catalogueListIndex clientId password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!CatalogueModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 15:45:41' prior: 51089152!
purchases

    |res purchases |

    res _ OrderedCollection new.

    purchases _ restInterface sendListPurchasesRequest: {'clientId'. clientId. 'password'. password}.
    purchases keysAndValuesDo: [:anIsbn :aQuantity | 
        res add: (anIsbn , ': ' , aQuantity asString)].

    ^res! !
!LoginWindow methodsFor: 'operations' stamp: 'GRC 11/29/2021 15:46:34' prior: 51082652!
openCatalogue: aCartId

	CatalogueWindow openFor: aCartId.
	
	self closeButtonClicked.! !
!LoginModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 15:48:04' prior: 51088888!
sendCredentialsFromLoginRequest

	cartId _ restInterface sendLoginRequest: {'clientId'. clientId. 'password'. password}.
	
	(cartId < 1) 
		ifTrue: [^ErrorWindow showWithError: 'Invalid credentials, please try again.'] 
		ifFalse: [self triggerEvent: #validLogin with: {cartId. clientId. password}].! !
!LoginWindow methodsFor: 'operations' stamp: 'GRC 11/29/2021 15:48:56' prior: 51089195!
openCatalogue: credentials

	CatalogueWindow openFor: (credentials at: 1) withUser: (credentials at: 2) withPassword: (credentials at: 3).
	
	self closeButtonClicked.! !
!CatalogueWindow class methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 15:49:40'!
openFor: aCartId withUser: aUserId withPassword: aUserPassword

	^self new initializeWith: 'TusLibros-Service Catalogue Window' for: aCartId withUser: aUserId withPassword: aUserPassword.! !
!CatalogueWindow methodsFor: 'initialization' stamp: 'GRC 11/29/2021 15:50:37'!
initializeWith: aTitle for: aCartId withUser: aUserId withPassword: aUserPassword

    self titleMorph showButtonsNamed: #(#close #collapse ).
    self setLabel: aTitle.
    self model: (CatalogueModel new initializeWith: aCartId).
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.

    self model
        when: #updateCart
        send: #reloadCart
        to: self.

    self model
        when: #openTicket
        send: #openTicket:
        to: self.

	self model
        when: #clearCart
        send: #clearCart
        to: self.! !
!CatalogueWindow methodsFor: 'initialization' stamp: 'GRC 11/29/2021 15:51:24' prior: 51089232!
initializeWith: aTitle for: aCartId withUser: aUserId withPassword: aUserPassword

    self titleMorph showButtonsNamed: #(#close #collapse ).
    self setLabel: aTitle.
    self model: (CatalogueModel new initializeWith: aCartId withUser: aUserId withPassword: aUserPassword).
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.

    self model
        when: #updateCart
        send: #reloadCart
        to: self.

    self model
        when: #openTicket
        send: #openTicket:
        to: self.

	self model
        when: #clearCart
        send: #clearCart
        to: self.! !
!CatalogueModel methodsFor: 'initialize' stamp: 'GRC 11/29/2021 15:52:03'!
initializeWith: aCartId withUser: aClientId withPassword: aPassword

    cartId _ aCartId.
	clientId _ aClientId.
	password _ aPassword.
    restInterface _ TusLibrosInterface new.
    catalogue _ restInterface sendCatalogueRequest.
    catalogueListIndex _ 1.

    cartIndex _ 1.! !
!TusLibrosInterface methodsFor: 'requests' stamp: 'GRC 11/29/2021 15:52:30'!
sendListPurchasesRequest: aRequest

    | requestDictionary response |

    requestDictionary _ Dictionary newFromPairs: aRequest.
    response _ WebClient
        htmlSubmit: self url , '/listCart'
        fields: requestDictionary.

    response isSuccess ifTrue: [ ^ WebUtils jsonDecode: response content readStream ].
    ^ Dictionary new.! !
!TusLibrosInterface methodsFor: 'requests' stamp: 'GRC 11/29/2021 15:52:43' prior: 51089288!
sendListPurchasesRequest: aRequest

    | requestDictionary response |

    requestDictionary _ Dictionary newFromPairs: aRequest.
    response _ WebClient
        htmlSubmit: self url , '/listPurchases'
        fields: requestDictionary.

    response isSuccess ifTrue: [ ^ WebUtils jsonDecode: response content readStream ].
    ^ Dictionary new.! !
!CatalogueWindow methodsFor: 'initialization' stamp: 'GRC 11/29/2021 15:54:03' prior: 51089254!
initializeWith: aTitle for: aCartId withUser: aUserId withPassword: aUserPassword

    self titleMorph showButtonsNamed: #(#close #collapse ).
    self setLabel: aTitle.
    self model: (CatalogueModel new initializeWith: aCartId withUser: aUserId withPassword: aUserPassword).
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.

    self model
        when: #updateCart
        send: #reloadCart
        to: self.

    self model
        when: #openTicket
        send: #openTicket:
        to: self.! !
!CatalogueModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 15:56:37' prior: 51089183!
purchases

    |purchases |

    purchases _ restInterface sendListPurchasesRequest: {'clientId'. clientId. 'password'. password}.

	purchases _ WebUtils jsonDecode: purchases.

	self triggerEvent: #openTicket with: purchases.! !
!CatalogueModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 15:58:27' prior: 51089336!
purchases

    |purchases |

    purchases _ restInterface sendListPurchasesRequest: {'clientId'. clientId. 'password'. password}.

	purchases _ WebUtils jsonDecode: purchases.

	self triggerEvent: #listPurchases with: purchases.! !
!CatalogueModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 15:58:28' prior: 51089347!
purchases

    |purchases |

    purchases _ restInterface sendListPurchasesRequest: {'clientId'. clientId. 'password'. password}.

	purchases _ WebUtils jsonDecode: purchases.

	self triggerEvent: #listPurchases: with: purchases.! !

!classDefinition: #PurchasesWindow category: 'TusLibros-View' stamp: 'GRC 11/29/2021 15:59:18'!
TusLibrosWindows subclass: #PurchasesWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!CatalogueWindow methodsFor: 'operations' stamp: 'GRC 11/29/2021 15:59:03'!
listPurchases: userPurchases

	PurchasesWindow openFor: userPurchases.! !
!PurchasesWindow class methodsFor: 'no messages' stamp: 'GRC 11/29/2021 15:59:58'!
openFor: aTicket

	^self new initializeWith: 'User Purchases' for: aTicket.! !
!PurchasesWindow methodsFor: 'no messages' stamp: 'GRC 11/29/2021 16:00:21'!
initializeWith: aTitle for: aTicket

    self titleMorph showButtonsNamed: #(#close #collapse ).
    self setLabel: aTitle.
    self model: (TicketModel new initializeWith: aTicket).
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.! !
!PurchasesWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 16:01:02' overrides: 51073871!
buildMorphicWindow

    | purchasesMorphList purchasesMorph |

    purchasesMorphList _ self buildColumn.
	purchasesMorph _ self buildColumn.
    
    self buildTicketOn: purchasesMorphList.
	purchasesMorph addMorph: purchasesMorphList.
	self buildButtonWithAction: #logout andLabel: 'logout' in: purchasesMorph.

    self layoutMorph
        beRow;
        separation: 10;
        axisEdgeWeight: 0.5;
        addMorph: purchasesMorph.! !
!PurchasesWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 16:01:09'!
buildColumn

    | morph |
    morph _ LayoutMorph newColumn.
    morph separation: 25.
    morph axisEdgeWeight: 0.
    
    ^morph! !
!PurchasesWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 16:01:28' prior: 51089398 overrides: 51073871!
buildMorphicWindow

    | purchasesMorphList purchasesMorph |

    purchasesMorphList _ self buildColumn.
	purchasesMorph _ self buildColumn.
    
    self buildPurchasesListOn: purchasesMorphList.
	purchasesMorph addMorph: purchasesMorphList.
	self buildButtonWithAction: #logout andLabel: 'logout' in: purchasesMorph.

    self layoutMorph
        beRow;
        separation: 10;
        axisEdgeWeight: 0.5;
        addMorph: purchasesMorph.! !
!PurchasesWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 16:01:46'!
buildPurchasesListOn: aMorph
    
    | wordsListMorph |
    
    wordsListMorph _ PluggableListMorph
        model: self model
        listGetter: #ticket
        indexGetter: #ticketListIndex
        indexSetter: #ticketListIndex:.
    wordsListMorph borderColor: Color skyBlue;
        borderWidth: 1;
        morphWidth: 300.

    aMorph addMorph: wordsListMorph.! !
!PurchasesWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 16:02:34' prior: 51089441!
buildPurchasesListOn: aMorph
    
    | wordsListMorph |
    
    wordsListMorph _ PluggableListMorph
        model: self model
        listGetter: #purchases
        indexGetter: #purchasesListIndex
        indexSetter: #purchasesListIndex:.
    wordsListMorph borderColor: Color skyBlue;
        borderWidth: 1;
        morphWidth: 300.

    aMorph addMorph: wordsListMorph.! !

----SNAPSHOT----(29 November 2021 16:02:54) CuisUniversity-4972.image priorSource: 24238935!

!classDefinition: #PurchasesModel category: 'TusLibros-View' stamp: 'GRC 11/29/2021 16:04:46'!
TusLibrosWindowModels subclass: #PurchasesModel
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!PurchasesWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 16:04:30' prior: 51089386!
initializeWith: aTitle for: userPurchases

    self titleMorph showButtonsNamed: #(#close #collapse ).
    self setLabel: aTitle.
    self model: (PurchasesModel new initializeWith: userPurchases).
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.! !

!classDefinition: #PurchasesModel category: 'TusLibros-View' stamp: 'GRC 11/29/2021 16:05:46'!
TusLibrosWindowModels subclass: #PurchasesModel
	instanceVariableNames: 'purchases'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #PurchasesModel category: 'TusLibros-View' stamp: 'GRC 11/29/2021 16:05:46'!
TusLibrosWindowModels subclass: #PurchasesModel
	instanceVariableNames: 'purchases purchasesIndex'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

!classDefinition: #PurchasesModel category: 'TusLibros-View' stamp: 'GRC 11/29/2021 16:05:47'!
TusLibrosWindowModels subclass: #PurchasesModel
	instanceVariableNames: 'purchases purchasesIndex restInterface'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!
!PurchasesModel methodsFor: 'no messages' stamp: 'GRC 11/29/2021 16:05:44'!
initializeWith: userPurchases

	purchases _ userPurchases.
	purchasesIndex _ 1.
	restInterface _ TusLibrosInterface new.! !
!PurchasesModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 16:06:05'!
purchases

	^purchases copy.! !
!PurchasesModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 16:06:27'!
purchasesIndex

	^purchasesIndex.! !
!PurchasesModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 16:06:53'!
purchasesIndex: anIndex

	purchasesIndex _ anIndex.! !
!PurchasesModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 16:07:25' prior: 51089526!
purchases

	| ticketAsOrderedCollection |

    ticketAsOrderedCollection _ OrderedCollection new.
    purchases keysAndValuesDo: [:anIsbn :aQuantity | 
        ticketAsOrderedCollection add: (anIsbn , ': #' , aQuantity asString) ].

    ^ticketAsOrderedCollection.! !
!PurchasesModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 16:07:31' prior: 51089539!
purchases

	| purchasesAsOrderedCollection |

    purchasesAsOrderedCollection _ OrderedCollection new.
    purchases keysAndValuesDo: [:anIsbn :aQuantity | 
        purchasesAsOrderedCollection add: (anIsbn , ': #' , aQuantity asString) ].

    ^purchasesAsOrderedCollection.! !
!PurchasesWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 16:08:40' overrides: 51073967!
defaultExtent

	^ 720@480! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!CatalogueModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 16:09:55' prior: 51089358!
purchases

	|purchases |

	purchases _ restInterface sendListPurchasesRequest: {'clientId'. clientId. 'password'. password}.

	self triggerEvent: #listPurchases: with: purchases.! !

LoginWindow open.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!
!CatalogueModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 16:11:43' prior: 51089573!
purchases

	|purchases |

	purchases _ restInterface sendListPurchasesRequest: {'clientId'. clientId. 'password'. password}.

	self triggerEvent: #listPurchases with: purchases.! !

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!
!CatalogueWindow methodsFor: 'initialization' stamp: 'GRC 11/29/2021 16:18:34' prior: 51089316!
initializeWith: aTitle for: aCartId withUser: aUserId withPassword: aUserPassword

    self titleMorph showButtonsNamed: #(#close #collapse ).
    self setLabel: aTitle.
    self model: (CatalogueModel new initializeWith: aCartId withUser: aUserId withPassword: aUserPassword).
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.

    self model
        when: #updateCart
        send: #reloadCart
        to: self.

    self model
        when: #openTicket
        send: #openTicket:
        to: self.

	self model
        when: #listPurchases
        send: #listPurchases:
        to: self.! !
!CatalogueWindow methodsFor: 'initialization' stamp: 'GRC 11/29/2021 16:18:41' prior: 51088082!
initializeWith: aTitle for: cartId

    self titleMorph showButtonsNamed: #(#close #collapse ).
    self setLabel: aTitle.
    self model: (CatalogueModel new initializeWith: cartId).
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.

    self model
        when: #updateCart
        send: #reloadCart
        to: self.

    self model
        when: #openTicket
        send: #openTicket:
        to: self.! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!PurchasesModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 16:19:36'!
purchasesListIndex

	^purchasesIndex.! !

!methodRemoval: PurchasesModel #purchasesIndex stamp: 'GRC 11/29/2021 16:19:36'!
purchasesIndex

	^purchasesIndex.!
!PurchasesModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 16:19:41'!
purchasesListIndex: anIndex

	purchasesIndex _ anIndex.! !

!methodRemoval: PurchasesModel #purchasesIndex: stamp: 'GRC 11/29/2021 16:19:41'!
purchasesIndex: anIndex

	purchasesIndex _ anIndex.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!PurchasesWindow methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 16:20:09' prior: 51089424 overrides: 51073871!
buildMorphicWindow

    | purchasesMorphList purchasesMorph |

    purchasesMorphList _ self buildColumn.
	purchasesMorph _ self buildColumn.
    
    self buildPurchasesListOn: purchasesMorphList.
	purchasesMorph addMorph: purchasesMorphList.

    self layoutMorph
        beRow;
        separation: 10;
        axisEdgeWeight: 0.5;
        addMorph: purchasesMorph.! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!TusLibrosInterface methodsFor: 'requests' stamp: 'GRC 11/29/2021 16:22:35' prior: 51089302!
sendListPurchasesRequest: aRequest

    | requestDictionary response |

    requestDictionary _ Dictionary newFromPairs: aRequest.
    response _ WebClient
        htmlSubmit: self url , '/listPurchases'
        fields: requestDictionary.

	self halt.

    response isSuccess ifTrue: [ ^ WebUtils jsonDecode: response content readStream ].
    ^ Dictionary new.! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!CatalogueModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 16:25:10' prior: 51089589!
purchases

	|purchases request |
	
	request _ Dictionary new.
	request at: 'clientId' put: clientId.
	request at: 'password' put: password.

	purchases _ restInterface sendListPurchasesRequest: request.

	self triggerEvent: #listPurchases with: purchases.! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

LoginWindow open.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!TusLibrosInterface methodsFor: 'requests' stamp: 'GRC 11/29/2021 16:27:30' prior: 51089694!
sendListPurchasesRequest: aRequest

    | response |

    response _ WebClient
        htmlSubmit: self url , '/listPurchases'
        fields: aRequest.

	self halt.

    response isSuccess ifTrue: [ ^ WebUtils jsonDecode: response content readStream ].
    ^ Dictionary new.! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!TusLibrosInterface methodsFor: 'requests' stamp: 'GRC 11/29/2021 16:31:15' prior: 51089734!
sendListPurchasesRequest: aRequest

    | response |

    response _ WebClient
        htmlSubmit: self url , '/listPurchases'
        fields: aRequest.

    response isSuccess ifTrue: [ ^ WebUtils jsonDecode: response content readStream ].
    ^ Dictionary new.! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'GRC 11/29/2021 16:32:47' prior: 51082392!
listPurchasesOf: aUser authenticatingWith: aPassword

	| result |
	
	result _ Dictionary new.

	self if: aUser authenticatesWith: aPassword do: [
		salesBook listPurchasesOf: aUser on: result. 
	].

	^result.! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!TusLibrosInterface methodsFor: 'requests' stamp: 'GRC 11/29/2021 16:33:35' prior: 51089751!
sendListPurchasesRequest: aRequest

    | response |

    response _ WebClient
        htmlSubmit: self url , '/listPurchases'
        fields: aRequest.

	self halt.

    response isSuccess ifTrue: [ ^ WebUtils jsonDecode: response content readStream ].
    ^ Dictionary new.! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!TusLibrosInterface methodsFor: 'requests' stamp: 'GRC 11/29/2021 16:34:05' prior: 51089778!
sendListPurchasesRequest: aRequest

    | response |

    response _ WebClient
        htmlSubmit: self url , '/listPurchases'
        fields: aRequest.

    response isSuccess ifTrue: [ ^ WebUtils jsonDecode: response content readStream ].
    ^ Dictionary new.! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!
!SalesBook methodsFor: 'list purchases' stamp: 'GRC 11/29/2021 16:37:00' prior: 51081988!
listPurchasesOf: aUser on: userPurchases

	| total |
	
	total _ 0.

	^sales inject: userPurchases
		into: [ :purchases :aSale |
			(aSale wasDoneBy: aUser) ifTrue: [ total _ total + (self register: aSale on: purchases)].
			purchases at: 'totalAmount' put: total.
			purchases.
		].! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!TusLibrosInterface methodsFor: 'requests' stamp: 'GRC 11/29/2021 16:38:25' prior: 51089795!
sendListPurchasesRequest: aRequest

    | response |

    response _ WebClient
        htmlSubmit: self url , '/listPurchases'
        fields: aRequest.

    response isSuccess ifTrue: [ ^ WebUtils jsonDecode: response content readStream ].
    ^ Dictionary new.! !
!CatalogueModel methodsFor: 'operations' stamp: 'GRC 11/29/2021 16:39:17' prior: 51089713!
purchases

	|purchases request |
	
	request _ Dictionary new.
	request at: 'clientId' put: ''.
	request at: 'password' put: ''.

	purchases _ restInterface sendListPurchasesRequest: request.

	self triggerEvent: #listPurchases with: purchases.! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!TusLibrosInterface methodsFor: 'requests' stamp: 'GRC 11/29/2021 16:39:47' prior: 51089826!
sendListPurchasesRequest: aRequest

    | response |

    response _ WebClient
        htmlSubmit: self url , '/listPurchases'
        fields: aRequest.

	self halt.

    response isSuccess ifTrue: [ ^ WebUtils jsonDecode: response content readStream ].
    ^ Dictionary new.! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!TusLibrosRestInterface methodsFor: 'initialization' stamp: 'GRC 11/29/2021 16:42:19' prior: 51083508!
initializeWith: aPortNumber
	
	port := aPortNumber.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: LoginDBMock new validUsersAndPasswords
		acceptingItemsOf: StoreTestObjectsFactory new defaultCatalog
		registeringOn: SalesBook new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: (ManualClock now: DateAndTime now).
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action: [:aRequest | self createCartAction: aRequest].
	webServer addService: '/addToCart' action: [:aRequest | self addToCartAction: aRequest].
	webServer addService: '/listCart' action: [:aRequest | self listCartAction: aRequest].
	webServer addService: '/checkoutCart' action: [:aRequest | self checkOutCartAction: aRequest].
	webServer addService: '/listPurchases' action: [:aRequest | self listPurchasesAction: aRequest].
	webServer addService: '/catalog' action: [:aRequest | self catalogAction: aRequest].
	webServer addService: '/removeFromCart' action: [:aRequest | self removeFromCartAction: aRequest].! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!PurchasesModel methodsFor: 'as yet unclassified' stamp: 'GRC 11/29/2021 16:45:36' prior: 51089551!
purchases

	| purchasesAsOrderedCollection |

    purchasesAsOrderedCollection _ OrderedCollection new.
    purchases keysAndValuesDo: [:aKey :aQuantity | 
	(aKey = 'total amount') 
		ifTrue: [purchasesAsOrderedCollection add: (aKey , ': $' , aQuantity asString)]
		ifFalse: [purchasesAsOrderedCollection add: (aKey , ': #' , aQuantity asString)]
	].

    ^purchasesAsOrderedCollection.! !
!SalesBook methodsFor: 'list purchases' stamp: 'GRC 11/29/2021 16:45:49' prior: 51089809!
listPurchasesOf: aUser on: userPurchases

	| total |
	
	total _ 0.

	^sales inject: userPurchases
		into: [ :purchases :aSale |
			(aSale wasDoneBy: aUser) ifTrue: [ total _ total + (self register: aSale on: purchases)].
			purchases at: 'total amount' put: total.
			purchases.
		].! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'GRC 11/29/2021 16:45:51'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'GRC 11/29/2021 16:45:51'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'GRC 11/29/2021 16:45:51'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'GRC 11/29/2021 16:45:51'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'GRC 11/29/2021 16:45:51'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'GRC 11/29/2021 16:45:51'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'GRC 11/29/2021 16:45:51'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'GRC 11/29/2021 16:45:51'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test22CanRemoveItemsFromACreatedCart stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test23CanNotRemoveItemFromNotCreatedCart stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveFromCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveItemNotSellByTheStore stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test26CanNotRemoveItemsMoreTimesThanItAppears stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test27CheckedOutCartIsEmpty stamp: 'GRC 11/29/2021 16:45:52'!
PASSED!

----SNAPSHOT----(29 November 2021 16:45:56) CuisUniversity-4972.image priorSource: 24250235!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!TusLibrosInterface methodsFor: 'requests' stamp: 'GRC 11/29/2021 16:46:11' prior: 51089854!
sendListPurchasesRequest: aRequest

    | response |

    response _ WebClient
        htmlSubmit: self url , '/listPurchases'
        fields: aRequest.

    response isSuccess ifTrue: [ ^ WebUtils jsonDecode: response content readStream ].
    ^ Dictionary new.! !

----SNAPSHOT----(29 November 2021 16:46:21) CuisUniversity-4972.image priorSource: 24270176!

----QUIT----(29 November 2021 16:46:38) CuisUniversity-4972.image priorSource: 24270793!

----STARTUP---- (29 November 2021 16:52:35) as C:\Users\Guido\Desktop\windows64\CuisUniversity-4972.image!


----End fileIn of \Users\Guido\Desktop\windows64\TusLibros-View.st----!

----End fileIn of \Users\Guido\Desktop\windows64\TusLibros-Tests.st----!

----End fileIn of \Users\Guido\Desktop\windows64\TusLibros-Model.st----!

----End fileIn of \Users\Guido\Desktop\windows64\Morphic-Widgets-Extras.pck.st----!

CodePackage subclass: #ColorExtrasPackage
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Color-Extras'!

!classDefinition: #ColorExtrasPackage category: 'Color-Extras' stamp: 'Install-Color-Extras 11/29/2021 16:53:19'!
CodePackage subclass: #ColorExtrasPackage
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Color-Extras'!

ColorExtrasPackage class
	instanceVariableNames: ''!

!classDefinition: 'ColorExtrasPackage class' category: 'Color-Extras' stamp: 'Install-Color-Extras 11/29/2021 16:53:19'!
ColorExtrasPackage class
	instanceVariableNames: ''!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\Features\Color-Extras.pck.st----!

CodePackage subclass: #MorphicMisc1Package
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Misc1'!

!classDefinition: #MorphicMisc1Package category: 'Morphic-Misc1' stamp: 'Install-Morphic-Misc1 11/29/2021 16:53:20'!
CodePackage subclass: #MorphicMisc1Package
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Misc1'!
!MorphicMisc1Package commentStamp: '<historical>' prior: 0!
My purpose in life is to check that any base image methods overridden have not been updated.
See #MorphMisc1Package class>>prePackageInstall!

MorphicMisc1Package class
	instanceVariableNames: ''!

!classDefinition: 'MorphicMisc1Package class' category: 'Morphic-Misc1' stamp: 'Install-Morphic-Misc1 11/29/2021 16:53:20'!
MorphicMisc1Package class
	instanceVariableNames: ''!

----End fileIn of \Users\Guido\Desktop\windows64\Morphic-Misc1.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\System\Collections-CompactArrays.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\Features\Compression.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\Features\Sound.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\Features\Cryptography-DigitalSignatures.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\Features\Identities-UUID.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\System\Network-Kernel.pck.st----!

----End fileIn of \Users\Guido\Desktop\windows64\WebClient.pck.st----!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 11/29/2021 16:54:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 11/29/2021 16:54:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 11/29/2021 16:54:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 11/29/2021 16:54:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 11/29/2021 16:54:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 16:54:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 16:54:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 11/29/2021 16:54:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 16:54:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test22CanRemoveItemsFromACreatedCart stamp: 'GRC 11/29/2021 16:54:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test23CanNotRemoveItemFromNotCreatedCart stamp: 'GRC 11/29/2021 16:54:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveFromCartWhenSessionIsExpired stamp: 'GRC 11/29/2021 16:54:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveItemNotSellByTheStore stamp: 'GRC 11/29/2021 16:54:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 11/29/2021 16:54:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test26CanNotRemoveItemsMoreTimesThanItAppears stamp: 'GRC 11/29/2021 16:54:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test27CheckedOutCartIsEmpty stamp: 'GRC 11/29/2021 16:54:36'!
PASSED!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

LoginWindow open.!

Panel subclass: #TusLibrosWindows
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

Panel subclass: #TusLibrosWindows
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-View'!

----STARTUP---- (29 November 2021 16:59:16) as C:\Users\Guido\Desktop\windows64\CuisUniversity-4972.image!


----End fileIn of \Users\Guido\Desktop\windows64\Morphic-Widgets-Extras.pck.st----!

CodePackage subclass: #ColorExtrasPackage
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Color-Extras'!

!classDefinition: #ColorExtrasPackage category: 'Color-Extras' stamp: 'Install-Color-Extras 11/29/2021 16:59:43'!
CodePackage subclass: #ColorExtrasPackage
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Color-Extras'!

ColorExtrasPackage class
	instanceVariableNames: ''!

!classDefinition: 'ColorExtrasPackage class' category: 'Color-Extras' stamp: 'Install-Color-Extras 11/29/2021 16:59:43'!
ColorExtrasPackage class
	instanceVariableNames: ''!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\Features\Color-Extras.pck.st----!

CodePackage subclass: #MorphicMisc1Package
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Misc1'!

!classDefinition: #MorphicMisc1Package category: 'Morphic-Misc1' stamp: 'Install-Morphic-Misc1 11/29/2021 16:59:45'!
CodePackage subclass: #MorphicMisc1Package
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Misc1'!
!MorphicMisc1Package commentStamp: '<historical>' prior: 0!
My purpose in life is to check that any base image methods overridden have not been updated.
See #MorphMisc1Package class>>prePackageInstall!

MorphicMisc1Package class
	instanceVariableNames: ''!

!classDefinition: 'MorphicMisc1Package class' category: 'Morphic-Misc1' stamp: 'Install-Morphic-Misc1 11/29/2021 16:59:45'!
MorphicMisc1Package class
	instanceVariableNames: ''!

----End fileIn of \Users\Guido\Desktop\windows64\Morphic-Misc1.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\System\Collections-CompactArrays.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\Features\Compression.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\Features\Sound.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\Features\Cryptography-DigitalSignatures.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\Features\Identities-UUID.pck.st----!

----End fileIn of C:\Users\Guido\Desktop\windows64\Packages\System\Network-Kernel.pck.st----!

----End fileIn of \Users\Guido\Desktop\windows64\WebClient.pck.st----!

----End fileIn of \Users\Guido\Desktop\windows64\TusLibros-View.st----!

----End fileIn of \Users\Guido\Desktop\windows64\TusLibros-Tests.st----!

----End fileIn of \Users\Guido\Desktop\windows64\TusLibros-Model.st----!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

server destroy.!

----QUIT----(29 November 2021 17:02:30) CuisUniversity-4972.image priorSource: 18974255!

----STARTUP---- (1 December 2021 11:44:22) as C:\Users\Guido\Desktop\windows64\CuisUniversity-4972.image!


server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!
!StoreTestObjectsFactory methodsFor: 'cart' stamp: 'GRC 12/1/2021 11:46:09' prior: 51188439!
defaultCatalog

	^ Dictionary new
		at: self itemSellByTheStore put: self itemSellByTheStorePrice;
		at: self anotherItemSellByTheStore put: self anotherItemSellByTheStorePrice;
		at: 'Rayuela' put: 350;
		yourself ! !
!StoreTestObjectsFactory methodsFor: 'cart' stamp: 'GRC 12/1/2021 11:47:42' prior: 51189592!
defaultCatalog

	^ Dictionary new
		at: self itemSellByTheStore put: self itemSellByTheStorePrice;
		at: self anotherItemSellByTheStore put: self anotherItemSellByTheStorePrice;
		at: 'Rayuela' put: 350;
		at: 'Narnia' put: 400;
		at: 'Gaudi' put: 300;
		at: 'Silverschats' put: 500;
		yourself ! !

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!
!PurchasesModel methodsFor: 'as yet unclassified' stamp: 'GRC 12/1/2021 11:51:00' prior: 51187340!
purchases

	| purchasesAsOrderedCollection total |

    purchasesAsOrderedCollection _ OrderedCollection new.
    purchases keysAndValuesDo: [:aKey :aQuantity | 
	(aKey = 'total amount') ifFalse: [purchasesAsOrderedCollection add: (aKey , ': #' , aQuantity asString)]
	].

	total _ purchases at: 'total amount'.

	purchasesAsOrderedCollection add: ('total amount' , ': $' , total asString)

    ^purchasesAsOrderedCollection.! !

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!PurchasesModel methodsFor: 'as yet unclassified' stamp: 'GRC 12/1/2021 11:51:32' prior: 51189619!
purchases

	| purchasesAsOrderedCollection total |

    purchasesAsOrderedCollection _ OrderedCollection new.
    purchases keysAndValuesDo: [:aKey :aQuantity | 
	(aKey = 'total amount') ifFalse: [purchasesAsOrderedCollection add: (aKey , ': #' , aQuantity asString)]
	].

	total _ purchases at: 'total amount'.

	purchasesAsOrderedCollection add: ('total amount' , ': $' , total asString).

    ^purchasesAsOrderedCollection.! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

----QUIT----(1 December 2021 11:51:52) CuisUniversity-4972.image priorSource: 27453771!

----STARTUP---- (3 December 2021 20:39:03) as C:\Users\Guido\Desktop\TusLibros Entrega\CuisUniversity-4972.image!


server _ TusLibrosRestInterface listeningOn: 8080.!
!StoreTestObjectsFactory methodsFor: 'cart' stamp: 'GRC 12/3/2021 20:48:20'!
defaultCatalogReact

	^ Dictionary new
		at: self itemSellByTheStore put: self itemSellByTheStorePrice;
		at: self anotherItemSellByTheStore put: self anotherItemSellByTheStorePrice;
		at: 'Rayuela' put: 350;
		at: 'Narnia' put: 400;
		at: 'Gaudi' put: 300;
		at: 'Silverschats' put: 500;
		yourself ! !
!StoreTestObjectsFactory methodsFor: 'cart' stamp: 'GRC 12/3/2021 20:49:36' prior: 51189665!
defaultCatalogReact

	^ Dictionary new
		at: self itemSellByTheStore put: self itemSellByTheStorePrice;
		at: self anotherItemSellByTheStore put: self anotherItemSellByTheStorePrice;
		at: 'Rayuela' put: (self libroCon: 1 autor: 'Julio Cortazar' precio: 600 cantidad: 0);
		at: 'Narnia' put: 400;
		at: 'Gaudi' put: 300;
		at: 'Silverschats' put: 500;
		yourself ! !
!StoreTestObjectsFactory methodsFor: 'items' stamp: 'GRC 12/3/2021 20:51:56'!
libro: unTitulo con: unId autor: unAutor precio: unMonto cantidad: unaCantidad

	^Dictionary new
		at: 'id' put: unId;
		at: 'titulo' put: unTitulo;
		at: 'autor' put: unAutor;
		at: 'precio' put: unMonto;
		at: 'cantidad' put: unaCantidad;
		yourself.
		! !
!StoreTestObjectsFactory methodsFor: 'cart' stamp: 'GRC 12/3/2021 20:52:39' prior: 51189678!
defaultCatalogReact

	^ Dictionary new
		at: 'Rayuela' put: (self libro: 'Rayuela' con: 1 autor: 'Julio Cortazar' precio: 600 cantidad: 0);
		yourself ! !
!TusLibrosRestInterface methodsFor: 'initialization' stamp: 'GRC 12/3/2021 20:52:57' prior: 51189166!
initializeWith: aPortNumber
	
	port := aPortNumber.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: LoginDBMock new validUsersAndPasswords
		acceptingItemsOf: StoreTestObjectsFactory new defaultCatalogReact
		registeringOn: SalesBook new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: (ManualClock now: DateAndTime now).
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action: [:aRequest | self createCartAction: aRequest].
	webServer addService: '/addToCart' action: [:aRequest | self addToCartAction: aRequest].
	webServer addService: '/listCart' action: [:aRequest | self listCartAction: aRequest].
	webServer addService: '/checkoutCart' action: [:aRequest | self checkOutCartAction: aRequest].
	webServer addService: '/listPurchases' action: [:aRequest | self listPurchasesAction: aRequest].
	webServer addService: '/catalog' action: [:aRequest | self catalogAction: aRequest].
	webServer addService: '/removeFromCart' action: [:aRequest | self removeFromCartAction: aRequest].! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'GRC 12/3/2021 20:53:06'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'GRC 12/3/2021 20:53:06'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'GRC 12/3/2021 20:53:06'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'GRC 12/3/2021 20:53:06'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'GRC 12/3/2021 20:53:06'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'GRC 12/3/2021 20:53:06'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'GRC 12/3/2021 20:53:06'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test22CanRemoveItemsFromACreatedCart stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test23CanNotRemoveItemFromNotCreatedCart stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveFromCartWhenSessionIsExpired stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveItemNotSellByTheStore stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test26CanNotRemoveItemsMoreTimesThanItAppears stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test27CheckedOutCartIsEmpty stamp: 'GRC 12/3/2021 20:53:07'!
PASSED!
!TusLibrosSystemFacadeTest methodsFor: 'setup' stamp: 'GRC 12/3/2021 20:53:20' prior: 51188048 overrides: 16927572!
setUp

	testObjectsFactory := StoreTestObjectsFactory new.
	clock := ManualClock now: testObjectsFactory today.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: testObjectsFactory defaultCatalogReact
		registeringOn: self createSalesBook
		debitingThrought: self merchantProcessor
		measuringTimeWith: clock
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'GRC 12/3/2021 20:53:21'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/3/2021 20:53:22'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 12/3/2021 20:53:22'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 12/3/2021 20:53:22'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 12/3/2021 20:53:22'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 12/3/2021 20:53:22'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 12/3/2021 20:53:22'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 12/3/2021 20:53:22'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 12/3/2021 20:53:22'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 12/3/2021 20:53:22'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 12/3/2021 20:53:22'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test22CanRemoveItemsFromACreatedCart stamp: 'GRC 12/3/2021 20:53:23'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test23CanNotRemoveItemFromNotCreatedCart stamp: 'GRC 12/3/2021 20:53:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveFromCartWhenSessionIsExpired stamp: 'GRC 12/3/2021 20:53:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveItemNotSellByTheStore stamp: 'GRC 12/3/2021 20:53:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 12/3/2021 20:53:23'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test26CanNotRemoveItemsMoreTimesThanItAppears stamp: 'GRC 12/3/2021 20:53:23'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test27CheckedOutCartIsEmpty stamp: 'GRC 12/3/2021 20:53:23'!
ERROR!

----SNAPSHOT----(3 December 2021 20:53:35) CuisUniversity-4972.image priorSource: 27456180!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/3/2021 20:53:37'!
ERROR!
!StoreTestObjectsFactory methodsFor: 'catalogue' stamp: 'GRC 12/3/2021 20:54:51' prior: 51189703!
defaultCatalogReact

	^ Dictionary new
		at: self itemSellByTheStore put: self itemSellByTheStorePrice;
		at: self anotherItemSellByTheStore put: self anotherItemSellByTheStorePrice;
		at: 'Narnia' put: 400;
		at: 'Gaudi' put: 300;
		at: 'Silverschats' put: 500;
		at: 'Rayuela' put: (self libro: 'Rayuela' con: 1 autor: 'Julio Cortazar' precio: 600 cantidad: 0);
		yourself ! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'GRC 12/3/2021 20:54:59'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'GRC 12/3/2021 20:54:59'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'GRC 12/3/2021 20:54:59'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'GRC 12/3/2021 20:54:59'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'GRC 12/3/2021 20:54:59'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'GRC 12/3/2021 20:54:59'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'GRC 12/3/2021 20:54:59'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'GRC 12/3/2021 20:54:59'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'GRC 12/3/2021 20:54:59'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'GRC 12/3/2021 20:54:59'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'GRC 12/3/2021 20:54:59'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'GRC 12/3/2021 20:54:59'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'GRC 12/3/2021 20:54:59'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'GRC 12/3/2021 20:54:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 12/3/2021 20:54:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 12/3/2021 20:54:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test22CanRemoveItemsFromACreatedCart stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test23CanNotRemoveItemFromNotCreatedCart stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveFromCartWhenSessionIsExpired stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveItemNotSellByTheStore stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test26CanNotRemoveItemsMoreTimesThanItAppears stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test27CheckedOutCartIsEmpty stamp: 'GRC 12/3/2021 20:55:00'!
PASSED!

----SNAPSHOT----(3 December 2021 20:55:03) CuisUniversity-4972.image priorSource: 27469437!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy.].!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy.].!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy.].!

server _ TusLibrosRestInterface listeningOn: 8080.!

LoginWindow open.!
!StoreTestObjectsFactory methodsFor: 'catalogue' stamp: 'GRC 12/3/2021 21:06:31' prior: 51190078!
defaultCatalogReact

	^ {self libro: 'Rayuela' con: 1 autor: 'Julio Cortazar' precio: 600 cantidad: 0}! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy.].!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/3/2021 21:26:39' prior: 51189218!
catalogAction: aRequest

	[ | result catalog |
		
		catalog := tusLibros catalog.
		
		result := WebUtils jsonEncode: catalog.
		
		aRequest send200Response: result
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy.].!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy.].!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/3/2021 21:32:23' prior: 51190273!
catalogAction: aRequest

	[ | result catalog |
		
		catalog := tusLibros catalog.
		
		result := WebUtils jsonEncode: catalog.
		
		aRequest send200Response: result
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/3/2021 21:32:41' prior: 51190296!
catalogAction: aRequest

	[ | result catalog |
		
		catalog := tusLibros catalog.
		
		result := WebUtils jsonEncode: catalog.
		
		aRequest send200Response: result
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: 'http://localhost:3000/'.]
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy.].!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/3/2021 21:33:29' prior: 51190311!
catalogAction: aRequest

	[ | result catalog |
		
		catalog := tusLibros catalog.
		
		result := WebUtils jsonEncode: catalog.
		
		aRequest send200Response: result
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/3/2021 21:33:57' prior: 51190331!
catalogAction: aRequest

	[ | result catalog |
		
		catalog := tusLibros catalog.
		
		result := WebUtils jsonEncode: catalog.
		
		aRequest send200Response: result
			contentType: 'application/jsx; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy.].!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/3/2021 21:34:33' prior: 51190346!
catalogAction: aRequest

	[ | result catalog |
		
		catalog := tusLibros catalog.
		
		result := WebUtils jsonEncode: catalog.
		
		aRequest send200Response: result
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy.].!

server _ TusLibrosRestInterface listeningOn: 8080.!
!StoreTestObjectsFactory methodsFor: 'catalogue' stamp: 'GRC 12/3/2021 22:35:43' prior: 51190262!
defaultCatalogReact

	| rayuela elAleph elSur elTunel antesDelFin elReinoDelReves tutuMaramba bestiario |
	
	rayuela _ self libro: 'Rayuela' con: 1 autor: 'Julio Cortazar' precio: 600 cantidad: 0.
	elAleph _ self libro: 'El Aleph' con: 2 autor: 'Jorge L. Borges' precio: 450 cantidad: 0.
	elSur _ self libro: 'El Sur' con: 3 autor: 'Jorge L. Borges' precio: 250 cantidad: 0.
	antesDelFin _ self libro: 'Antes Del Fin' con: 4 autor: 'Ernesto Sbato' precio: 350 cantidad: 0.
	elTunel _ self libro: 'El Tnel' con: 5 autor: 'Ernesto Sbato' precio: 400 cantidad: 0.
	elReinoDelReves _ self libro: 'El Reino Del Revs' con: 6 autor: 'Maria E. Walsh' precio: 450 cantidad: 0.
	elAleph _ self libro: 'El Aleph' con: 7 autor: 'Julio Cortazar' precio: 450 cantidad: 0.
	elAleph _ self libro: 'El Aleph' con: 8 autor: 'Julio Cortazar' precio: 450 cantidad: 0.

	^ {}! !
!StoreTestObjectsFactory methodsFor: 'catalogue' stamp: 'GRC 12/3/2021 22:37:39' prior: 51190384!
defaultCatalogReact

	| rayuela elAleph elSur elTunel antesDelFin elReinoDelReves tutuMaramba bestiario |
	
	rayuela _ self libro: 'Rayuela' con: 1 autor: 'Julio Cortazar' precio: 600 cantidad: 0.
	bestiario _ self libro: 'Bestiario' con: 8 autor: 'Julio Cortazar' precio: 350 cantidad: 0.
	elAleph _ self libro: 'El Aleph' con: 2 autor: 'Jorge L. Borges' precio: 450 cantidad: 0.
	elSur _ self libro: 'El Sur' con: 3 autor: 'Jorge L. Borges' precio: 250 cantidad: 0.
	antesDelFin _ self libro: 'Antes Del Fin' con: 4 autor: 'Ernesto Sbato' precio: 350 cantidad: 0.
	elTunel _ self libro: 'El Tnel' con: 5 autor: 'Ernesto Sbato' precio: 400 cantidad: 0.
	elReinoDelReves _ self libro: 'El Reino Del Revs' con: 6 autor: 'Maria E. Walsh' precio: 300 cantidad: 0.
	tutuMaramba _ self libro: 'Tut Maramb' con: 7 autor: 'Maria E. Walsh' precio: 200 cantidad: 0.
	

	^ {rayuela. bestiario. elAleph. elSur. antesDelFin. elTunel. elReinoDelReves. tutuMaramba.}! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!
!LoginDBMock methodsFor: 'initialization' stamp: 'GRC 12/3/2021 22:51:47' prior: 51188962 overrides: 16896425!
initialize

	database _ Dictionary new
		at: 'admin' put: 'admin';
		at: '' put: '';
		yourself! !
!LoginDBMock methodsFor: 'initialization' stamp: 'GRC 12/3/2021 22:52:07' prior: 51190452 overrides: 16896425!
initialize

	database _ Dictionary new
		at: 'validUser' put: 'validUserPassword';
		at: 'anotherValidUser' put: 'validUserPassword';
		at: 'admin' put: 'admin';
		at: '' put: '';
		yourself! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/3/2021 23:00:30' prior: 51189202!
addToCartAction: aRequest	
	[ | cartId bookIsbn bookQuantity |
		cartId := (aRequest fields at: 'cartId') asNumber.
		bookIsbn := aRequest fields at: 'bookIsbn'.
		bookQuantity := (aRequest fields at: 'bookQuantity') asNumber.
		
		tusLibros add: bookQuantity of: bookIsbn toCartIdentifiedAs: cartId.
	
		aRequest send200Response: 'OK'
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.].
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/3/2021 23:00:39' prior: 51189259!
createCartAction: aRequest
	[ | clientId password cartId result  |
		clientId := aRequest fields at: 'clientId'.
		password := aRequest fields at: 'password'.
		
		cartId := tusLibros createCartFor: clientId authenticatedWith: password.
	
		result := WebUtils jsonEncode: cartId.
		aRequest send200Response: result
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/3/2021 23:00:49' prior: 51189229!
checkOutCartAction: aRequest	

	[ | cartId cced ccn cco expMonth expYear expirationDate result ticket ticketItems |
		"cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'."
		
		cartId _ 1.
		ccn _ '1111222233334444'.
		cced _ '11/2022'.
		cco _ 'Juan Perez'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		ticket := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		ticketItems _ ticket items.
		
		result := WebUtils jsonEncode: ticketItems.
		
		aRequest send200Response: result
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.].
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/3/2021 23:00:54' prior: 51189275!
listCartAction: aRequest	
	[ | cartId result cartContent resultDict |
		cartId := (aRequest fields at: 'cartId') asNumber.
		
		cartContent := tusLibros listCartIdentifiedAs: cartId.

		resultDict := Dictionary new.
		cartContent contents keysAndValuesDo: [ :anItem :aQuantity | resultDict add: anItem->aQuantity ].
		result := WebUtils jsonEncode: resultDict.
		
		aRequest send200Response: result
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.].
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/3/2021 23:00:58' prior: 51189293!
listPurchasesAction: aRequest
	[ | clientId password purchases result |
		clientId := aRequest fields at: 'clientId'.
		password := aRequest fields at: 'password'.
		
		purchases := tusLibros listPurchasesOf: clientId authenticatingWith: password.
		
		result := WebUtils jsonEncode: purchases.
		
		aRequest send200Response: result
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/3/2021 23:01:03' prior: 51189309!
removeFromCartAction: aRequest	

	[ | cartId bookIsbn bookQuantity |
		cartId := (aRequest fields at: 'cartId') asNumber.
		bookIsbn := aRequest fields at: 'bookIsbn'.
		bookQuantity := (aRequest fields at: 'bookQuantity') asNumber.
		
		tusLibros remove: bookQuantity of: bookIsbn fromCartIdentifiedAs: cartId.
	
		aRequest send200Response: 'OK'
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.].
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: anError messageText ]! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/3/2021 23:02:07' prior: 51190591!
removeFromCartAction: aRequest	

	[ | cartId bookIsbn bookQuantity |
		cartId := (aRequest fields at: 'cartId') asNumber.
		bookIsbn := aRequest fields at: 'bookIsbn'.
		bookQuantity := (aRequest fields at: 'bookQuantity') asNumber.
		
		tusLibros remove: bookQuantity of: bookIsbn fromCartIdentifiedAs: cartId.
	
		aRequest send200Response: 'OK'
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.].
	 ] 
		on: Error 
		do: [ :anError | aRequest send400Response: (anError messageText)
			 ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/3/2021 23:04:55' prior: 51190616!
removeFromCartAction: aRequest	

	[ | cartId bookIsbn bookQuantity |
		cartId := (aRequest fields at: 'cartId') asNumber.
		bookIsbn := aRequest fields at: 'bookIsbn'.
		bookQuantity := (aRequest fields at: 'bookQuantity') asNumber.
		
		tusLibros remove: bookQuantity of: bookIsbn fromCartIdentifiedAs: cartId.
	
		aRequest send200Response: 'OK'
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.].
	 ] 
		on: Error 
		do: [ :anError | aRequest sendResponseCode: 400 content: (anError messageText) type: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.].
			 ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/3/2021 23:05:14' prior: 51190493!
createCartAction: aRequest
	[ | clientId password cartId result  |
		clientId := aRequest fields at: 'clientId'.
		password := aRequest fields at: 'password'.
		
		cartId := tusLibros createCartFor: clientId authenticatedWith: password.
	
		result := WebUtils jsonEncode: cartId.
		aRequest send200Response: result
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
	 ] 
		on: Error 
		do: [ :anError | aRequest sendResponseCode: 400 content: (anError messageText) type: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]. ]! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/3/2021 23:09:30' prior: 51190472!
addToCartAction: aRequest	
	[ | cartId bookIsbn bookQuantity |
		cartId := (aRequest fields at: 'cartId') asNumber.
		bookIsbn := aRequest fields at: 'bookIsbn'.
		bookQuantity := (aRequest fields at: 'bookQuantity') asNumber.
		
		tusLibros add: bookQuantity of: bookIsbn toCartIdentifiedAs: cartId.
	
		aRequest send200Response: 'OK'
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.].
	 ] 
		on: Error 
		do: [ :anError | aRequest sendResponseCode: 400 content: (anError messageText) type: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.].  ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/3/2021 23:09:36' prior: 51190365!
catalogAction: aRequest

	[ | result catalog |
		
		catalog := tusLibros catalog.
		
		result := WebUtils jsonEncode: catalog.
		
		aRequest send200Response: result
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
	 ] 
		on: Error 
		do: [ :anError | aRequest sendResponseCode: 400 content: (anError messageText) type: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.].  ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/3/2021 23:09:42' prior: 51190513!
checkOutCartAction: aRequest	

	[ | cartId cced ccn cco expMonth expYear expirationDate result ticket ticketItems |
		"cartId := (aRequest fields at: 'cartId') asNumber.
		ccn := aRequest fields at: 'ccn'.
		cced := aRequest fields at: 'cced'.
		cco := aRequest fields at: 'cco'."
		
		cartId _ 1.
		ccn _ '1111222233334444'.
		cced _ '11/2022'.
		cco _ 'Juan Perez'.
		
		expMonth _ (cced copyFrom: 1 to: 2) asNumber.
		expYear _ (cced copyFrom: 4 to: 7) asNumber.
		
		expirationDate _ Month month: expMonth year: expYear.
		
		ticket := tusLibros checkOutCartIdentifiedAs: cartId withCreditCardNumbered: ccn ownedBy: cco expiringOn: expirationDate.
		
		ticketItems _ ticket items.
		
		result := WebUtils jsonEncode: ticketItems.
		
		aRequest send200Response: result
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.].
	 ] 
		on: Error 
		do: [ :anError | aRequest sendResponseCode: 400 content: (anError messageText) type: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.].  ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/3/2021 23:09:48' prior: 51190547!
listCartAction: aRequest	
	[ | cartId result cartContent resultDict |
		cartId := (aRequest fields at: 'cartId') asNumber.
		
		cartContent := tusLibros listCartIdentifiedAs: cartId.

		resultDict := Dictionary new.
		cartContent contents keysAndValuesDo: [ :anItem :aQuantity | resultDict add: anItem->aQuantity ].
		result := WebUtils jsonEncode: resultDict.
		
		aRequest send200Response: result
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.].
	 ] 
		on: Error 
		do: [ :anError | aRequest sendResponseCode: 400 content: (anError messageText) type: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.].  ]! !
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/3/2021 23:09:52' prior: 51190570!
listPurchasesAction: aRequest
	[ | clientId password purchases result |
		clientId := aRequest fields at: 'clientId'.
		password := aRequest fields at: 'password'.
		
		purchases := tusLibros listPurchasesOf: clientId authenticatingWith: password.
		
		result := WebUtils jsonEncode: purchases.
		
		aRequest send200Response: result
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
	 ] 
		on: Error 
		do: [ :anError | aRequest sendResponseCode: 400 content: (anError messageText) type: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.].  ]! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

----QUIT----(3 December 2021 23:56:16) CuisUniversity-4972.image priorSource: 27475057!

----STARTUP---- (4 December 2021 18:38:53) as C:\Users\Guido\Desktop\Amazonas - Backend\CuisUniversity-4972.image!


server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

----QUIT----(4 December 2021 19:55:15) CuisUniversity-4972.image priorSource: 27493705!

----STARTUP---- (7 December 2021 14:11:00) as C:\Users\Guido\Desktop\Amazonas - Backend\CuisUniversity-4972.image!


server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

----QUIT----(7 December 2021 14:50:49) CuisUniversity-4972.image priorSource: 27494035!

----STARTUP---- (8 December 2021 14:11:07) as C:\Users\Guido\Desktop\Git\e-commerce-site\Backend\CuisUniversity-4972.image!


TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosSystemFacade methodsFor: 'cart session management' stamp: 'GRC 12/8/2021 14:23:28' prior: 51189438!
generateCartId

	"Recuerden que esto es un ejemplo, por lo que voy a generar ids numericos consecutivos, pero en una
	implementacion real no deberian se numeros consecutivos ni nada que genere problemas de seguridad - Hernan"

	lastId := lastId + 1.
	^lastId! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 12/8/2021 14:33:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 12/8/2021 14:33:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 12/8/2021 14:33:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 12/8/2021 14:33:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/8/2021 14:33:39'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 12/8/2021 14:33:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 12/8/2021 14:33:39'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 12/8/2021 14:33:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 12/8/2021 14:33:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 12/8/2021 14:33:39'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 12/8/2021 14:33:39'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 12/8/2021 14:33:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 12/8/2021 14:33:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 12/8/2021 14:33:39'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 12/8/2021 14:33:39'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 12/8/2021 14:33:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 12/8/2021 14:33:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 12/8/2021 14:33:39'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 12/8/2021 14:33:39'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 14:33:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 14:33:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 12/8/2021 14:33:39'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 14:33:39'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test22CanRemoveItemsFromACreatedCart stamp: 'GRC 12/8/2021 14:33:39'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test23CanNotRemoveItemFromNotCreatedCart stamp: 'GRC 12/8/2021 14:33:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveFromCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 14:33:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveItemNotSellByTheStore stamp: 'GRC 12/8/2021 14:33:39'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 12/8/2021 14:33:39'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test26CanNotRemoveItemsMoreTimesThanItAppears stamp: 'GRC 12/8/2021 14:33:39'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test27CheckedOutCartIsEmpty stamp: 'GRC 12/8/2021 14:33:39'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/8/2021 14:33:50'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/8/2021 14:35:09'!
ERROR!
!Cart methodsFor: 'assertions' stamp: 'GRC 12/8/2021 14:37:18' prior: 51188520!
assertIsValidItem: anItem
	catalog do: [:aBook | 
		(aBook at: 'titulo' = anItem) ifTrue: [^true].	
	].
	^self signalInvalidItem.! !

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/8/2021 14:37:20'!
ERROR!
!StoreTestObjectsFactory methodsFor: 'items' stamp: 'GRC 12/8/2021 14:37:50' prior: 51188426!
itemSellByTheStore

	^ 'Rayuela'! !
!StoreTestObjectsFactory methodsFor: 'items' stamp: 'GRC 12/8/2021 14:38:16' prior: 51188411!
anotherItemSellByTheStore

	^'El Aleph'! !
!StoreTestObjectsFactory methodsFor: 'items' stamp: 'GRC 12/8/2021 14:38:32' prior: 51188430!
itemSellByTheStorePrice

	^600! !
!StoreTestObjectsFactory methodsFor: 'items' stamp: 'GRC 12/8/2021 14:38:34' prior: 51191019!
itemSellByTheStorePrice

	^600! !
!StoreTestObjectsFactory methodsFor: 'items' stamp: 'GRC 12/8/2021 14:38:40' prior: 51188416!
anotherItemSellByTheStorePrice

	^450! !

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/8/2021 14:38:45'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/8/2021 14:38:51'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/8/2021 14:38:51'!
ERROR!
!Cart methodsFor: 'assertions' stamp: 'GRC 12/8/2021 14:39:50' prior: 51190998!
assertIsValidItem: anItem
	catalog do: [:aBook | 
		((aBook at: 'titulo') = anItem) ifTrue: [^true].	
	].
	^self signalInvalidItem.! !

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/8/2021 14:39:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 12/8/2021 14:39:55'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 12/8/2021 14:39:55'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 12/8/2021 14:39:55'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 12/8/2021 14:39:55'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test22CanRemoveItemsFromACreatedCart stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test23CanNotRemoveItemFromNotCreatedCart stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveFromCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveItemNotSellByTheStore stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test26CanNotRemoveItemsMoreTimesThanItAppears stamp: 'GRC 12/8/2021 14:39:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test27CheckedOutCartIsEmpty stamp: 'GRC 12/8/2021 14:39:55'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 12/8/2021 14:39:59'!
ERROR!
!Cashier methodsFor: 'checkout - private' stamp: 'GRC 12/8/2021 14:42:02' prior: 51188767!
totalOf: anItem quantity: aQuantity
	cart catalog do: [:aBook |
		((aBook at: 'titulo') = anItem) ifTrue: [
			^(aBook at: 'precio') * aQuantity.	
		].	
	].
	^(cart catalog at: anItem) * aQuantity  ! !
!Cashier methodsFor: 'checkout - private' stamp: 'GRC 12/8/2021 14:42:06' prior: 51191169!
totalOf: anItem quantity: aQuantity
	cart catalog do: [:aBook |
		((aBook at: 'titulo') = anItem) ifTrue: [
			^(aBook at: 'precio') * aQuantity.	
		].	
	].! !

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 12/8/2021 14:42:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 12/8/2021 14:42:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 12/8/2021 14:42:13'!
FAILURE!
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 12/8/2021 14:42:22' prior: 51187939!
test17ListPurchasesOnlyIncludesUserPurchases

	| cartId cartId2 purchases |

	cartId _ systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	cartId2 _ systemFacade createCartFor: self anotherValidUser authenticatedWith: self validUserPassword. 
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId2.
	
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.
		
	systemFacade
		checkOutCartIdentifiedAs: cartId2
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: 2.
	self assert: (purchases at: self anotherValidBook) equals: 1.
	self assert: (purchases at: 'total amount') equals: 1650.! !

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 12/8/2021 14:42:23'!
FAILURE!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/8/2021 14:42:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 12/8/2021 14:42:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 12/8/2021 14:42:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 12/8/2021 14:42:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/8/2021 14:42:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 12/8/2021 14:42:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 12/8/2021 14:42:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 12/8/2021 14:42:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 12/8/2021 14:42:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 12/8/2021 14:42:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 12/8/2021 14:42:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 12/8/2021 14:42:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 12/8/2021 14:42:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 12/8/2021 14:42:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 12/8/2021 14:42:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 12/8/2021 14:42:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 12/8/2021 14:42:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 12/8/2021 14:42:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 12/8/2021 14:42:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 14:42:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 14:42:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 12/8/2021 14:42:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 14:42:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test22CanRemoveItemsFromACreatedCart stamp: 'GRC 12/8/2021 14:42:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test23CanNotRemoveItemFromNotCreatedCart stamp: 'GRC 12/8/2021 14:42:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveFromCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 14:42:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveItemNotSellByTheStore stamp: 'GRC 12/8/2021 14:42:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 12/8/2021 14:42:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test26CanNotRemoveItemsMoreTimesThanItAppears stamp: 'GRC 12/8/2021 14:42:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test27CheckedOutCartIsEmpty stamp: 'GRC 12/8/2021 14:42:40'!
PASSED!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosSystemFacadeTest methodsFor: 'tests - list cart' stamp: 'GRC 12/8/2021 14:54:29' prior: 51188305!
test09ListCartReturnsTheRightNumberOfItems

	| cartId cartContent |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 2 of: self anotherValidBook toCartIdentifiedAs: cartId.
	cartContent := systemFacade listCartIdentifiedAs: cartId.

	self assert: (cartContent occurrencesOf: self validBook) equals: 1.
	self assert: (cartContent occurrencesOf: self anotherValidBook) equals: 2
! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/8/2021 15:04:39' prior: 51190772!
listCartAction: aRequest	
	[ | cartId result cartContent resultDict |
		cartId := (aRequest fields at: 'cartId') asNumber.
		
		cartContent := tusLibros listCartIdentifiedAs: cartId.

		resultDict := Dictionary new.
		cartContent contents keysAndValuesDo: [ :anItem :aQuantity | resultDict add: anItem->aQuantity ].
		resultDict := {resultDict}.
		result := WebUtils jsonEncode: resultDict.
		
		aRequest send200Response: result
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.].
	 ] 
		on: Error 
		do: [ :anError | aRequest sendResponseCode: 400 content: (anError messageText) type: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.].  ]! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!
!CartSession methodsFor: 'cart' stamp: 'GRC 12/8/2021 17:53:05' prior: 51188679!
cartContent

	^cart content! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

----End fileIn of C:\Users\Guido\Desktop\Git\e-commerce-site\Backend\Packages\TerseGuide.pck.st----!
!Cart methodsFor: 'content' stamp: 'GRC 12/8/2021 17:56:59' prior: 51188535!
content

	^items copy! !
!Cart methodsFor: 'content' stamp: 'GRC 12/8/2021 17:57:04' prior: 51188532!
catalog

	^ catalog! !
!Cart methodsFor: 'content' stamp: 'GRC 12/8/2021 17:57:08' prior: 51188545!
occurrencesOf: anItem

	^items occurrencesOf: anItem  ! !

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 12/8/2021 18:02:03'!
PASSED!

----STARTUP---- (8 December 2021 18:02:27) as C:\Users\Guido\Desktop\Git\e-commerce-site\Backend\CuisUniversity-4972.image!


TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosSystemFacadeTest methodsFor: 'tests - list cart' stamp: 'GRC 12/8/2021 18:02:56' prior: 51188305!
test09ListCartReturnsTheRightNumberOfItems

	| cartId cartContent |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 2 of: self anotherValidBook toCartIdentifiedAs: cartId.
	cartContent := systemFacade listCartIdentifiedAs: cartId.

	self assert: (cartContent occurrencesOf: self validBook) equals: 1.
	self assert: (cartContent occurrencesOf: self anotherValidBook) equals: 2
! !

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 12/8/2021 18:03:02'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 12/8/2021 18:03:02'!
ERROR!

----SNAPSHOT----(8 December 2021 18:03:09) CuisUniversity-4972.image priorSource: 27494365!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 12/8/2021 18:03:15'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 12/8/2021 18:03:15'!
ERROR!
!Cart methodsFor: 'assertions' stamp: 'GRC 12/8/2021 18:04:28' prior: 51188520!
assertIsValidItem: anItem
	catalog do: [:aBook | 
		((aBook at: 'titulo') = anItem) ifTrue: [^true].	
	].
	^self signalInvalidItem.! !

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 12/8/2021 18:04:30'!
ERROR!

----SNAPSHOT----(8 December 2021 18:04:39) CuisUniversity-4972.image priorSource: 27608344!
!StoreTestObjectsFactory methodsFor: 'items' stamp: 'GRC 12/8/2021 18:04:54' prior: 51188411!
anotherItemSellByTheStore

	^'El Aleph'! !
!StoreTestObjectsFactory methodsFor: 'items' stamp: 'GRC 12/8/2021 18:05:02' prior: 51188426!
itemSellByTheStore

	^ 'Rayuela'! !
!StoreTestObjectsFactory methodsFor: 'items' stamp: 'GRC 12/8/2021 18:05:07' prior: 51188430!
itemSellByTheStorePrice

	^600! !
!StoreTestObjectsFactory methodsFor: 'items' stamp: 'GRC 12/8/2021 18:05:12' prior: 51188416!
anotherItemSellByTheStorePrice

	^450! !

----SNAPSHOT----(8 December 2021 18:05:14) CuisUniversity-4972.image priorSource: 27609026!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 12/8/2021 18:05:21'!
PASSED!

----SNAPSHOT----(8 December 2021 18:05:27) CuisUniversity-4972.image priorSource: 27609738!
!TusLibrosSystemFacadeTest methodsFor: 'tests - list cart' stamp: 'GRC 12/8/2021 18:06:12' prior: 51194385!
test09ListCartReturnsTheRightNumberOfItems

	| cartId cartContent |

	self halt.

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 2 of: self anotherValidBook toCartIdentifiedAs: cartId.
	cartContent := systemFacade listCartIdentifiedAs: cartId.

	self assert: (cartContent occurrencesOf: self validBook) equals: 1.
	self assert: (cartContent occurrencesOf: self anotherValidBook) equals: 2
! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list cart' stamp: 'GRC 12/8/2021 18:06:36' prior: 51194466!
test09ListCartReturnsTheRightNumberOfItems

	| cartId cartContent |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 2 of: self anotherValidBook toCartIdentifiedAs: cartId.
	cartContent := systemFacade listCartIdentifiedAs: cartId.

	self assert: (cartContent occurrencesOf: self validBook) equals: 1.
	self assert: (cartContent occurrencesOf: self anotherValidBook) equals: 2
! !

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 12/8/2021 18:06:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 12/8/2021 18:06:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 12/8/2021 18:06:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 12/8/2021 18:06:40'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 12/8/2021 18:06:40'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 12/8/2021 18:06:40'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 12/8/2021 18:06:40'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test22CanRemoveItemsFromACreatedCart stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test23CanNotRemoveItemFromNotCreatedCart stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveFromCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveItemNotSellByTheStore stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test26CanNotRemoveItemsMoreTimesThanItAppears stamp: 'GRC 12/8/2021 18:06:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test27CheckedOutCartIsEmpty stamp: 'GRC 12/8/2021 18:06:40'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 12/8/2021 18:06:45'!
ERROR!
!Cashier methodsFor: 'checkout - private' stamp: 'GRC 12/8/2021 18:08:34' prior: 51188767!
totalOf: anItem quantity: aQuantity
	cart catalog do: [:aBook |
		((aBook at: 'titulo') = anItem) ifTrue: [
			^(aBook at: 'precio') * aQuantity.	
		].	
	].! !

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 12/8/2021 18:08:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 12/8/2021 18:08:41'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 12/8/2021 18:08:42'!
FAILURE!
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'GRC 12/8/2021 18:08:51' prior: 51187939!
test17ListPurchasesOnlyIncludesUserPurchases

	| cartId cartId2 purchases |

	cartId _ systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	cartId2 _ systemFacade createCartFor: self anotherValidUser authenticatedWith: self validUserPassword. 
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId2.
	
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.
		
	systemFacade
		checkOutCartIdentifiedAs: cartId2
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: 2.
	self assert: (purchases at: self anotherValidBook) equals: 1.
	self assert: (purchases at: 'total amount') equals: 1650.! !

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 12/8/2021 18:08:53'!
FAILURE!

----SNAPSHOT----(8 December 2021 18:08:57) CuisUniversity-4972.image priorSource: 27609954!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 18:09:04'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test22CanRemoveItemsFromACreatedCart stamp: 'GRC 12/8/2021 18:09:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test23CanNotRemoveItemFromNotCreatedCart stamp: 'GRC 12/8/2021 18:09:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveFromCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 18:09:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveItemNotSellByTheStore stamp: 'GRC 12/8/2021 18:09:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 12/8/2021 18:09:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test26CanNotRemoveItemsMoreTimesThanItAppears stamp: 'GRC 12/8/2021 18:09:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test27CheckedOutCartIsEmpty stamp: 'GRC 12/8/2021 18:09:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17ListPurchasesOnlyIncludesUserPurchases stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanListPurchasesOfUserWithNoPurchases stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotAddToCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanCheckoutACart stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test21CanNotCheckOutCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test22CanRemoveItemsFromACreatedCart stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test23CanNotRemoveItemFromNotCreatedCart stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveFromCartWhenSessionIsExpired stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test24CanNotRemoveItemNotSellByTheStore stamp: 'GRC 12/8/2021 18:09:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test25CanRemoveItemMultipleTimes stamp: 'GRC 12/8/2021 18:09:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test26CanNotRemoveItemsMoreTimesThanItAppears stamp: 'GRC 12/8/2021 18:09:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test27CheckedOutCartIsEmpty stamp: 'GRC 12/8/2021 18:09:08'!
PASSED!
!CartSession methodsFor: 'cart' stamp: 'GRC 12/8/2021 18:11:53' prior: 51188674!
addToCart: anAmount of: aBookIsbn

	| book |
	
	book _ systemFacade bookFor: aBookIsbn.

	^cart add: anAmount of: book.! !
!TusLibrosSystemFacade methodsFor: 'cart session management' stamp: 'GRC 12/8/2021 18:12:39'!
bookFor: aBookIsbn

	^catalog bookFor: aBookIsbn.! !
!TusLibrosSystemFacade methodsFor: 'cart session management' stamp: 'GRC 12/8/2021 18:14:24' prior: 51194920!
bookFor: aBookIsbn

	catalog do: [:aBook |
		((aBook at: 'titulo') = aBookIsbn) ifTrue: [^aBook].	
	].! !

----End fileIn of C:\Users\Guido\Desktop\Git\e-commerce-site\Backend\Packages\TerseGuide.pck.st----!
!Cart methodsFor: 'initialization' stamp: 'GRC 12/8/2021 18:16:13' prior: 51188550!
initializeAcceptingItemsOf: aCatalog

	catalog := aCatalog.
	items := OrderedCollection new.! !

server _ TusLibrosRestInterface listeningOn: 8080.!
!Cart methodsFor: 'adding' stamp: 'GRC 12/8/2021 18:22:56' prior: 51188576!
add: aQuantity of: anItem

	self assertIsValidQuantity: aQuantity.
	self assertIsValidItem: anItem.
	
	anItem at: 'cantidad' put: aQuantity.

	items add: anItem.! !

----SNAPSHOT----(8 December 2021 18:23:02) CuisUniversity-4972.image priorSource: 27617035!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/8/2021 18:25:15' prior: 51190772!
listCartAction: aRequest	
	[ | cartId result cartContent resultDict |
		cartId := (aRequest fields at: 'cartId') asNumber.
		
		cartContent := tusLibros listCartIdentifiedAs: cartId.

		"resultDict := Dictionary new.
		cartContent contents keysAndValuesDo: [ :anItem :aQuantity | resultDict add: anItem->aQuantity ].
		result := WebUtils jsonEncode: resultDict."
		
		result := WebUtils jsonEncode: cartContent.
		
		aRequest send200Response: result
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.].
	 ] 
		on: Error 
		do: [ :anError | aRequest sendResponseCode: 400 content: (anError messageText) type: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.].  ]! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!
!TusLibrosRestInterface methodsFor: 'requests' stamp: 'GRC 12/8/2021 18:27:19' prior: 51197881!
listCartAction: aRequest	
	[ | cartId result cartContent resultDict |
		cartId := (aRequest fields at: 'cartId') asNumber.
		
		cartContent := tusLibros listCartIdentifiedAs: cartId.

		"resultDict := Dictionary new.
		cartContent contents keysAndValuesDo: [ :anItem :aQuantity | resultDict add: anItem->aQuantity ].
		result := WebUtils jsonEncode: resultDict."
		
		result := WebUtils jsonEncode: cartContent asArray.
		
		aRequest send200Response: result
			contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.].
	 ] 
		on: Error 
		do: [ :anError | aRequest sendResponseCode: 400 content: (anError messageText) type: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.].  ]! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

----SNAPSHOT----(8 December 2021 18:28:42) CuisUniversity-4972.image priorSource: 27719140!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/8/2021 18:29:10'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/8/2021 18:29:10'!
ERROR!
!Cart methodsFor: 'assertions' stamp: 'GRC 12/8/2021 18:30:15' prior: 51194422!
assertIsValidItem: anItem
	catalog do: [:aBook | 
		(aBook = anItem) ifTrue: [^true].	
	].
	^self signalInvalidItem.! !

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'GRC 12/8/2021 18:30:16'!
FAILURE!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!
!StoreTestObjectsFactory methodsFor: 'catalogue' stamp: 'GRC 12/8/2021 18:40:03' prior: 51190414!
defaultCatalogReact

	| rayuela elAleph elSur elTunel antesDelFin elReinoDelReves tutuMaramba bestiario |
	
	rayuela _ self libro: 'Rayuela' con: 1 autor: 'Julio Cortazar' precio: 600 cantidad: 0.
	bestiario _ self libro: 'Bestiario' con: 8 autor: 'Julio Cortazar' precio: 350 cantidad: 0.
	elAleph _ self libro: 'El Aleph' con: 2 autor: 'Jorge L. Borges' precio: 450 cantidad: 0.
	elSur _ self libro: 'El Sur' con: 3 autor: 'Jorge L. Borges' precio: 250 cantidad: 0.
	antesDelFin _ self libro: 'Antes Del Fin' con: 4 autor: 'Ernesto Sbato' precio: 350 cantidad: 0.
	elTunel _ self libro: 'El Tnel' con: 5 autor: 'Ernesto Sbato' precio: 400 cantidad: 0.
	elReinoDelReves _ self libro: 'El Reino Del Revs' con: 6 autor: 'Maria E. Walsh' precio: 300 cantidad: 0.
	tutuMaramba _ self libro: 'Tut Maramb' con: 7 autor: 'Maria E. Walsh' precio: 200 cantidad: 0.
	

	^ {rayuela. bestiario. elAleph. elSur. antesDelFin. elTunel. elReinoDelReves. tutuMaramba.}! !

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

TusLibrosRestInterface allInstancesDo: [:aServer | aServer destroy].!

server _ TusLibrosRestInterface listeningOn: 8080.!

----QUIT----(8 December 2021 18:46:09) CuisUniversity-4972.image priorSource: 27721408!